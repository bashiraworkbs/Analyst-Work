<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="refresh" content="600">
<title>Bashira ‚Äî Brawl Stars Analytics</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
:root{
--bg:#08081a;--bg2:#0d0d24;--bg3:#12122e;--bg4:#1a1a3a;--bg5:#222244;
--border:#1a1a38;--border-l:#2a2a50;
--green:#2ecc71;--green-d:#1a7a42;--green-bg:rgba(46,204,113,.12);
--red:#e74c3c;--red-bg:rgba(231,76,60,.12);
--yellow:#f1c40f;--yellow-bg:rgba(241,196,15,.12);
--blue:#3498db;--purple:#9b59b6;
--t1:#f0f0f0;--t2:#a0a0c0;--t3:#606080;--t4:#404060;
--font:'Outfit',sans-serif;--mono:'JetBrains Mono',monospace;
}
html,body{height:100%;overflow:hidden}
body{background:var(--bg);background-image:radial-gradient(ellipse at 15% 0%,rgba(46,204,113,.06) 0%,transparent 50%),radial-gradient(ellipse at 85% 100%,rgba(155,89,182,.05) 0%,transparent 50%);color:var(--t1);font-family:var(--font);font-size:15px;-webkit-user-select:none;user-select:none}
input,textarea,select{-webkit-user-select:text;user-select:text}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border-l);border-radius:3px}
.app{height:100vh;display:flex;flex-direction:column}
.topbar{height:54px;background:var(--bg2);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 24px;flex-shrink:0;z-index:20;backdrop-filter:blur(8px)}
.topbar-left{display:flex;align-items:center;gap:16px}
.logo{font-weight:900;font-size:20px;cursor:pointer;text-transform:uppercase;letter-spacing:1px}.logo span{color:var(--green)}
.back-btn{display:none;padding:6px 14px;border-radius:8px;border:1px solid var(--border);background:var(--bg3);color:var(--t2);cursor:pointer;font-family:var(--font);font-size:13px;font-weight:600;transition:all .2s}
.back-btn:hover{border-color:var(--green);color:var(--t1)}
.back-btn.show{display:inline-flex;align-items:center;gap:4px}
.page-label{font-size:13px;font-weight:700;color:var(--t3);text-transform:uppercase;letter-spacing:1px}
.topbar-right{display:flex;align-items:center;gap:10px}
.avatar{width:32px;height:32px;border-radius:8px;object-fit:cover;border:2px solid var(--green)}
.user-name{font-weight:700;font-size:14px}
.demo-strip{background:rgba(46,204,113,.06);border-bottom:1px solid rgba(46,204,113,.12);padding:5px 24px;font-size:12px;color:var(--green);flex-shrink:0}
.demo-strip a{color:var(--green);text-decoration:underline;cursor:pointer}
.main-scroll{flex:1;overflow-y:auto}
.home{max-width:860px;margin:0 auto;padding:56px 24px;text-align:center}
.home h1{font-size:36px;font-weight:900;margin-bottom:4px}.home h1 span{color:var(--green)}
.home-sub{color:var(--t2);font-size:15px;margin-bottom:44px}
.home-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:36px;max-width:720px;margin-left:auto;margin-right:auto}
.hcard{background:linear-gradient(135deg,var(--bg2),var(--bg3));border:1px solid var(--border);border-radius:16px;padding:18px 22px;cursor:pointer;transition:all .25s;display:flex;align-items:center;gap:14px;min-width:200px;box-shadow:0 4px 16px rgba(0,0,0,.35)}
.hcard:hover{border-color:var(--green);box-shadow:0 0 20px rgba(46,204,113,.18),0 4px 16px rgba(0,0,0,.4);transform:translateY(-3px);background:linear-gradient(135deg,var(--bg3),var(--bg4))}
.hcard-ico{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:radial-gradient(circle,rgba(255,255,255,.08),rgba(255,255,255,.02));border:1.5px solid rgba(255,255,255,.1);flex-shrink:0;box-shadow:inset 0 1px 2px rgba(255,255,255,.05),0 2px 8px rgba(0,0,0,.3)}
.hcard-ico img{width:32px!important;height:32px!important;object-fit:contain!important;filter:drop-shadow(0 2px 4px rgba(0,0,0,.5))}
.hcard-label{font-weight:800;font-size:12px;text-transform:uppercase;letter-spacing:1px;color:var(--t1)}
.hcard-desc{font-size:10px;color:var(--t3);margin-top:3px;letter-spacing:.3px}
.home-stats{font-size:13px;color:var(--t3)}.home-stats b{color:var(--green);font-family:var(--mono)}
.page{display:none;padding:24px;max-width:1200px;margin:0 auto}.page.active{display:block}
.pills{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:16px}
.pill{padding:7px 16px;border-radius:20px;border:1px solid var(--border);background:transparent;color:var(--t2);cursor:pointer;font-family:var(--font);font-size:12.5px;font-weight:600;transition:all .15s}
.pill:hover{border-color:var(--t3);color:var(--t1)}.pill.active,.pill.green{background:var(--green);color:#000;border-color:var(--green)}
.pill.white{background:var(--t1);color:#000;border-color:var(--t1)}
.search-box{width:100%;max-width:360px;padding:9px 14px;border-radius:10px;border:1px solid var(--border);background:var(--bg3);color:var(--t1);font-family:var(--font);font-size:14px;outline:none;margin-bottom:16px}
.search-box:focus{border-color:var(--green)}.search-box::placeholder{color:var(--t3)}
table{width:100%;border-collapse:separate;border-spacing:0}
th{font-size:11px;font-weight:700;color:var(--t3);text-transform:uppercase;letter-spacing:1px;padding:12px 16px;text-align:left;border-bottom:1px solid var(--border)}
td{padding:14px 16px;border-bottom:1px solid var(--border);font-size:14px;color:var(--t2)}
tr:hover td{background:var(--bg3)}
.brawler-cell{display:flex;align-items:center;gap:10px;font-weight:700;color:var(--t1)}
.bico{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:14px;color:#fff;flex-shrink:0;box-shadow:0 2px 6px rgba(0,0,0,.3)}
.bico-sm{width:28px;height:28px;border-radius:6px;display:inline-flex;align-items:center;justify-content:center;font-weight:800;font-size:10px;color:#fff;flex-shrink:0;box-shadow:0 1px 4px rgba(0,0,0,.3)}
.wr-g{color:var(--green);font-family:var(--mono);font-weight:700}
.wr-r{color:var(--red);font-family:var(--mono);font-weight:700}
.wr-y{color:var(--yellow);font-family:var(--mono);font-weight:700}
.b-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(56px,1fr));gap:6px}
.b-icon{width:56px;height:56px;border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .15s;font-weight:800;font-size:16px;color:#fff;border:2px solid transparent;overflow:hidden;position:relative}
.b-icon:hover{border-color:var(--green);transform:scale(1.08)}
.b-icon.sel{border-color:var(--green);box-shadow:0 0 12px rgba(46,204,113,.3)}
.b-icon-name{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(transparent,rgba(0,0,0,.9));padding:2px 1px 3px;font-size:7.5px;font-weight:700;color:#fff;text-align:center;text-transform:uppercase;letter-spacing:.2px;line-height:1}
.kpi-row{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px}
.kpi{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:16px}
.kpi-label{font-size:10px;font-weight:700;color:var(--t3);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px}
.kpi-val{font-size:28px;font-weight:900;font-family:var(--mono)}
.kpi-sub{font-size:11px;color:var(--t3);margin-top:2px}
.card{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:16px;box-shadow:0 2px 12px rgba(0,0,0,.3)}
.card-t{font-weight:700;font-size:12px;color:var(--t3);text-transform:uppercase;letter-spacing:1px;margin-bottom:12px}
.badge{display:inline-block;padding:3px 10px;border-radius:6px;font-size:11px;font-weight:700;font-family:var(--mono)}
.badge-w{background:var(--green-bg);color:var(--green)}.badge-l{background:var(--red-bg);color:var(--red)}
.btn{padding:8px 16px;border-radius:8px;border:1px solid var(--border);background:var(--bg3);color:var(--t1);cursor:pointer;font-family:var(--font);font-size:13px;font-weight:600;transition:all .2s}
.btn:hover{border-color:var(--green)}.btn-g{background:var(--green);color:#000;border-color:var(--green)}.btn-g:hover{background:#27ae60}
.chart-box{height:220px;position:relative}
.hm-wrap{overflow-x:auto;background:var(--bg2);border:1px solid var(--border);border-radius:12px}
.hm{border-collapse:collapse;width:100%;min-width:600px}
.hm th{padding:8px 4px;font-size:9px;text-align:center;background:var(--bg2);border:1px solid var(--bg);font-weight:700;color:var(--t2)}
.hm td{padding:0;text-align:center;font-family:var(--mono);border:1px solid var(--bg);min-width:72px;height:56px;vertical-align:middle}
.hm-cell{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:4px 2px}
.hm-wr{font-size:13px;font-weight:800}
.hm-wl{font-size:9px;opacity:.8}
.hm .rh{background:var(--bg2);font-family:var(--font);font-weight:700;font-size:12px;text-align:left;padding:8px 10px;min-width:140px;position:sticky;left:0;z-index:1;border:1px solid var(--bg)}
.hm .rh-inner{display:flex;align-items:center;gap:8px}
.team-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:14px}
.tc{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:18px}
.tc:hover{border-color:var(--border-l)}
.tc-head{display:flex;align-items:center;gap:12px;margin-bottom:14px}
.tc-logo{width:42px;height:42px;border-radius:10px;background:var(--bg4);display:flex;align-items:center;justify-content:center;font-weight:900;font-size:15px}
.tc-name{font-weight:800;font-size:16px;text-transform:uppercase}
.tc-sub{font-size:11px;color:var(--t3)}
.tc-row{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.tc-cell{text-align:center}
.tc-cell-val{font-family:var(--mono);font-weight:800;font-size:16px;padding:6px 4px;border-radius:8px}
.tc-cell-lbl{font-size:9px;color:var(--t3);text-transform:uppercase;letter-spacing:.5px;margin-top:3px;font-weight:600}
.draft-board{display:grid;grid-template-columns:1fr auto 1fr;gap:16px;align-items:start}
.draft-side{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:20px}
.draft-vs{display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:900;color:var(--t3);padding-top:40px}
.draft-slots{display:flex;gap:8px;margin-bottom:16px}
.d-slot{width:70px;height:70px;border-radius:10px;border:2px dashed var(--border-l);display:flex;align-items:center;justify-content:center;flex-direction:column;cursor:pointer;font-size:10px;color:var(--t3);background:var(--bg3);transition:all .2s}
.d-slot:hover{border-color:var(--green)}.d-slot.filled{border:2px solid var(--green)}.d-slot.red-filled{border:2px solid var(--red)}
.draft-result{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:20px;margin-top:16px}
.adv-bar{height:32px;border-radius:8px;overflow:hidden;display:flex;margin:12px 0}
.adv-bar-l{background:var(--green);transition:width .5s}
.adv-bar-r{background:var(--red);transition:width .5s}
.map-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px}
.map-card{background:var(--bg3);border:1px solid var(--border);border-radius:10px;overflow:hidden}
.map-card-top{height:28px;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:#fff}
.map-card-body{padding:10px;text-align:center}
.map-card-name{font-size:11px;font-weight:700;text-transform:uppercase;margin-bottom:4px}
.map-card-wr{font-size:22px;font-weight:800;font-family:var(--mono)}
.map-card-sub{font-size:10px;color:var(--t3)}

@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade{animation:fadeUp .3s ease-out}
@media(max-width:768px){.home-grid{grid-template-columns:1fr}.kpi-row{grid-template-columns:repeat(2,1fr)}.team-grid{grid-template-columns:1fr}.draft-board{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="app">
<div class="topbar">
  <div class="topbar-left">
    <div class="logo" onclick="goHome()"><span style="color:var(--green);font-weight:900">‚öî</span> <span>Bashira</span></div>
    <button class="back-btn" id="backBtn" onclick="goHome()">‚Üê Home</button>
    <span class="page-label" id="pageLabel"></span>
  </div>
  <div class="topbar-right"><span id="syncBadge" style="font-size:11px;font-family:var(--mono);margin-right:10px;cursor:pointer" onclick="fetchGoogleSheet()"></span><img class="avatar" src="data:image/png;base64,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kw4Rvvgkf/M5dB+rdXizF8zBlrhfmfJFjIswPudD+tcq6onUIGQsa+B/efY6H1TR61VfHmXnxc/FkNHd5nVg1ebFZx5GUn5gftX1tP8AVAGXGT7Az1PSPWl9I0esBw4cq6jE2Ml7+0Edjmfgya/VjKMg1D7vzPZ1P6oz5PR8eiQkOAQzE3ffx8wPvc3rXpbM5OpQAHkbhObN616VqGOmOoU7l5JIn5VkyOSbyE3yZUZCrBtx9u4Hb68mnTX5foMGS+KM82+JZ3DCZwEREBERAsAZ1aPEM2RVNAA83OZDZAnf9uLGNrUxgfSpkfTJgXQsxQAE+1zz/wBQ5dJqazLjKZj+8SnpmvOLD9I0RXZmXq2TEcaqGBbu6gc+i1P035xjqhcz1i463BrYn+JmmVQhtbbwbldRmORABQA6gYuRKrkbFew9iQ56uVJsQJ32eZcFdv5mMvAggbviStgkDiRuixA0x5CgoGGdmNtzM7EmBSTuMiIE2ZBiICIiBK9yWlYgaAiuzI4+ZSIF5VpEQEREBERAREQJXgy+5gbu5nEDY5XZgASJD5GLfcxlBKwL2fBkEn3MrECSSZERASbMiIEmREQEsOpWICWoSsmzAnaJB7izIgSBcnaJANSVNwG0RtEk9StmBO0RtEAyYEbRIIqSTzIJuBEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERA//Z"><span class="user-name">bashira</span></div>
</div>
<div id="refreshBar" style="display:flex;align-items:center;justify-content:center;gap:12px;padding:5px 16px;background:rgba(46,204,113,.06);border-bottom:1px solid rgba(46,204,113,.12);font-size:12px;color:var(--t3);flex-shrink:0">
  <span>üîÑ Dernier refresh : <span id="lastRefreshTime" style="color:var(--green);font-family:var(--mono);font-weight:600"></span></span>
  <span style="color:var(--t4)">¬∑</span>
  <span>Prochain dans <span id="refreshCountdown" style="color:var(--green);font-family:var(--mono);font-weight:600"></span></span>
</div>
<script>
(function(){
  var refreshInterval=600;
  var now=new Date();
  var _lrt=document.getElementById("lastRefreshTime");if(_lrt)_lrt.textContent=now.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit",second:"2-digit"});
  var remaining=refreshInterval;
  function updateCountdown(){
    var m=Math.floor(remaining/60);
    var s=remaining%60;
    var _rc=document.getElementById("refreshCountdown");if(!_rc)return;
    _rc.textContent=(m<10?"0":"")+m+":"+(s<10?"0":"")+s;
    if(remaining<=0){_rc.textContent="00:00";}
    else{remaining--;setTimeout(updateCountdown,1000);}
  }
  updateCountdown();
})();
</script>
<div id="demoBanner" style="display:none;align-items:center;justify-content:center;gap:8px;padding:8px 16px;background:linear-gradient(90deg,#1a1a2e,#16213e);border:1px solid #e94560;border-radius:8px;margin:8px 16px;font-size:12px;color:#e94560"><span style="font-size:16px">‚ö†Ô∏è</span> Donn√©es embarqu√©es (snapshot) ¬∑ D√©ployez sur un serveur web pour sync Google Sheets compl√®te</div>
<div class="main-scroll" id="mainScroll">
  <div id="homeScreen"></div>
  <div class="page" id="pg-overview"></div>
  <div class="page" id="pg-meta"></div>
  <div class="page" id="pg-brawlers"></div>
  <div class="page" id="pg-teams"></div>
  <div class="page" id="pg-h2h"></div>
  <div class="page" id="pg-tracker"></div>
  <div class="page" id="pg-draft"></div>
  <div class="page" id="pg-players"></div>
  <div class="page" id="pg-maps"></div>
  <div class="page" id="pg-import" style="display:none"></div>
</div>
</div>
<script>
// ‚ïê‚ïê‚ïê PROTECTION ‚ïê‚ïê‚ïê
(function(){
  // Block right-click
  document.addEventListener('contextmenu',function(e){e.preventDefault();return false;});
  // Block text selection & drag
  document.addEventListener('selectstart',function(e){e.preventDefault();});
  document.addEventListener('dragstart',function(e){e.preventDefault();});
  // Block keyboard shortcuts for devtools & save & print & view source
  document.addEventListener('keydown',function(e){
    if(e.key==='F12'){e.preventDefault();return false;}
    if(e.ctrlKey&&e.shiftKey&&['I','i','J','j','C','c','K','k'].indexOf(e.key)>=0){e.preventDefault();return false;}
    if(e.ctrlKey&&['U','u','S','s','P','p'].indexOf(e.key)>=0){e.preventDefault();return false;}
    if(e.metaKey&&e.altKey&&['I','i','J','j','C','c'].indexOf(e.key)>=0){e.preventDefault();return false;}
    if(e.metaKey&&['U','u','S','s'].indexOf(e.key)>=0){e.preventDefault();return false;}
  });
  // Console preserved
  // DevTools detection disabled
  // Anti-iframe
  if(window.self!==window.top){document.documentElement.innerHTML='';window.stop();}
  // Block copy/paste of page content
  document.addEventListener('copy',function(e){e.preventDefault();});
  document.addEventListener('cut',function(e){e.preventDefault();});
})();
// ‚ïê‚ïê‚ïê CONFIG ‚ïê‚ïê‚ïê
var BC={"8-Bit":"#30a060",Alli:"#e06080",Amber:"#e67e22",Angelo:"#3090e0",Ash:"#a0603a",Barley:"#d4a040",Bea:"#f0c020",Belle:"#ffd700",Berry:"#8030a0",Bibi:"#d04060",Bo:"#2e7d32",Bonnie:"#d07050",Brock:"#6c3483",Bull:"#a04020",Buster:"#c0392b",Buzz:"#e08020",Byron:"#7d3c98",Carl:"#6080c0",Charlie:"#a060d0",Chester:"#c060d0",Chuck:"#4080a0",Clancy:"#30a070",Colette:"#a040c0",Colt:"#c0392b",Cordelius:"#506030",Crow:"#f1c40f",Darryl:"#e07020",Doug:"#d0a060",Draco:"#d03020",Dynamike:"#d09040",Edgar:"#802040","El Primo":"#408020",Emz:"#9c27b0",Eve:"#60d060",Fang:"#2c3ee0",Finx:"#c050e0",Frank:"#6d4c1e",Gale:"#2980b9",Gene:"#8060c0",Gigi:"#d04060",Glowbert:"#f0d060",Gray:"#707070",Griff:"#c09030",Grom:"#a0402e",Gus:"#40a080",Hank:"#508030",Jacky:"#d07050","Jae-Yong":"#3070b0",Janet:"#e060a0",Jessie:"#c04040",Juju:"#d0a020",Kaze:"#c03050",Kenji:"#a03050",Kit:"#d09060","Larry & Lawrie":"#608040",Leon:"#1abc9c",Lily:"#40d090",Lola:"#d04070",Lou:"#60b0e0",Lumi:"#60d0f0",Maisie:"#6040a0",Mandy:"#d040a0",Max:"#f0d040",Meeple:"#60a0e0",Meg:"#d050a0",Melodie:"#9040d0",Mico:"#40d0d0",Mina:"#b04080",Moe:"#d07030",Mortis:"#5c2d91","Mr. P":"#3060a0",Nani:"#e060e0",Nita:"#c06030",Ollie:"#50b080",Otis:"#3080b0",Pam:"#50a060",Pearl:"#d0a080",Penny:"#c06040",Pierce:"#d04050",Piper:"#e080a0",Poco:"#3080d0","R-T":"#40a0d0",Rico:"#27ae60",Rosa:"#50a040",Ruffs:"#5070a0",Sam:"#a07030",Sandy:"#d4a340",Shade:"#353550",Shelly:"#8b6914",Spike:"#2ecc71",Sprout:"#60c050",Squeak:"#d4c040",Stu:"#ff6f00",Surge:"#8e44ad",Tara:"#5040a0",Tick:"#4090d0",Trunk:"#70a030",Willow:"#706090",Ziggy:"#e070d0"};
var BID={"8-Bit":16000027,Alli:16000095,Amber:16000040,Angelo:16000079,Ash:16000051,Barley:16000006,Bea:16000029,Belle:16000046,Berry:16000082,Bibi:16000026,Bo:16000014,Bonnie:16000057,Brock:16000003,Bull:16000002,Buster:16000062,Buzz:16000049,Byron:16000042,Carl:16000025,Charlie:16000074,Chester:16000063,Chuck:16000073,Clancy:16000083,Colette:16000039,Colt:16000001,Cordelius:16000070,Crow:16000012,Darryl:16000018,Doug:16000071,Draco:16000080,Dynamike:16000009,Edgar:16000043,"El Primo":16000010,Emz:16000030,Eve:16000055,Fang:16000054,Finx:16000092,Frank:16000020,Gale:16000035,Gene:16000021,Gigi:16000100,Glowbert:16000101,Gray:16000064,Griff:16000050,Grom:16000048,Gus:16000061,Hank:16000069,Jacky:16000034,"Jae-Yong":16000093,Janet:16000056,Jessie:16000007,Juju:16000087,Kaze:16000094,Kenji:16000085,Kit:16000076,"Larry & Lawrie":16000077,Leon:16000023,Lily:16000081,Lola:16000053,Lou:16000041,Lumi:16000091,Maisie:16000068,Mandy:16000065,Max:16000032,Meeple:16000089,Meg:16000052,Melodie:16000078,Mico:16000075,Mina:16000097,Moe:16000084,Mortis:16000011,"Mr. P":16000031,Nani:16000036,Nita:16000008,Ollie:16000090,Otis:16000059,Pam:16000016,Pearl:16000072,Penny:16000019,Pierce:16000099,Piper:16000015,Poco:16000013,"R-T":16000066,Rico:16000004,Rosa:16000024,Ruffs:16000044,Sam:16000060,Sandy:16000028,Shade:16000086,Shelly:16000000,Spike:16000005,Sprout:16000033,Squeak:16000047,Stu:16000045,Surge:16000038,Tara:16000017,Tick:16000022,Trunk:16000096,Willow:16000067,Ziggy:16000098};
var BCLS={"8-Bit":"Damage Dealer",Alli:"Assassin",Amber:"Damage Dealer",Angelo:"Marksman",Ash:"Tank",Barley:"Controller",Bea:"Marksman",Belle:"Marksman",Berry:"Controller",Bibi:"Tank",Bo:"Controller",Bonnie:"Marksman",Brock:"Marksman",Bull:"Tank",Buster:"Tank",Buzz:"Assassin",Byron:"Support",Carl:"Damage Dealer",Charlie:"Controller",Chester:"Damage Dealer",Chuck:"Damage Dealer",Clancy:"Damage Dealer",Colette:"Damage Dealer",Colt:"Damage Dealer",Cordelius:"Assassin",Crow:"Assassin",Darryl:"Tank",Doug:"Support",Draco:"Tank",Dynamike:"Artillery",Edgar:"Assassin","El Primo":"Tank",Emz:"Controller",Eve:"Damage Dealer",Fang:"Assassin",Finx:"Controller",Frank:"Tank",Gale:"Support",Gene:"Support",Gigi:"Assassin",Glowbert:"Support",Gray:"Support",Griff:"Damage Dealer",Grom:"Artillery",Gus:"Support",Hank:"Tank",Jacky:"Tank","Jae-Yong":"Support",Janet:"Marksman",Jessie:"Controller",Juju:"Artillery",Kaze:"Assassin",Kenji:"Assassin",Kit:"Support","Larry & Lawrie":"Controller",Leon:"Assassin",Lily:"Assassin",Lola:"Damage Dealer",Lou:"Controller",Lumi:"Damage Dealer",Maisie:"Marksman",Mandy:"Marksman",Max:"Support",Meeple:"Controller",Meg:"Damage Dealer",Melodie:"Assassin",Mico:"Assassin",Mina:"Support",Moe:"Artillery",Mortis:"Assassin","Mr. P":"Controller",Nani:"Marksman",Nita:"Damage Dealer",Ollie:"Tank",Otis:"Controller",Pam:"Support",Pearl:"Damage Dealer",Penny:"Controller",Pierce:"Marksman",Piper:"Marksman",Poco:"Support","R-T":"Damage Dealer",Rico:"Damage Dealer",Rosa:"Tank",Ruffs:"Support",Sam:"Assassin",Sandy:"Controller",Shade:"Assassin",Shelly:"Damage Dealer",Spike:"Controller",Sprout:"Controller",Squeak:"Controller",Stu:"Assassin",Surge:"Damage Dealer",Tara:"Assassin",Tick:"Artillery",Trunk:"Tank",Willow:"Controller",Ziggy:"Controller"};
var CLASSES=["Damage Dealer","Assassin","Controller","Support","Marksman","Tank","Artillery"];
var CLASS_ICO={"Damage Dealer":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxNCIgZmlsbD0iI2U3NGMzYyIgb3BhY2l0eT0iLjIiLz48cGF0aCBkPSJNMTAgMjJMMjIgMTBNMTAgMTBsMTIgMTIiIHN0cm9rZT0iI2U3NGMzYyIgc3Ryb2tlLXdpZHRoPSIzIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIzIiBmaWxsPSIjZTc0YzNjIi8+PC9zdmc+","Assassin":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxNCIgZmlsbD0iIzliNTliNiIgb3BhY2l0eT0iLjIiLz48cGF0aCBkPSJNMTYgNEwxOSAxNEgyNkwyMCAyMEwyMyAyOEwxNiAyM0w5IDI4TDEyIDIwTDYgMTRIMTNaIiBmaWxsPSIjOWI1OWI2Ii8+PC9zdmc+","Controller":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxNCIgZmlsbD0iIzM0OThkYiIgb3BhY2l0eT0iLjIiLz48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxMCIgc3Ryb2tlPSIjMzQ5OGRiIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiLz48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSI1IiBzdHJva2U9IiMzNDk4ZGIiIHN0cm9rZS13aWR0aD0iMiIgZmlsbD0ibm9uZSIvPjxjaXJjbGUgY3g9IjE2IiBjeT0iMTYiIHI9IjIiIGZpbGw9IiMzNDk4ZGIiLz48bGluZSB4MT0iMTYiIHkxPSIyIiB4Mj0iMTYiIHkyPSI4IiBzdHJva2U9IiMzNDk4ZGIiIHN0cm9rZS13aWR0aD0iMiIvPjxsaW5lIHgxPSIxNiIgeTE9IjI0IiB4Mj0iMTYiIHkyPSIzMCIgc3Ryb2tlPSIjMzQ5OGRiIiBzdHJva2Utd2lkdGg9IjIiLz48bGluZSB4MT0iMiIgeTE9IjE2IiB4Mj0iOCIgeTI9IjE2IiBzdHJva2U9IiMzNDk4ZGIiIHN0cm9rZS13aWR0aD0iMiIvPjxsaW5lIHgxPSIyNCIgeTE9IjE2IiB4Mj0iMzAiIHkyPSIxNiIgc3Ryb2tlPSIjMzQ5OGRiIiBzdHJva2Utd2lkdGg9IjIiLz48L3N2Zz4=","Support":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxNCIgZmlsbD0iIzJlY2M3MSIgb3BhY2l0eT0iLjIiLz48cmVjdCB4PSIxMyIgeT0iNiIgd2lkdGg9IjYiIGhlaWdodD0iMjAiIHJ4PSIyIiBmaWxsPSIjMmVjYzcxIi8+PHJlY3QgeD0iNiIgeT0iMTMiIHdpZHRoPSIyMCIgaGVpZ2h0PSI2IiByeD0iMiIgZmlsbD0iIzJlY2M3MSIvPjwvc3ZnPg==","Marksman":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxNCIgZmlsbD0iI2YzOWMxMiIgb3BhY2l0eT0iLjIiLz48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxMCIgc3Ryb2tlPSIjZjM5YzEyIiBzdHJva2Utd2lkdGg9IjIuNSIgZmlsbD0ibm9uZSIvPjxjaXJjbGUgY3g9IjE2IiBjeT0iMTYiIHI9IjQiIHN0cm9rZT0iI2YzOWMxMiIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+PGxpbmUgeDE9IjE2IiB5MT0iMiIgeDI9IjE2IiB5Mj0iMTAiIHN0cm9rZT0iI2YzOWMxMiIgc3Ryb2tlLXdpZHRoPSIyIi8+PGxpbmUgeDE9IjE2IiB5MT0iMjIiIHgyPSIxNiIgeTI9IjMwIiBzdHJva2U9IiNmMzljMTIiIHN0cm9rZS13aWR0aD0iMiIvPjxsaW5lIHgxPSIyIiB5MT0iMTYiIHgyPSIxMCIgeTI9IjE2IiBzdHJva2U9IiNmMzljMTIiIHN0cm9rZS13aWR0aD0iMiIvPjxsaW5lIHgxPSIyMiIgeTE9IjE2IiB4Mj0iMzAiIHkyPSIxNiIgc3Ryb2tlPSIjZjM5YzEyIiBzdHJva2Utd2lkdGg9IjIiLz48L3N2Zz4=","Tank":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxNCIgZmlsbD0iIzFhYmM5YyIgb3BhY2l0eT0iLjIiLz48cGF0aCBkPSJNMTYgNEwyOCAyNEg0WiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMWFiYzljIiBzdHJva2Utd2lkdGg9IjIuNSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjxwYXRoIGQ9Ik0xNiAxMEwyMyAyMkg5WiIgZmlsbD0iIzFhYmM5YyIgb3BhY2l0eT0iLjUiLz48Y2lyY2xlIGN4PSIxNiIgY3k9IjE3IiByPSIzIiBmaWxsPSIjMWFiYzljIi8+PC9zdmc+","Artillery":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxNCIgZmlsbD0iI2U2N2UyMiIgb3BhY2l0eT0iLjIiLz48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSI4IiBmaWxsPSIjZTY3ZTIyIi8+PHBhdGggZD0iTTEwIDhMOCA0TTIyIDhMMjQgNE0xMCAyNEw4IDI4TTIyIDI0TDI0IDI4TTYgMTJMMiAxMU0yNiAxMkwzMCAxMU02IDIwTDIgMjFNMjYgMjBMMzAgMjEiIHN0cm9rZT0iI2U2N2UyMiIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz48L3N2Zz4="};
function clsIco(cls,sz){sz=sz||16;var src=CLASS_ICO[cls];if(!src)return '';return '<img src="'+src+'" width="'+sz+'" height="'+sz+'" style="vertical-align:middle">';}
var SEC_ICO={wrmode:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48cmVjdCB4PSIyIiB5PSI0IiB3aWR0aD0iNSIgaGVpZ2h0PSI4IiByeD0iMSIgZmlsbD0iIzJlY2M3MSIgb3BhY2l0eT0iLjciLz48cmVjdCB4PSI5IiB5PSI0IiB3aWR0aD0iNSIgaGVpZ2h0PSI4IiByeD0iMSIgZmlsbD0iIzJlY2M3MSIgb3BhY2l0eT0iLjQiLz48cmVjdCB4PSI0IiB5PSI2IiB3aWR0aD0iMSIgaGVpZ2h0PSI0IiByeD0iLjUiIGZpbGw9IiNmZmYiIG9wYWNpdHk9Ii42Ii8+PHJlY3QgeD0iMTEiIHk9IjYiIHdpZHRoPSIxIiBoZWlnaHQ9IjQiIHJ4PSIuNSIgZmlsbD0iI2ZmZiIgb3BhY2l0eT0iLjYiLz48L3N2Zz4=",map:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48cGF0aCBkPSJNOCAyQzUuOCAyIDQgMy44IDQgNmMwIDMgNCA4IDQgOHM0LTUgNC04YzAtMi4yLTEuOC00LTQtNHoiIGZpbGw9IiNlNzRjM2MiLz48Y2lyY2xlIGN4PSI4IiBjeT0iNiIgcj0iMS41IiBmaWxsPSIjZmZmIi8+PC9zdmc+",crown:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48cGF0aCBkPSJNMiAxMmgxMlY2bC0zIDMtMy01LTMgNS0zLTN2NnoiIGZpbGw9IiNmMWM0MGYiLz48cmVjdCB4PSIyIiB5PSIxMiIgd2lkdGg9IjEyIiBoZWlnaHQ9IjIiIHJ4PSIxIiBmaWxsPSIjZjM5YzEyIi8+PC9zdmc+",target:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48Y2lyY2xlIGN4PSI4IiBjeT0iOCIgcj0iNiIgc3Ryb2tlPSIjMzQ5OGRiIiBzdHJva2Utd2lkdGg9IjEuNSIgZmlsbD0ibm9uZSIvPjxjaXJjbGUgY3g9IjgiIGN5PSI4IiByPSIzIiBzdHJva2U9IiMzNDk4ZGIiIHN0cm9rZS13aWR0aD0iMS41IiBmaWxsPSJub25lIi8+PGNpcmNsZSBjeD0iOCIgY3k9IjgiIHI9IjEiIGZpbGw9IiMzNDk4ZGIiLz48L3N2Zz4=",up:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48cGF0aCBkPSJNOCAzbDUgOUgzeiIgZmlsbD0iIzJlY2M3MSIvPjwvc3ZnPg==",down:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48cGF0aCBkPSJNOCAxM2w1LTlIM3oiIGZpbGw9IiNlNzRjM2MiLz48L3N2Zz4=",swords:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48cGF0aCBkPSJNMyAxM2w0LTRNMTMgM0w5IDdNMyAzbDEwIDEwTTUgM0gzdjJNMTEgMTNoMnYtMiIgc3Ryb2tlPSIjZjFjNDBmIiBzdHJva2Utd2lkdGg9IjEuNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBmaWxsPSJub25lIi8+PC9zdmc+",scope:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48Y2lyY2xlIGN4PSI3IiBjeT0iNyIgcj0iNSIgc3Ryb2tlPSIjMmVjYzcxIiBzdHJva2Utd2lkdGg9IjEuNSIgZmlsbD0ibm9uZSIvPjxsaW5lIHgxPSIxMSIgeTE9IjExIiB4Mj0iMTQiIHkyPSIxNCIgc3Ryb2tlPSIjMmVjYzcxIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPjwvc3ZnPg=="};
function sIco(k){return '<img src="'+SEC_ICO[k]+'" width="14" height="14" style="vertical-align:middle;margin-right:4px">';}
var MODES=["Gem Grab","Brawl Ball","Heist","Bounty","Hot Zone","Knockout"];
var MAPS=["Double Swoosh","Hard Rock Mine","Backyard Bowl","Safe Zone","Kaboom Canyon","Ring of Fire","Goldarm Gulch","Out in the Open","Super Beach","Sneaky Fields"];
var MC={"Gem Grab":"#9b59b6","Brawl Ball":"#3498db","Heist":"#e67e22","Bounty":"#f1c40f","Hot Zone":"#e74c3c","Knockout":"#1abc9c"};
var RANKED_MAPS={"Gem Grab":[{name:"Hard Rock Mine",id:15000007},{name:"Double Swoosh",id:15000115},{name:"Deathcap Trap",id:15000009}],"Brawl Ball":[{name:"Super Beach",id:15000051},{name:"Sneaky Fields",id:15000050},{name:"Pinball Dreams",id:15000118},{name:"Pinhole Punt",id:15000026},{name:"Triple Dribble",id:15000025}],"Hot Zone":[{name:"Dueling Beetles",id:15000306},{name:"Ring of Fire",id:15000300},{name:"Open Business",id:15000292},{name:"Open Zone",id:15000527}],"Heist":[{name:"Safe Zone",id:15000019},{name:"Bridge Too Far",id:15000072},{name:"Hot Potato",id:15000053},{name:"Kaboom Canyon",id:15000018},{name:"Pit Stop",id:15000137}],"Bounty":[{name:"Shooting Star",id:15000005},{name:"Layer Cake",id:15000082},{name:"Hideout",id:15000022},{name:"Dry Season",id:15000083}],"Knockout":[{name:"New Horizons",id:15000703},{name:"Belle's Rock",id:15000368},{name:"Goldarm Gulch",id:15000367},{name:"Out in the Open",id:15000548}]};
function mapImg(id,sz){sz=sz||60;return '<img src="https://cdn.brawlify.com/maps/regular/'+id+'.png" width="'+sz+'" height="'+(sz*1.3)+'" style="border-radius:6px;object-fit:cover;background:var(--bg3)" loading="lazy" onerror="this.style.display=\'none\'">';}
function getMapId(name){for(var mk in RANKED_MAPS){for(var i=0;i<RANKED_MAPS[mk].length;i++){if(RANKED_MAPS[mk][i].name===name)return RANKED_MAPS[mk][i].id;}}return 0;}
var MODE_ICO={"Knockout":"data:image/png;base64,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","Gem Grab":"data:image/png;base64,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","Brawl Ball":"data:image/png;base64,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","Hot Zone":"data:image/png;base64,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","Heist":"data:image/png;base64,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","Bounty":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAQCAYAAAB3AH1ZAAABCGlDQ1BJQ0MgUHJvZmlsZQAAeJxjYGA8wQAELAYMDLl5JUVB7k4KEZFRCuwPGBiBEAwSk4sLGHADoKpv1yBqL+viUYcLcKakFicD6Q9ArFIEtBxopAiQLZIOYWuA2EkQtg2IXV5SUAJkB4DYRSFBzkB2CpCtkY7ETkJiJxcUgdT3ANk2uTmlyQh3M/Ck5oUGA2kOIJZhKGYIYnBncAL5H6IkfxEDg8VXBgbmCQixpJkMDNtbGRgkbiHEVBYwMPC3MDBsO48QQ4RJQWJRIliIBYiZ0tIYGD4tZ2DgjWRgEL7AwMAVDQsIHG5TALvNnSEfCNMZchhSgSKeDHkMyQx6QJYRgwGDIYMZAKbWPz9HbOBQAAAD2UlEQVR42rVVbUyVZRi+nue87zkv35gxVopiDIrjcq5VTAwjXcJMCkQopaTQTlqKCK7laHsPE120ATPn4lBN7Qt3aoiGaESJBZFAIR8yctkXIE0FzjjncL7e9737ATXW5uTDrj/Pnt17nl33dV+7bmD64DZb7byRodqnhgfORciyzKcW/3u/IyAiNnkGi6KAxoZDKZnpq8jybv5eAPjmbHlSWWlBMREFA4DJZBJlWRasVqvun7dzgizLXK8XcahsV3WxeetJIlqYmhLvysled4KI7svYsNqTtCbGnrf72U4iirzD3U9ISkSR65LjCABteT65w2n/ahfRhW25O9MHuBC4nchsOVK6kpKSEv4oPrinpLy08OX29s/WEpHfVBVvBeHWJTMBRQCavWlpie9FR0ckQHMvr6v7dmNtbduS5pbeZk1xVDiHhspfzV+mRYRfWdR3tfX1G2MCjpSfx/3Grys4ZzsyMzM5AHXOinR3HC186cUnhw3S/DIAjwgCQ7vFJI4P5b+hOrcSOXM85DL5yJniqtwXoWZtyazknN2mSeC2zrVYTKLRaNR/VNVkF2hUdLvyONFJn6JwPPxKpU/P0M+5CO+Im4/3dAvouiRcG9bzB2KjOzWNIMsy5kSgoWFU6+3t9ZaUFPTftAlBg10du+H5ssN3Y8d37sG9ab6QmGGM20k30Mn9xgYBL2d/2QPw6IrYXwGwxETMnoAsy9xqtWrHj+4zr34iq6rmdKt27ES/AtVDguh4zBA6Vs37zh5znWkFczi4ZhCBIE5h/k60fN+zigHU2NiIWZoQmDChGX0///n0+cYOAwDV41MFEkR4bjpUYbiH6W3Xw919/vD+EgDlHi8kI+PpCR68Vde2SSPazxgbJwJjDDRjAmazDMYYEV3N/vGnK0319W1BK+PCiTlHGfu9SwffOFRBTyyQMRplCByQCNdVCoZLU2yDi8+csyQDqDabZR1QpMx4BIwVabL8uMBYVPdzGxI+CAmdx3TOEdXd0wkD90IIMQBcY4pOgyTp0HLNwQqbvLrC5gVq1IMP1axZEd05mQPaLEcAAImQcYFLAX6/6fVMWb+tTQkPM2DB3RLPWhvIX3tBQsB8HV28NEaFg6HKM9mpbx/I2VwlSUt7S0o//TfX5hLHAgCc+vxAwaKIcOJcIFHyp8lP1dzNYUrfwXt96XExVF1/ePuU2OPT2QfTUGBCvuXLYmvydqYvtTuc3iVRC+mHi5eTT51uinz/Cy/6RxcjPiP+w03r91RszDDqrdbLCmNMY4zhfwMR3fXJ8Tf3V7yT+7GP2lOJSALAZroF/wacO8uOkNLdygAAAABJRU5ErkJggg=="};
function mIco(m){var u=MODE_ICO[m];return u?'<img src="'+u+'" style="width:16px;height:16px;object-fit:contain;vertical-align:middle;margin-right:4px" loading="lazy" onerror="this.style.display=\'none\'">':''}
var REGIONS=["NA","EMEA","SA","APAC"];
var TEAMS_DB={
  TribeGaming:{tag:"TRB",region:"NA",color:"#e67e22",country:"US",org:"Tribe Gaming",liquipedia:"https://liquipedia.net/brawlstars/Tribe_Gaming",logo:"https://liquipedia.net/commons/images/thumb/7/7a/Tribe_Gaming_allmode.png/52px-Tribe_Gaming_allmode.png"},
  FutEsports:{tag:"FUT",region:"EMEA",color:"#e74c3c",country:"TR",org:"FUT Esports",liquipedia:"https://liquipedia.net/brawlstars/FUT_Esports",logo:"https://liquipedia.net/commons/images/thumb/7/7c/FUT_Esports_allmode.png/52px-FUT_Esports_allmode.png"},
  ReplyTotem:{tag:"TTM",region:"EMEA",color:"#8e44ad",country:"IT",org:"Totem Esports (Reply Totem)",liquipedia:"https://liquipedia.net/brawlstars/Totem_Esports",logo:"https://liquipedia.net/commons/images/thumb/4/47/Totem_esports.png/52px-Totem_esports.png"},
  KdsEsports:{tag:"KDS",region:"EMEA",color:"#c0392b",country:"TR",org:"KDS Esports",liquipedia:"https://liquipedia.net/brawlstars/KDS_Esports",logo:"https://liquipedia.net/commons/images/thumb/d/d4/KDS_Esports_allmode.png/52px-KDS_Esports_allmode.png"},
  Reject:{tag:"RC",region:"APAC",color:"#3498db",country:"JP",org:"REJECT",liquipedia:"https://liquipedia.net/brawlstars/REJECT",logo:"https://liquipedia.net/commons/images/thumb/f/fe/REJECT_allmode.png/52px-REJECT_allmode.png"},
  Reject_f879:{tag:"RC2",region:"APAC",color:"#2980b9",country:"JP",org:"REJECT (Roster B)",liquipedia:"https://liquipedia.net/brawlstars/REJECT",logo:"https://liquipedia.net/commons/images/thumb/f/fe/REJECT_allmode.png/52px-REJECT_allmode.png"},
  CrazyRacoon:{tag:"CR",region:"APAC",color:"#e74c3c",country:"JP",org:"Crazy Raccoon",liquipedia:"https://liquipedia.net/brawlstars/Crazy_Raccoon"},
  Loud:{tag:"LOUD",region:"SA",color:"#2ecc71",country:"BR",org:"LOUD",liquipedia:"https://liquipedia.net/brawlstars/LOUD"},
  Skgaming:{tag:"SK",region:"EMEA",color:"#e67e22",country:"DE",org:"SK Gaming",liquipedia:"https://liquipedia.net/brawlstars/SK_Gaming"},
  TeamHeretics:{tag:"TH",region:"EMEA",color:"#9b59b6",country:"ES",org:"Team Heretics",liquipedia:"https://liquipedia.net/brawlstars/Team_Heretics"},
  navi:{tag:"NAVI",region:"EMEA",color:"#f1c40f",country:"UA",org:"Natus Vincere",liquipedia:"https://liquipedia.net/brawlstars/Natus_Vincere"},
  hmble:{tag:"HMBL",region:"EMEA",color:"#3498db",country:"EU",org:"HMBLE",liquipedia:"https://liquipedia.net/brawlstars/HMBLE"},
  stmn:{tag:"STMN",region:"NA",color:"#1abc9c",country:"US",org:"STMN Esports",liquipedia:"https://liquipedia.net/brawlstars/STMN_Esports"},
  teamelektros:{tag:"ELK",region:"NA",color:"#e74c3c",country:"US",org:"Team Elektros",liquipedia:"https://liquipedia.net/brawlstars/Team_Elektros"},
  zetadivision:{tag:"ZETA",region:"APAC",color:"#2c3e50",country:"JP",org:"ZETA DIVISION",liquipedia:"https://liquipedia.net/brawlstars/ZETA_DIVISION"},
  Skakakalas:{tag:"SKC",region:"APAC",color:"#e67e22",country:"JP",org:"SKCalalas",liquipedia:"https://liquipedia.net/brawlstars/SKCalalas"},
  skakakalasea:{tag:"SKEA",region:"APAC",color:"#e67e22",country:"JP",org:"SKCalalas EA",liquipedia:"https://liquipedia.net/brawlstars/SKCalalas"},
  Vatic:{tag:"VAT",region:"NA",color:"#9b59b6",country:"US",org:"Vatic Esports",liquipedia:"https://liquipedia.net/brawlstars/Vatic_Esports"},
  PaparasuperMassive:{tag:"SUP",region:"EMEA",color:"#e74c3c",country:"TR",org:"Papara SuperMassive",liquipedia:"https://liquipedia.net/brawlstars/Papara_SuperMassive"},
  PaparasuperMassive_2429:{tag:"SUP2",region:"EMEA",color:"#c0392b",country:"TR",org:"Papara SuperMassive (2)"},
  PaparasuperMassive_869b:{tag:"SUP3",region:"EMEA",color:"#a93226",country:"TR",org:"Papara SuperMassive (3)"},
  Overthrow:{tag:"OVT",region:"EMEA",color:"#2ecc71",country:"EU",org:"Overthrow"},
  kaioperro:{tag:"KP",region:"SA",color:"#f39c12",country:"BR",org:"KaioPerro",liquipedia:"https://liquipedia.net/brawlstars/KaioPerro"},
  ninguemsegura:{tag:"NS",region:"SA",color:"#e74c3c",country:"BR",org:"Ninguem Segura"},
  eternalsa:{tag:"ETR",region:"SA",color:"#3498db",country:"BR",org:"Eternal Esports"},
  eternalsa_059b:{tag:"ETR2",region:"SA",color:"#2980b9",country:"BR",org:"Eternal Esports (2)"},
  newheightsgaming:{tag:"NHG",region:"SA",color:"#1abc9c",country:"BR",org:"New Heights Gaming"},
  futesport:{tag:"FUT2",region:"EMEA",color:"#c0392b",country:"TR",org:"FUT Esports (alt)"},
  Bobbyteam:{tag:"BOB",region:"EMEA",color:"#e67e22",country:"EU",org:"Bobby Team"},
  UpcoreSouthasia:{tag:"UPC",region:"APAC",color:"#9b59b6",country:"SA",org:"Upcore Southasia"},
  novo:{tag:"NOVO",region:"SA",color:"#27ae60",country:"BR",org:"Novo"},
  CMM:{tag:"CMM",region:"EMEA",color:"#e74c3c",country:"RS",org:"CMM",liquipedia:"https://liquipedia.net/brawlstars/CMM"},
  cmm:{tag:"CMM",region:"EMEA",color:"#e74c3c",country:"RS",org:"CMM",liquipedia:"https://liquipedia.net/brawlstars/CMM"},
  FACMM:{tag:"CMM",region:"EMEA",color:"#e74c3c",country:"RS",org:"CMM",liquipedia:"https://liquipedia.net/brawlstars/CMM"},
  facmm:{tag:"CMM",region:"EMEA",color:"#e74c3c",country:"RS",org:"CMM",liquipedia:"https://liquipedia.net/brawlstars/CMM"},
  "FA CMM":{tag:"CMM",region:"EMEA",color:"#e74c3c",country:"RS",org:"CMM",liquipedia:"https://liquipedia.net/brawlstars/CMM"},
  "F/A CMM":{tag:"CMM",region:"EMEA",color:"#e74c3c",country:"RS",org:"CMM",liquipedia:"https://liquipedia.net/brawlstars/CMM"},
  "fa cmm":{tag:"CMM",region:"EMEA",color:"#e74c3c",country:"RS",org:"CMM",liquipedia:"https://liquipedia.net/brawlstars/CMM"}
};
var TEAM_NAMES=Object.keys(TEAMS_DB);
var TEAM_REGIONS={};for(var _tk in TEAMS_DB)TEAM_REGIONS[_tk]=TEAMS_DB[_tk].region;
function teamLogo(name,sz){sz=sz||28;var db=TEAMS_DB[name];if(!db||!db.logo)return '';return '<img src="'+db.logo+'" width="'+sz+'" height="'+sz+'" style="border-radius:4px;object-fit:contain;background:#111" onerror="this.style.display=\'none\'" alt="'+name+'">';}
function teamInfo(name){return TEAMS_DB[name]||null;}
// BS icons loaded from BSI object above
// BS-styled icons with thick outlines like in-game
function _topBrawlers(){var ct={};for(var i=0;i<matchData.length;i++){var r=matchData[i];var bs=[r.brawler1,r.brawler2,r.brawler3,r.enemy1,r.enemy2,r.enemy3];for(var j=0;j<bs.length;j++){if(bs[j])ct[bs[j]]=(ct[bs[j]]||0)+1;}}var arr=[];for(var b in ct)arr.push({n:b,c:ct[b]});arr.sort(function(a,b){return b.c-a.c;});return arr;}
function _topBrawlerIco(name,sz){sz=sz||36;var nn=_normB(name);if(!nn)return '‚≠ê';var src=bImgSrc(nn);if(!src)return '‚≠ê';return '<img src="'+src+'" loading="lazy" style="width:'+sz+'px;height:'+sz+'px;object-fit:cover;border-radius:8px" onerror="this.outerHTML=\'‚≠ê\'">';}
var BSI={
  overview:'<img src="https://cdn.brawlify.com/gamemode/Gem-Grab.png" loading="lazy" style="width:36px;height:36px;object-fit:contain;border-radius:8px" onerror="this.outerHTML=\'üèÜ\'">',
  tracker:'<img src="https://cdn.brawlify.com/gamemode/Knockout.png" loading="lazy" style="width:36px;height:36px;object-fit:contain;border-radius:8px" onerror="this.outerHTML=\'‚öîÔ∏è\'">',
  meta:'<img src="https://cdn.brawlify.com/gamemode/Ranked.png" loading="lazy" style="width:36px;height:36px;object-fit:contain;border-radius:8px" onerror="this.outerHTML=\'‚≠ê\'">',
  brawlers:'<img src="https://cdn.brawlify.com/gamemode/Brawl-Ball.png" loading="lazy" style="width:36px;height:36px;object-fit:contain;border-radius:8px" onerror="this.outerHTML=\'üëä\'">',
  maps:'<img src="https://cdn.brawlify.com/gamemode/Hot-Zone.png" loading="lazy" style="width:36px;height:36px;object-fit:contain;border-radius:8px" onerror="this.outerHTML=\'üó∫Ô∏è\'">',
  draft:'<img src="https://cdn.brawlify.com/gamemode/Duels.png" loading="lazy" style="width:36px;height:36px;object-fit:contain;border-radius:8px" onerror="this.outerHTML=\'üõ°Ô∏è\'">',
  teams:'<img src="https://cdn.brawlify.com/club/8000000.png" loading="lazy" style="width:36px;height:36px;object-fit:contain;border-radius:8px" onerror="this.outerHTML=\'üë•\'">',
  h2h:'<img src="https://cdn.brawlify.com/gamemode/Bounty.png" loading="lazy" style="width:36px;height:36px;object-fit:contain;border-radius:8px" onerror="this.outerHTML=\'‚ö°\'">',
  players:'<img src="https://cdn.brawlify.com/profile/28000000.png" loading="lazy" style="width:36px;height:36px;object-fit:contain;border-radius:8px" onerror="this.outerHTML=\'üè∑Ô∏è\'">'
};
var MODS=[
  {id:"overview",label:"Overview",ico:BSI.overview,desc:"Global stats & trends"},
  {id:"tracker",label:"Battle Log",ico:BSI.tracker,desc:"Match history"},
  {id:"meta",label:"Meta",ico:BSI.meta,desc:"Tier list & rankings"},
  {id:"brawlers",label:"Brawlers",ico:BSI.brawlers,desc:"Brawler deep dive"},
  {id:"maps",label:"Maps",ico:BSI.maps,desc:"Map analytics"},
  {id:"draft",label:"Draft",ico:BSI.draft,desc:"Draft simulator"},
  {id:"teams",label:"Teams",ico:BSI.teams,desc:"Team analytics"},
  {id:"h2h",label:"Head 2 Head",ico:BSI.h2h,desc:"Matchup heatmap"},
  {id:"players",label:"Players",ico:BSI.players,desc:"Player stats & picks"}
];
function updateModsIcons(){var top=_topBrawlers();if(top.length)MODS[0].ico=_topBrawlerIco(top[0].n,36);}
var draftEnemy="", draftPick="", draftHistory=[];
var analyzeTeam1=[], analyzeTeam2=[];
var matchData=[];
var usingDemo=false;
var curPage=null;
var filters={mode:"",days:9999};
var sheetLastSync="";
var sheetFetchStatus="pending";
var GS_SHEET_ID="1j_NDvTn0NGgoSfDpRsB3A0I9eOZmzJrb0ERODbrTN78";

function updateSyncBadge(){
  var el=document.getElementById("syncBadge");if(!el)return;
  var c2={pending:"var(--t3)",loading:"var(--yellow)",ok:"var(--green)",error:"var(--red)",empty:"var(--t3)"};
  var l2={pending:"‚è≥",loading:"üîÑ",ok:"‚úÖ "+matchData.length+"g",error:"‚ùå Offline",empty:"‚ö†Ô∏è Empty"};
  el.style.color=c2[sheetFetchStatus]||"var(--t3)";
  el.textContent=l2[sheetFetchStatus]||"";
  if(sheetLastSync&&sheetFetchStatus==="ok"){
    el.textContent+=" ¬∑ "+sheetLastSync;
    if(_sheetFetchCount>0)el.textContent+=" (#"+_sheetFetchCount+")";
  }
}

var _sheetScriptEl=null;
var _lastSheetHash="";
var _sheetFetchCount=0;
function _simpleHash(str){var h=0;for(var i=0;i<str.length;i++){h=((h<<5)-h)+str.charCodeAt(i);h|=0;}return h;}
function fetchGoogleSheet(){
  try{
    sheetFetchStatus="loading";updateSyncBadge();
    _sheetFetchCount++;
    if(_sheetScriptEl&&_sheetScriptEl.parentNode){_sheetScriptEl.parentNode.removeChild(_sheetScriptEl);}
    var s=document.createElement("script");
    s.src="https://docs.google.com/spreadsheets/d/"+GS_SHEET_ID+"/gviz/tq?sheet=TRIAAPRIME&tq="+encodeURIComponent("select *")+"&tqx=responseHandler:handleSheetData&_cb="+Date.now();
    s.onerror=function(){sheetFetchStatus="error";updateSyncBadge();console.warn("[Bashira] Sheet fetch #"+_sheetFetchCount+" FAILED");};
    document.head.appendChild(s);
    _sheetScriptEl=s;
    console.log("[Bashira] Sheet fetch #"+_sheetFetchCount+" started...");
  }catch(e){sheetFetchStatus="error";updateSyncBadge();console.error("[Bashira] Sheet fetch exception:",e);}
}

function handleSheetData(resp){
  try{
    if(resp.status==="error")throw new Error("Sheet error");
    var table=resp.table;if(!table||!table.cols)return;
    var headers=table.cols.map(function(col){return(col.label||col.id||"").trim().toLowerCase().replace(/[^a-z0-9_]/g,"_");});
    // If headers look like column IDs (A, B, C...), try to use first row as headers
    var _allSingleChar=headers.every(function(h){return h.length<=1;});
    if(_allSingleChar&&table.rows&&table.rows.length>0){
      var fr=table.rows[0];if(fr&&fr.c){
        headers=fr.c.map(function(cell){return cell&&cell.v?(cell.v+"").trim().toLowerCase().replace(/[^a-z0-9_]/g,"_"):"";});
        table.rows=table.rows.slice(1); // remove header row from data
        
      }
    }
    // Header aliases: map alternative column names to expected ones
    var _hAlias={game_mode:"mode",gamemode:"mode",map_name:"map",mapname:"map",result_team_1:"result_team1",result:"result_team1",
      team_1_name:"team1_name",team_2_name:"team2_name",
      team1_player1:"team1_player1_brawler",team1_player2:"team1_player2_brawler",team1_player3:"team1_player3_brawler",
      team2_player1:"team2_player1_brawler",team2_player2:"team2_player2_brawler",team2_player3:"team2_player3_brawler"};
    // Also match any header containing "mode" (but not already mapped)
    headers=headers.map(function(h){
      if(_hAlias[h])return _hAlias[h];
      if(h.indexOf("mode")>=0&&h!=="mode")return "mode";
      return h;
    });
    
    var rawRows=[];
    for(var i=0;i<(table.rows||[]).length;i++){
      var r=table.rows[i];if(!r)continue;
      var cells=r.c;if(!cells)continue;
      var obj={};var hasData=false;
      for(var j=0;j<Math.min(headers.length,cells.length);j++){
        var cell=cells[j];var hdr=headers[j];if(!hdr)continue;
        if(!cell||cell.v==null||cell.v===""){obj[hdr]="";}
        else{
          hasData=true;var val=cell.v;
          if(typeof val==="object"&&val!==null&&typeof val.getFullYear==="function"){
            obj[hdr]=val.getFullYear()+"-"+String(val.getMonth()+1).padStart(2,"0")+"-"+String(val.getDate()).padStart(2,"0");
          }else if(typeof val==="string"&&val.indexOf("Date(")>=0){
            var dm=val.match(/Date\((\d+),(\d+),(\d+)/);
            if(dm)obj[hdr]=dm[1]+"-"+String(+dm[2]+1).padStart(2,"0")+"-"+String(+dm[3]).padStart(2,"0");
            else obj[hdr]=cell.f||String(val);
          }else if(cell.f&&/^\d{1,2}[\/-]\d{1,2}[\/-]\d{4}$/.test(cell.f)){
            var sep=cell.f.indexOf("/")>=0?"/":"-";var dp=cell.f.split(sep);
            // Force DD/MM/YYYY (French format from Google Sheets)
            obj[hdr]=dp[2]+"-"+dp[1].padStart(2,"0")+"-"+dp[0].padStart(2,"0");
          }else{obj[hdr]=cell.f||String(val);}
        }
      }
      if(hasData)rawRows.push(obj);
    }
    // Transform to match format
    // Normalize mode names FIRST
    var _mNorm={};for(var _mi=0;_mi<MODES.length;_mi++){_mNorm[MODES[_mi].toLowerCase()]=MODES[_mi];}
    _mNorm["brawlball"]="Brawl Ball";_mNorm["gemgrab"]="Gem Grab";_mNorm["hotzone"]="Hot Zone";
    _mNorm["knockout"]="Knockout";_mNorm["heist"]="Heist";_mNorm["bounty"]="Bounty";
    _mNorm["siege"]="Siege";_mNorm["showdown"]="Showdown";_mNorm["duels"]="Duels";
    _mNorm["wipeout"]="Wipeout";_mNorm["basketbrawl"]="Basket Brawl";_mNorm["trophythieves"]="Trophy Thieves";
    var _VALID={};for(var _vv=0;_vv<MODES.length;_vv++)_VALID[MODES[_vv]]=1;
    var rows=rawRows.map(function(r){
      var res=(r.result_team1||"").toLowerCase().trim();
      var result=(res==="victory"||res==="win"||res==="w"||res==="1")?"victory":
                 (res==="defeat"||res==="loss"||res==="l"||res==="0")?"defeat":res;
      var mode=r.mode||"";
      mode=_mNorm[mode.toLowerCase().trim()]||mode;
      return{date:r.date||"",time:r.time||"",duration:r.duration||"",mode:mode,map:r.map||"",result:result,
        team1_name:r.team1_name||"",team2_name:r.team2_name||"",
        brawler1:r.team1_player1_brawler||"",brawler2:r.team1_player2_brawler||"",brawler3:r.team1_player3_brawler||"",
        enemy1:r.team2_player1_brawler||"",enemy2:r.team2_player2_brawler||"",enemy3:r.team2_player3_brawler||"",
        player1:r.team1_player1_name||"",player2:r.team1_player2_name||"",player3:r.team1_player3_name||"",
        eplayer1:r.team2_player1_name||"",eplayer2:r.team2_player2_name||"",eplayer3:r.team2_player3_name||"",
        set_score:r.set_score||"",set_id:r.set_id||"",set_game_number:r.set_game_number||"",
        tier1:r.average_tier_team1||"unknown",tier2:r.average_tier_team2||"unknown",
        region1:r.average_region_team1||"unknown",region2:r.average_region_team2||"unknown"};
    }).filter(function(r){return r.date&&r.result&&_VALID[r.mode];});
    if(rows.length){
      for(var _ri=0;_ri<rows.length;_ri++){
        rows[_ri]=_normRow(rows[_ri]);
      }
      // Change detection: compare hash of new data vs previous
      var _newHash=_simpleHash(JSON.stringify(rows));
      var _dataChanged=(_newHash!==_lastSheetHash);
      var _prevCount=matchData.length;
      _lastSheetHash=_newHash;
      matchData=rows;usingDemo=false;
      sheetFetchStatus="ok";
      sheetLastSync=new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"});
      document.getElementById("demoBanner").style.display="none";
      autoSetFilter();
      // Debug logging
      console.log("[Bashira] Sheet fetch #"+_sheetFetchCount+" OK ‚Üí "+rows.length+" rows"
        +(_dataChanged?" ‚ö° DATA CHANGED (prev: "+_prevCount+" rows)":" ‚úî No change")
        +" | hash: "+_newHash+" | time: "+sheetLastSync);
      if(curPage)go(curPage);else goHome();
    }else{sheetFetchStatus="empty";}
    updateSyncBadge();
  }catch(e){console.error("[Bashira]",e);sheetFetchStatus="error";updateSyncBadge();}
}

// ‚ïê‚ïê‚ïê EMBEDDED SHEET DATA ‚ïê‚ïê‚ïê
var SHEET_DATA=[];

var _nameMap={};for(var _nk in BID){_nameMap[_nk.toUpperCase()]=_nk;_nameMap[_nk.toLowerCase()]=_nk;}
function _normB(n){return _nameMap[(n||"").toUpperCase()]||_nameMap[(n||"").toLowerCase()]||n;}
function _normRow(r){r.brawler1=_normB(r.brawler1);r.brawler2=_normB(r.brawler2);r.brawler3=_normB(r.brawler3);r.enemy1=_normB(r.enemy1);r.enemy2=_normB(r.enemy2);r.enemy3=_normB(r.enemy3);return r;}
function loadEmbeddedData(){
  if(SHEET_DATA.length){var vm={};for(var i=0;i<MODES.length;i++)vm[MODES[i]]=1;matchData=SHEET_DATA.filter(function(r){return !!vm[r.mode];}).map(_normRow);usingDemo=false;}
}

// ‚ïê‚ïê‚ïê HELPERS ‚ïê‚ïê‚ïê
function hsh(s){var h=0;for(var i=0;i<s.length;i++)h=((h<<5)-h)+s.charCodeAt(i);return h;}
var _BClc={};for(var _ck in BC)_BClc[_ck.toLowerCase()]=BC[_ck];
var _BCLSlc={};for(var _clk in BCLS)_BCLSlc[_clk.toLowerCase()]=BCLS[_clk];
function bc(n){return BC[n]||_BClc[(n||"").toLowerCase()]||("#"+((Math.abs(hsh(n))%0xBBBBBB+0x444444).toString(16)));}
function wrCol(w){return (+w)>=52?"wr-g":(+w)>=48?"wr-y":"wr-r";}
function wrHex(w){return (+w)>=55?"#2ecc71":(+w)>=50?"#f1c40f":"#e74c3c";}
function getTier(w){var v=+w;return v>=60?"S":v>=55?"A":v>=50?"B":v>=45?"C":v>=40?"D":"F";}
var TC={S:"#e74c3c",A:"#e67e22",B:"#f1c40f",C:"#2ecc71",D:"#95a5a6",F:"#636e72"};

function wrCellColor(wr){
  if(wr===null)return"background:#1a1a1a";
  var v=+wr;
  if(v===0)return"background:#2a1515";
  if(v>=60)return"background:#2ecc71";
  if(v>=55)return"background:#27ae60";
  if(v>=50)return"background:#1a5c2e";
  if(v<40)return"background:#c0392b";
  if(v<45)return"background:#a93226";
  return"background:#5c1a1a";
}

var _BIDlc={};for(var _bk in BID)_BIDlc[_bk.toLowerCase()]=BID[_bk];
function _bid(n){return BID[n]||_BIDlc[(n||"").toLowerCase()]||0;}
var CDN_SRCS=[
  "https://cdn.brawlify.com/brawler/",
  "https://cdn.brawlify.com/brawlers/borderless/",
  "https://cdn.brawlify.com/brawlers/borders/"
];
function _brawlerHash(n){var h={"Mr. P":"Mr.P","R-T":"R-T","8-Bit":"8-Bit","El Primo":"El-Primo","Larry & Lawrie":"Larry%26Lawrie","Jae-Yong":"Jae-Yong"};return h[n]||n;}
function bImgSrc(n){var id=_bid(n);return id?"https://cdn.brawlify.com/brawlers/borderless/"+id+".png":"";}
function bSort(a,b){return(_bid(a)||99999)-(_bid(b)||99999);}
function bImgSrc2(n){var id=_bid(n);return id?"https://cdn.brawlify.com/brawlers/borders/"+id+".png":"";}
function bImgSrc3(n){var nn=_nameMap[(n||"").toUpperCase()]||n;return nn?"https://cdn.brawlify.com/brawler/"+_brawlerHash(nn)+".png":"";}
function bIcon(name,size){
  var s=size||36;var r=s>30?8:6;var ini=name.slice(0,2).toUpperCase();var src=bImgSrc(name);var src2=bImgSrc2(name);var src3=bImgSrc3(name);var fs=s>40?Math.round(s/2.8):Math.round(s/2.5);var c=bc(name);
  if(src)return '<div class="bico" style="width:'+s+'px;height:'+s+'px;border-radius:'+r+'px;background:linear-gradient(135deg,'+c+','+c+'99);overflow:hidden;border:1.5px solid '+c+'"><img src="'+src+'" loading="lazy" style="width:100%;height:100%;object-fit:cover" onerror="this.src=\''+src2+'\';this.onerror=function(){this.src=\''+src3+'\';this.onerror=function(){this.style.display=\'none\';this.parentNode.innerHTML=\'<span style=font-size:'+fs+'px;font-weight:800;text-shadow:0_1px_2px_rgba(0,0,0,.5)>'+ini+'</span>\';};};"></div>';
  return '<div class="bico" style="width:'+s+'px;height:'+s+'px;border-radius:'+r+'px;background:linear-gradient(135deg,'+c+','+c+'99);font-size:'+fs+'px;border:1.5px solid '+c+';text-shadow:0 1px 2px rgba(0,0,0,.5)">'+ini+'</div>';
}
function bIconSm(name){
  var ini=name.slice(0,2).toUpperCase();var src=bImgSrc(name);var src2=bImgSrc2(name);var c=bc(name);
  if(src)return '<div class="bico-sm" style="background:linear-gradient(135deg,'+c+','+c+'99);overflow:hidden;border:1px solid '+c+'"><img src="'+src+'" loading="lazy" style="width:100%;height:100%;object-fit:cover" onerror="this.src=\''+src2+'\';this.onerror=function(){this.style.display=\'none\';this.parentNode.innerHTML=\''+ini+'\';};"></div>';
  return '<div class="bico-sm" style="background:linear-gradient(135deg,'+c+','+c+'99);border:1px solid '+c+'">'+ini+'</div>';
}
function resultBadge(r){return r==="victory"?'<span class="badge badge-w">WIN</span>':'<span class="badge badge-l">LOSS</span>';}

var charts={};
function killCharts(){for(var k in charts){try{charts[k].destroy();}catch(e){}}charts={};}
function mChart(id,type,data,opts){
  try{
  var ctx=document.getElementById(id);if(!ctx)return;
  if(typeof Chart==='undefined')return;
  var df={responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{backgroundColor:"#1a1a1a",borderColor:"#333",borderWidth:1,padding:10,cornerRadius:8}},scales:{x:{ticks:{color:"#666",font:{family:"Outfit",size:10}},grid:{color:"rgba(42,42,42,0.25)"}},y:{ticks:{color:"#666",font:{family:"Outfit",size:10}},grid:{color:"rgba(42,42,42,0.25)"}}}};
  var merged={};for(var p in df)merged[p]=df[p];if(opts)for(var p2 in opts)merged[p2]=opts[p2];
  charts[id]=new Chart(ctx,{type:type,data:data,options:merged});
  }catch(e){console.warn('Chart error:',e);}
}

// ‚ïê‚ïê‚ïê DATA ‚ïê‚ïê‚ïê
function genDemo(){
  var brawlers=Object.keys(BC),rows=[],i,p,e,d;
  for(i=0;i<600;i++){
    p=[];while(p.length<3){var b1=brawlers[~~(Math.random()*brawlers.length)];if(p.indexOf(b1)===-1)p.push(b1);}
    e=[];while(e.length<3){var b2=brawlers[~~(Math.random()*brawlers.length)];if(e.indexOf(b2)===-1&&p.indexOf(b2)===-1)e.push(b2);}
    d=new Date(2025,~~(Math.random()*3),~~(Math.random()*28)+1);
    rows.push({date:d.toISOString().split("T")[0],mode:MODES[~~(Math.random()*MODES.length)],map:MAPS[~~(Math.random()*MAPS.length)],brawler1:p[0],brawler2:p[1],brawler3:p[2],enemy1:e[0],enemy2:e[1],enemy3:e[2],result:Math.random()>.45?"victory":"loose"});
  }
  return rows;
}

function compute(data){
  if(!data.length)return{brawlers:[],comps:[],counters:{},synergies:{},modes:[],maps:[],timeline:[],total:0,wins:0};
  var bm={},cm={},ctr={},syn={},mm={},mpm={};
  var total=data.length, wins=0;
  data.forEach(function(r){
    var isW=r.result==="victory";
    if(isW)wins++;
    var my=[r.brawler1,r.brawler2,r.brawler3].filter(Boolean).sort();
    var en=[r.enemy1,r.enemy2,r.enemy3].filter(Boolean).sort();
    my.forEach(function(b){
      if(!bm[b])bm[b]={name:b,w:0,p:0,modes:{},maps:{}};
      bm[b].p++;if(isW)bm[b].w++;
      if(r.mode){if(!bm[b].modes[r.mode])bm[b].modes[r.mode]={w:0,n:0};bm[b].modes[r.mode].n++;if(isW)bm[b].modes[r.mode].w++;}
      if(r.map){if(!bm[b].maps[r.map])bm[b].maps[r.map]={w:0,n:0};bm[b].maps[r.map].n++;if(isW)bm[b].maps[r.map].w++;}
    });
    var ck=my.join("+");
    if(!cm[ck])cm[ck]={comp:my,w:0,p:0,modes:{}};cm[ck].p++;if(isW)cm[ck].w++;
    if(r.mode){if(!cm[ck].modes[r.mode])cm[ck].modes[r.mode]={w:0,n:0};cm[ck].modes[r.mode].n++;if(isW)cm[ck].modes[r.mode].w++;}
    my.forEach(function(a){en.forEach(function(e2){var k=a+"_vs_"+e2;if(!ctr[k])ctr[k]={brawler:a,enemy:e2,w:0,t:0};ctr[k].t++;if(isW)ctr[k].w++;});});
    for(var si=0;si<my.length;si++){for(var sj=si+1;sj<my.length;sj++){var sk=my[si]+"_with_"+my[sj];if(!syn[sk])syn[sk]={a:my[si],b:my[sj],w:0,t:0};syn[sk].t++;if(isW)syn[sk].w++;}}
    if(r.mode){if(!mm[r.mode])mm[r.mode]={name:r.mode,w:0,t:0};mm[r.mode].t++;if(isW)mm[r.mode].w++;}
    if(r.map){if(!mpm[r.map])mpm[r.map]={name:r.map,w:0,t:0};mpm[r.map].t++;if(isW)mpm[r.map].w++;}
  });
  var _validM={};for(var _vmi=0;_vmi<MODES.length;_vmi++)_validM[MODES[_vmi]]=1;
  var brawlers=[];for(var bk in bm){var bb=bm[bk];var bwr=bb.p?((bb.w/bb.p)*100).toFixed(2):"0";var bpr=((bb.p/total)*100).toFixed(2);var modes2=[];for(var mk in bb.modes){if(_validM[mk])modes2.push([mk,bb.modes[mk]]);}modes2.sort(function(a,c){return(c[1].w/c[1].n)-(a[1].w/a[1].n);});brawlers.push({name:bb.name,w:bb.w,p:bb.p,wr:bwr,pr:bpr,modes:bb.modes,maps:bb.maps,bestMode:modes2.length?modes2[0][0]:"-"});}
  brawlers.sort(function(a,b){return(+b.wr)-(+a.wr);});
  var comps=[];for(var ck2 in cm){var cc=cm[ck2];var cwr=cc.p?((cc.w/cc.p)*100).toFixed(2):"0";var modes3=[];for(var mk2 in cc.modes){if(_validM[mk2])modes3.push([mk2,cc.modes[mk2]]);}modes3.sort(function(a,c){return(c[1].w/c[1].n)-(a[1].w/a[1].n);});comps.push({comp:cc.comp,w:cc.w,p:cc.p,wr:cwr,bestMode:modes3.length?modes3[0][0]:"-"});}
  comps.sort(function(a,b){return(+b.wr)-(+a.wr);});
  var modes=[];for(var mmk in mm){var m=mm[mmk];if(_validM[m.name])modes.push({name:m.name,w:m.w,t:m.t,wr:((m.w/m.t)*100).toFixed(1)});}
  var maps=[];for(var mpk in mpm){var mp=mpm[mpk];maps.push({name:mp.name,w:mp.w,t:mp.t,wr:((mp.w/mp.t)*100).toFixed(1)});}
  var dm={};data.forEach(function(r){if(!r.date)return;if(!dm[r.date])dm[r.date]={date:r.date,w:0,t:0};dm[r.date].t++;if(r.result==="victory")dm[r.date].w++;});
  var timeline=[];for(var dk in dm){var dd=dm[dk];timeline.push({date:dd.date,w:dd.w,t:dd.t,wr:((dd.w/dd.t)*100).toFixed(1)});}
  timeline.sort(function(a,b){return a.date.localeCompare(b.date);});
  return{brawlers:brawlers,comps:comps,counters:ctr,synergies:syn,modes:modes,maps:maps,timeline:timeline,total:total,wins:wins};
}

function getFD(){var d=matchData;if(filters.days&&filters.days<9999){var mx=null;for(var i=0;i<matchData.length;i++){if(!matchData[i].date)continue;var rd=_pd(matchData[i].date);if(!isNaN(rd)&&(!mx||rd>mx))mx=rd;}if(mx){var cut=new Date(mx.getTime()-filters.days*86400000);d=d.filter(function(r){if(!r.date)return false;var rd=_pd(r.date);return !isNaN(rd)&&rd>=cut;});}}if(filters.mode)d=d.filter(function(r){return (r.mode||"").toLowerCase()===filters.mode.toLowerCase();});return d;}
function _pd(s){if(!s)return NaN;if(s.indexOf("/")>=0){var p=s.split("/");return new Date(p[2]+"-"+p[1]+"-"+p[0]);}return new Date(s);}
function getDateRange(d){
  function fmt(ds){if(!ds)return"?";var p=ds.split("-");return p.length===3?(p[2]+"/"+p[1]+"/"+p[0]):ds;}
  var mn=null,mx=null;
  for(var i=0;i<d.length;i++){var dt=d[i].date;if(!dt)continue;if(!mn||dt<mn)mn=dt;if(!mx||dt>mx)mx=dt;}
  return{from:mn||"",to:mx||"",label:fmt(mn)+" ‚Üí "+fmt(mx)};
}
function setDays(n){filters.days=n;if(curPage)go(curPage);else goHome();}

// ‚ïê‚ïê‚ïê NAV ‚ïê‚ïê‚ïê
function autoSetFilter(){filters.days=9999;}

function init(){
  try{
  loadEmbeddedData();
  updateModsIcons();
  if(!matchData.length){matchData=genDemo();usingDemo=true;}
  goHome();
  // Fetch live data immediately on load, then every 2 min
  sheetFetchStatus="loading";
  updateSyncBadge();
  try{fetchGoogleSheet();}catch(e){console.warn('Sheet fetch error:',e);}
  setInterval(function(){try{fetchGoogleSheet();}catch(e){}},10*60*1000);
  }catch(e){console.error('Init error:',e);document.body.innerHTML='<div style="color:red;padding:40px;font-size:16px">‚ùå Init Error: '+e.message+'</div>';}
}

function goHome(){
  curPage=null;killCharts();
  document.querySelectorAll(".page").forEach(function(p){p.classList.remove("active");});
  document.getElementById("backBtn").classList.remove("show");
  document.getElementById("pageLabel").textContent="";
  document.getElementById("mainScroll").scrollTop=0;
  var _fd=getFD();var s=compute(_fd);
  var wr=s.total?((s.wins/s.total)*100).toFixed(1):"0";
  var h='<div class="home fade">';
  h+='<h1><span style="color:var(--green)">'+sIco("swords")+' <span>Bashira</span></h1>';
  h+='<div class="home-sub">Brawl Stars Analytics Dashboard</div>';
  h+='<div class="home-grid">';
  for(var i=0;i<MODS.length;i++){
    var m=MODS[i];
    h+='<div class="hcard" onclick="go(\''+m.id+'\')">';
    h+='<div class="hcard-ico">'+m.ico+'</div>';
    h+='<div><div class="hcard-label">'+m.label+'</div>';
    h+='<div class="hcard-desc">'+m.desc+'</div></div></div>';
  }
  h+='</div>';
  var dr=getDateRange(_fd);
  var _nbSets={};_fd.forEach(function(r){if(r.set_id)_nbSets[r.set_id]=1;});
  var _setCount=Object.keys(_nbSets).length;
  h+='<div style="display:flex;flex-wrap:wrap;justify-content:center;gap:12px;margin-top:20px">';
  // Date range card
  h+='<div style="background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:12px 20px;text-align:center">';
  h+='<div style="font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase;margin-bottom:4px">üìÖ P√©riode</div>';
  h+='<div style="font-family:var(--mono);font-weight:800;font-size:14px;color:var(--green)">'+dr.label+'</div></div>';
  // Games card
  h+='<div style="background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:12px 20px;text-align:center">';
  h+='<div style="font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase;margin-bottom:4px">üéÆ Games</div>';
  h+='<div style="font-family:var(--mono);font-weight:800;font-size:14px">'+s.total+'</div></div>';
  // Sets card
  h+='<div style="background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:12px 20px;text-align:center">';
  h+='<div style="font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase;margin-bottom:4px">‚öî Sets</div>';
  h+='<div style="font-family:var(--mono);font-weight:800;font-size:14px">'+_setCount+'</div></div>';
  // Win Rate card
  h+='<div style="background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:12px 20px;text-align:center">';
  h+='<div style="font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase;margin-bottom:4px">üèÜ Win Rate</div>';
  h+='<div style="font-family:var(--mono);font-weight:800;font-size:14px;color:var(--green)">'+wr+'%</div></div>';
  h+='</div>';
  // Last update line
  var _syncTxt=sheetLastSync==="embedded"?"Donn√©es embarqu√©es ("+_fd.length+" matchs)":(sheetLastSync?("Derni√®re sync : "+sheetLastSync):"Auto-sync Google Sheets");
  var _syncCol=sheetFetchStatus==="ok"?"var(--green)":sheetFetchStatus==="error"?"var(--red)":"var(--t3)";
  h+='<div style="text-align:center;margin-top:12px;font-size:11px;color:var(--t3)"><span style="color:'+_syncCol+'">‚óè</span> '+_syncTxt+' ¬∑ <span style="cursor:pointer;text-decoration:underline;color:var(--t2)" onclick="fetchGoogleSheet()">Rafra√Æchir</span></div>';
  h+='</div>';
  document.getElementById("homeScreen").innerHTML=h;
  document.getElementById("homeScreen").style.display="";
  document.getElementById("demoBanner").style.display=usingDemo?"flex":"none";
}

function go(id){
  try{
  curPage=id;killCharts();
  document.getElementById("homeScreen").style.display="none";
  document.querySelectorAll(".page").forEach(function(p){p.classList.remove("active");});
  var pg=document.getElementById("pg-"+id);pg.classList.add("active");
  document.getElementById("backBtn").classList.add("show");
  var mod=null;for(var i=0;i<MODS.length;i++){if(MODS[i].id===id)mod=MODS[i];}
  document.getElementById("pageLabel").textContent=mod?mod.label:"";
  document.getElementById("mainScroll").scrollTop=0;
  document.getElementById("demoBanner").style.display=usingDemo?"flex":"none";
  var data=getFD(),s=compute(data);
  var fn={overview:pgOverview,meta:pgMeta,brawlers:pgBrawlers,teams:pgTeams,h2h:pgH2H,tracker:pgTracker,draft:pgDraft,players:pgPlayers,maps:pgMaps};
  if(fn[id])fn[id](pg,s,data);
  }catch(e){console.error('Page error ['+id+']:',e);}
}

function buildModePills(){
  var h='<div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:12px">';
  var _ml=MODES.slice();
  h+='<div class="pills" style="margin-bottom:0">';
  h+='<div class="pill '+(filters.mode?"":"white")+'" onclick="filters.mode=\'\';go(curPage)">ALL</div>';
  for(var i=0;i<_ml.length;i++){
    var m=_ml[i];
    h+='<div class="pill '+(filters.mode===m?"green":"")+'" onclick="filters.mode=\''+m+'\';go(curPage)">'+mIco(m)+m.toUpperCase()+'</div>';
  }
  h+='</div>';
  h+='<div style="margin-left:auto;display:flex;gap:4px">';
  var days=[{v:5,l:"5J"},{v:15,l:"15J"},{v:30,l:"30J"},{v:9999,l:"ALL"}];
  for(var d=0;d<days.length;d++){
    var dv=days[d],ac=filters.days===dv.v;
    h+='<div onclick="setDays('+dv.v+')" style="cursor:pointer;padding:5px 10px;border-radius:8px;font-size:11px;font-weight:800;letter-spacing:.5px;transition:all .15s;'+(ac?'background:var(--green);color:#000':'background:var(--bg3);color:var(--t3);border:1px solid var(--border)')+'">'+dv.l+'</div>';
  }
  h+='</div></div>';return h;
}

// ‚ïê‚ïê‚ïê OVERVIEW ‚ïê‚ïê‚ïê
function pgOverview(el,s,data){
  var wr=s.total?((s.wins/s.total)*100).toFixed(1):"0";
  var recent=data.slice().reverse().slice(0,10);
  var h='<div class="fade">'+buildModePills();
  h+='<div class="kpi-row">';
  h+='<div class="kpi"><div class="kpi-label">Total Games</div><div class="kpi-val" style="color:var(--t1)">'+s.total+'</div></div>';
  h+='<div class="kpi"><div class="kpi-label">Win Rate</div><div class="kpi-val" style="color:var(--green)">'+wr+'%</div></div>';
  h+='<div class="kpi"><div class="kpi-label">Victories</div><div class="kpi-val" style="color:var(--green)">'+s.wins+'</div></div>';
  h+='<div class="kpi"><div class="kpi-label">Losses</div><div class="kpi-val" style="color:var(--red)">'+(s.total-s.wins)+'</div></div>';
  h+='</div>';

  // ‚ïê‚ïê‚ïê MVP CARDS ‚ïê‚ïê‚ïê
  var bestBr=(s.brawlers||[]).filter(function(b){return b.p>=3;}).sort(function(a,b){return b.p-a.p;})[0];
  var bestMp=(s.maps||[]).filter(function(m){return m.t>=3;}).sort(function(a,b){return b.t-a.t;})[0];
  // Best team from data
  var ovTM={};
  for(var oi=0;oi<data.length;oi++){var or=data[oi];
    [or.team1_name,or.team2_name].forEach(function(tn,idx){
      if(!tn||tn.indexOf("Unknown")===0)return;
      if(!ovTM[tn])ovTM[tn]={w:0,p:0};ovTM[tn].p++;
      if((idx===0&&or.result==="victory")||(idx===1&&or.result!=="victory"))ovTM[tn].w++;
    });
  }
  var ovTList=[];for(var otk in ovTM){var ot=ovTM[otk];if(ot.p>=3)ovTList.push({name:otk,w:ot.w,p:ot.p,wr:((ot.w/ot.p)*100).toFixed(1)});}
  ovTList.sort(function(a,b){return b.p-a.p;});
  var bestTm=ovTList[0]||null;
  // Best player
  var ovPM={};
  for(var oi2=0;oi2<data.length;oi2++){var or2=data[oi2];
    [or2.player1,or2.player2,or2.player3].filter(Boolean).forEach(function(p){if(!ovPM[p])ovPM[p]={w:0,p:0,team:or2.team1_name||""};ovPM[p].p++;if(or2.result==="victory")ovPM[p].w++;});
    [or2.eplayer1,or2.eplayer2,or2.eplayer3].filter(Boolean).forEach(function(p){if(!ovPM[p])ovPM[p]={w:0,p:0,team:or2.team2_name||""};ovPM[p].p++;if(or2.result!=="victory")ovPM[p].w++;});
  }
  var ovPList=[];for(var opk in ovPM){var op=ovPM[opk];if(op.p>=4)ovPList.push({name:opk,w:op.w,p:op.p,wr:((op.w/op.p)*100).toFixed(1),team:op.team});}
  ovPList.sort(function(a,b){return b.p-a.p;});
  var bestPl=ovPList[0]||null;

  h+='<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:16px">';
  // Best Brawler
  h+='<div style="background:linear-gradient(135deg,rgba(46,204,113,.1),rgba(46,204,113,.02));border:1px solid rgba(46,204,113,.2);border-radius:12px;padding:14px;text-align:center">';
  h+='<div style="font-size:9px;font-weight:800;color:var(--green);text-transform:uppercase;margin-bottom:6px">üèÜ MOST PLAYED</div>';
  if(bestBr){h+=bIcon(bestBr.name,42)+'<div style="font-weight:800;font-size:13px;margin-top:4px">'+bestBr.name+'</div><div style="font-family:var(--mono);font-weight:700;color:var(--green);font-size:18px">'+bestBr.pr+'%</div><div style="font-size:10px;color:var(--t3)">'+bestBr.p+'g ¬∑ usage</div>';}
  else{h+='<div style="color:var(--t3);font-size:11px">-</div>';}
  h+='</div>';
  // Best Map
  h+='<div style="background:linear-gradient(135deg,rgba(52,152,219,.1),rgba(52,152,219,.02));border:1px solid rgba(52,152,219,.2);border-radius:12px;padding:14px;text-align:center">';
  h+='<div style="font-size:9px;font-weight:800;color:#3498db;text-transform:uppercase;margin-bottom:6px">üó∫Ô∏è MOST PLAYED</div>';
  if(bestMp){var _ovMpId=getMapId(bestMp.name);var bmpWr=bestMp.t?((bestMp.w/bestMp.t)*100).toFixed(1):"0";
    if(_ovMpId)h+='<img src="https://cdn.brawlify.com/maps/regular/'+_ovMpId+'.png" style="width:30px;height:40px;border-radius:5px;object-fit:cover;border:1px solid rgba(52,152,219,.3)" onerror="this.style.display=\'none\'">';
    h+='<div style="font-weight:800;font-size:12px;margin-top:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+bestMp.name+'</div><div style="font-family:var(--mono);font-weight:700;color:#3498db;font-size:18px">'+bestMp.t+'g</div><div style="font-size:10px;color:var(--t3)">'+bmpWr+'% wr</div>';}
  else{h+='<div style="color:var(--t3);font-size:11px">-</div>';}
  h+='</div>';
  // Best Team
  h+='<div style="background:linear-gradient(135deg,rgba(241,196,15,.1),rgba(241,196,15,.02));border:1px solid rgba(241,196,15,.2);border-radius:12px;padding:14px;text-align:center">';
  h+='<div style="font-size:9px;font-weight:800;color:#f1c40f;text-transform:uppercase;margin-bottom:6px">üõ°Ô∏è MOST PLAYED</div>';
  if(bestTm){var tI3=teamInfo(bestTm.name);
    h+=teamLogo(bestTm.name,36)+'<div style="font-weight:800;font-size:12px;margin-top:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+(tI3?tI3.org:bestTm.name)+'</div><div style="font-family:var(--mono);font-weight:700;color:#f1c40f;font-size:18px">'+bestTm.p+'g</div><div style="font-size:10px;color:var(--t3)">'+bestTm.wr+'% wr</div>';}
  else{h+='<div style="color:var(--t3);font-size:11px">-</div>';}
  h+='</div>';
  // Best Player
  h+='<div style="background:linear-gradient(135deg,rgba(155,89,182,.1),rgba(155,89,182,.02));border:1px solid rgba(155,89,182,.2);border-radius:12px;padding:14px;text-align:center">';
  h+='<div style="font-size:9px;font-weight:800;color:#9b59b6;text-transform:uppercase;margin-bottom:6px">‚≠ê MOST PLAYED</div>';
  if(bestPl){
    h+='<div style="width:36px;height:36px;border-radius:50%;background:#9b59b6;display:inline-flex;align-items:center;justify-content:center;font-weight:900;font-size:16px;color:#fff">'+bestPl.name.charAt(0).toUpperCase()+'</div>';
    h+='<div style="font-weight:800;font-size:12px;margin-top:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+bestPl.name+'</div><div style="font-family:var(--mono);font-weight:700;color:#9b59b6;font-size:18px">'+bestPl.p+'g</div><div style="font-size:10px;color:var(--t3)">'+bestPl.wr+'% wr</div>';}
  else{h+='<div style="color:var(--t3);font-size:11px">-</div>';}
  h+='</div>';
  h+='</div>';

  h+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:16px">';
  h+='<div class="card"><div class="card-t">WR Timeline</div><div class="chart-box"><canvas id="chTL"></canvas></div></div>';
  h+='<div class="card"><div class="card-t">WR by Mode</div><div class="chart-box"><canvas id="chM"></canvas></div></div>';
  h+='</div>';

  h+='</div>';
  el.innerHTML=h;
  if(s.timeline.length)mChart("chTL","line",{labels:s.timeline.map(function(d){return d.date;}),datasets:[{data:s.timeline.map(function(d){return +d.wr;}),borderColor:"#2ecc71",backgroundColor:"rgba(46,204,113,.06)",fill:true,tension:.3,pointRadius:3,pointBackgroundColor:"#2ecc71",borderWidth:2}]},{scales:{x:{ticks:{color:"#666"},grid:{color:"rgba(42,42,42,.25)"}},y:{min:0,max:100,ticks:{color:"#666"},grid:{color:"rgba(42,42,42,.25)"}}}});
  if(s.modes&&s.modes.length)mChart("chM","bar",{labels:s.modes.map(function(m){return m.name;}),datasets:[{data:s.modes.map(function(m){return +m.wr;}),backgroundColor:s.modes.map(function(m){return(MC[m.name]||"#666")+"80";}),borderColor:s.modes.map(function(m){return MC[m.name]||"#666";}),borderWidth:1,borderRadius:6}]},{scales:{x:{ticks:{color:"#666"},grid:{display:false}},y:{min:0,max:100,ticks:{color:"#666"},grid:{color:"rgba(42,42,42,.25)"}}}});
}

// ‚ïê‚ïê‚ïê META ‚ïê‚ïê‚ïê
function pgMeta(el,s){
  var list=s.brawlers.filter(function(b){return b.p>=3;});
  list.sort(function(a,b){return b.p-a.p;});
  var h='<div class="fade"><div style="display:flex;align-items:center;gap:10px;margin-bottom:20px"><span style="font-size:22px;display:inline-flex">‚òÖ</span><span style="font-size:24px;font-weight:900">META RANKINGS</span></div>';
  h+=buildModePills();
  h+='<input class="search-box" id="metaSearch" placeholder="‚åï Search brawler..." oninput="filterMeta()">';
  var dr=getDateRange(getFD());
  h+='<div style="font-size:13px;color:var(--t3);margin-bottom:10px">'+dr.label+' ¬∑ '+s.total+' games ¬∑ üìÖ Mise √† jour quotidienne</div>';
  h+='<div class="card" style="padding:0;overflow:hidden"><table><thead><tr><th>#</th><th>Brawler</th><th>Win Rate</th><th>Pick Rate</th><th>Best Mode</th><th>Best Map</th><th>Games</th></tr></thead><tbody id="mBody">';
  for(var i=0;i<list.length;i++){
    var b=list[i];
    // Find best map for this brawler (min 2 picks)
    var bestMap=null,bestMapWr=0;
    for(var mk in b.maps){var mm=b.maps[mk];if(mm.n>=2){var mwr=(mm.w/mm.n)*100;if(mwr>bestMapWr){bestMapWr=mwr;bestMap={name:mk,wr:mwr.toFixed(0),n:mm.n};}}}
    h+='<tr data-n="'+b.name.toLowerCase()+'"><td style="font-weight:800;color:var(--green)">#'+(i+1)+'</td>';
    h+='<td><div class="brawler-cell">'+bIcon(b.name,40)+'<span style="font-weight:700">'+b.name+'</span></div></td>';
    h+='<td class="'+wrCol(b.wr)+'">'+b.wr+'%</td>';
    h+='<td style="font-family:var(--mono);color:var(--t2)">'+b.pr+'%</td>';
    h+='<td style="font-size:12px">'+mIco(b.bestMode)+' <span style="font-weight:600">'+b.bestMode+'</span></td>';
    h+='<td>';
    if(bestMap){
      var _bmId=getMapId(bestMap.name);
      h+='<div style="display:flex;align-items:center;gap:5px">';
      if(_bmId)h+='<img src="https://cdn.brawlify.com/maps/regular/'+_bmId+'.png" style="width:18px;height:24px;border-radius:3px;object-fit:cover" onerror="this.style.display=\'none\'">';
      h+='<span style="font-size:11px;font-weight:600;color:var(--t2);max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">'+bestMap.name+'</span>';
      h+='<span style="font-size:10px;font-weight:700;color:var(--green);font-family:var(--mono)">'+bestMap.wr+'%</span>';
      h+='</div>';
    }else{h+='<span style="color:var(--t3);font-size:11px">-</span>';}
    h+='</td>';
    h+='<td style="font-family:var(--mono);font-weight:700">'+b.p+'</td></tr>';
  }
  h+='</tbody></table></div></div>';
  el.innerHTML=h;
}
function filterMeta(){var v=document.getElementById("metaSearch").value.toLowerCase();document.querySelectorAll("#mBody tr").forEach(function(r){r.style.display=r.dataset.n.indexOf(v)>=0?"":"none";});}

// ‚ïê‚ïê‚ïê BRAWLERS ‚ïê‚ïê‚ïê
function pgBrawlers(el,s){
  var allB=s.brawlers.map(function(b){return b.name;}).sort(bSort);
  var h='<div class="fade"><div style="display:grid;grid-template-columns:300px 1fr;gap:20px">';
  h+='<div><input class="search-box" id="bSearch" placeholder="Search Brawler..." oninput="filterBGrid()" style="max-width:100%">';
  h+='<div class="pills" id="bCPills"><div class="pill white" onclick="setBCF(\'\')">ALL</div>';
  for(var ci=0;ci<CLASSES.length;ci++){var c=CLASSES[ci];h+='<div class="pill" onclick="setBCF(\''+c+'\')">'+clsIco(c,14)+' '+c.toUpperCase()+'</div>';}
  h+='</div>';
  h+='<div class="b-grid" id="bGrid">';
  for(var i=0;i<allB.length;i++){
    var b=allB[i];var src=bImgSrc(b);
    h+='<div class="b-icon" style="background:'+bc(b)+'" onclick="showB(\''+b.replace(/'/g,"\\'")+'\');" title="'+b+'" data-b="'+b+'" data-cls="'+(BCLS[b]||"")+'">';
    if(src)h+='<img src="'+src+'" style="width:100%;height:100%;object-fit:cover;border-radius:8px;position:absolute;top:0;left:0" onerror="this.style.display=\'none\'">';
    h+='<div class="b-icon-name">'+b+'</div></div>';
  }
  h+='</div></div><div id="bP"><div style="color:var(--t3);text-align:center;padding:60px">‚Üê Select a brawler</div></div></div></div>';
  el.innerHTML=h;
}
var _bcf="";
function setBCF(c){_bcf=c;var pills=document.querySelectorAll("#bCPills .pill");pills.forEach(function(p){p.classList.remove("white","green");});if(!c)pills[0].classList.add("white");else pills.forEach(function(p){if(p.textContent.toUpperCase().indexOf(c.toUpperCase())>=0)p.classList.add("green");});filterBGrid();}
function filterBGrid(){var v=document.getElementById("bSearch").value.toLowerCase();document.querySelectorAll("#bGrid .b-icon").forEach(function(e){var nm=e.dataset.b.toLowerCase().indexOf(v)>=0;var cm=!_bcf||e.dataset.cls===_bcf;e.style.display=(nm&&cm)?"":"none";});}

function showB(name){
  var s=compute(getFD()),b=null;
  for(var i=0;i<s.brawlers.length;i++){if(s.brawlers[i].name===name){b=s.brawlers[i];break;}}
  if(!b)return;
  document.querySelectorAll("#bGrid .b-icon").forEach(function(e){e.classList.toggle("sel",e.title===name);});
  var modeE=[];for(var mk in b.modes){var md=b.modes[mk];modeE.push({name:mk,wr:((md.w/md.n)*100).toFixed(1),n:md.n});}
  modeE.sort(function(a,c){return(+c.wr)-(+a.wr);});
  var mapE=[];for(var mpk in b.maps){var mp=b.maps[mpk];mapE.push({name:mpk,wr:((mp.w/mp.n)*100).toFixed(1),w:mp.w,n:mp.n});}
  mapE.sort(function(a,c){return(+c.wr)-(+a.wr);});

  // Synergies (best teammates)
  var synArr=[];for(var sk in s.synergies){var sy=s.synergies[sk];if(sy.a===name||sy.b===name){var mate=sy.a===name?sy.b:sy.a;if(sy.t>=3)synArr.push({name:mate,wr:((sy.w/sy.t)*100).toFixed(1),w:sy.w,t:sy.t});}}
  synArr.sort(function(a,c){return(+c.wr)-(+a.wr);});
  var bestMates=synArr.slice(0,5);
  var worstMates=synArr.length>5?synArr.slice(-3).reverse():[];

  // Counters
  var cntArr=[];var cntByArr=[];
  for(var ck in s.counters){var ct=s.counters[ck];
    if(ct.brawler===name&&ct.t>=3){cntArr.push({name:ct.enemy,wr:((ct.w/ct.t)*100).toFixed(1),w:ct.w,t:ct.t});}
    if(ct.enemy===name&&ct.t>=3){cntByArr.push({name:ct.brawler,wr:((ct.w/ct.t)*100).toFixed(1),w:ct.w,t:ct.t});}
  }
  cntArr.sort(function(a,c){return(+c.wr)-(+a.wr);});
  cntByArr.sort(function(a,c){return(+c.wr)-(+a.wr);});
  var bestVs=cntArr.slice(0,5);
  var worstVs=cntArr.length>3?cntArr.slice(-3).reverse():[];
  var counteredBy=cntByArr.slice(0,5);

  var tier=getTier(b.wr);
  var h='<div class="card fade">';
  // Header with image
  h+='<div style="display:flex;align-items:center;gap:14px;margin-bottom:20px">'+bIcon(name,72);
  h+='<div><div style="font-size:26px;font-weight:900;text-transform:uppercase">'+name+'</div>';
  h+='<span style="padding:3px 8px;border-radius:4px;font-size:11px;font-weight:700;font-family:var(--mono);background:'+TC[tier]+'20;color:'+TC[tier]+'">'+tier+' Tier</span>';
  if(BCLS[name])h+=' <span style="padding:3px 8px;border-radius:4px;font-size:10px;font-weight:600;background:var(--bg4);color:var(--t2)">'+clsIco(BCLS[name],14)+' '+BCLS[name]+'</span>';
  h+='</div></div>';

  // Stats cards
  h+='<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:20px">';
  h+='<div style="background:var(--bg3);border-radius:8px;padding:12px;text-align:center"><div style="font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase">Win Rate</div><div style="font-size:22px;font-weight:800;font-family:var(--mono);color:'+wrHex(b.wr)+'">'+b.wr+'%</div></div>';
  h+='<div style="background:var(--bg3);border-radius:8px;padding:12px;text-align:center"><div style="font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase">Pick Rate</div><div style="font-size:22px;font-weight:800;font-family:var(--mono)">'+b.pr+'%</div></div>';
  h+='<div style="background:var(--bg3);border-radius:8px;padding:12px;text-align:center"><div style="font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase">Sets</div><div style="font-size:22px;font-weight:800;font-family:var(--mono)">'+b.p+'</div></div>';
  h+='</div>';

  // ‚ïê‚ïê‚ïê BEST COMBOS (Synergies) ‚ïê‚ïê‚ïê
  if(bestMates.length){
    h+='<div class="card-t">‚ö° Best Combos</div><div style="margin-bottom:16px">';
    for(var ci=0;ci<bestMates.length;ci++){var cm2=bestMates[ci];
      var barW=Math.min(+cm2.wr,100);
      h+='<div style="display:flex;align-items:center;gap:8px;padding:7px 0;border-bottom:1px solid var(--border)">';
      h+=bIconSm(cm2.name);
      h+='<span style="flex:1;font-weight:600;font-size:13px">'+cm2.name+'</span>';
      h+='<div style="width:80px;height:6px;background:var(--bg4);border-radius:3px;overflow:hidden"><div style="height:100%;width:'+barW+'%;background:'+wrHex(cm2.wr)+';border-radius:3px"></div></div>';
      h+='<span class="'+wrCol(cm2.wr)+'" style="font-family:var(--mono);font-weight:700;font-size:13px;min-width:52px;text-align:right">'+cm2.wr+'%</span>';
      h+='<span style="font-size:10px;color:var(--t3);min-width:30px;text-align:right">'+cm2.t+'g</span></div>';
    }
    if(worstMates.length){
      h+='<div style="margin-top:10px;font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase;margin-bottom:4px">‚ñº Worst Synergies</div>';
      for(var wi=0;wi<worstMates.length;wi++){var wm=worstMates[wi];
        h+='<div style="display:flex;align-items:center;gap:8px;padding:5px 0;border-bottom:1px solid var(--border)">';
        h+=bIconSm(wm.name)+'<span style="flex:1;font-weight:600;font-size:12px;color:var(--t2)">'+wm.name+'</span>';
        h+='<span class="'+wrCol(wm.wr)+'" style="font-family:var(--mono);font-weight:700;font-size:12px">'+wm.wr+'%</span>';
        h+='<span style="font-size:10px;color:var(--t3)">'+wm.t+'g</span></div>';
      }
    }
    h+='</div>';
  }

  // ‚ïê‚ïê‚ïê COUNTERS ‚ïê‚ïê‚ïê
  if(bestVs.length||counteredBy.length){
    h+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px">';
    // Beats
    h+='<div><div class="card-t">'+sIco("up")+name+' beats</div>';
    if(bestVs.length){for(var vi=0;vi<bestVs.length;vi++){var bv=bestVs[vi];
      h+='<div style="display:flex;align-items:center;gap:6px;padding:5px 0;border-bottom:1px solid var(--border)">';
      h+=bIconSm(bv.name)+'<span style="flex:1;font-weight:600;font-size:12px">'+bv.name+'</span>';
      h+='<span class="'+wrCol(bv.wr)+'" style="font-family:var(--mono);font-weight:700;font-size:12px">'+bv.wr+'%</span>';h+='<span style="font-size:10px;color:var(--t3);min-width:26px;text-align:right">'+bv.t+'g</span></div>';
    }}else{h+='<div style="color:var(--t3);font-size:12px;padding:8px 0">No data</div>';}
    if(worstVs.length){
      h+='<div style="margin-top:8px;font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase;margin-bottom:2px">Struggles vs</div>';
      for(var wvi=0;wvi<worstVs.length;wvi++){var wv=worstVs[wvi];
        h+='<div style="display:flex;align-items:center;gap:6px;padding:4px 0;border-bottom:1px solid var(--border)">';
        h+=bIconSm(wv.name)+'<span style="flex:1;font-size:11px;color:var(--t2)">'+wv.name+'</span>';
        h+='<span class="'+wrCol(wv.wr)+'" style="font-family:var(--mono);font-size:11px">'+wv.wr+'%</span>';h+='<span style="font-size:10px;color:var(--t3)">'+wv.t+'g</span></div>';
      }
    }
    h+='</div>';
    // Countered by
    h+='<div><div class="card-t">‚ñº Countered by</div>';
    if(counteredBy.length){for(var cbi=0;cbi<counteredBy.length;cbi++){var cb=counteredBy[cbi];
      h+='<div style="display:flex;align-items:center;gap:6px;padding:5px 0;border-bottom:1px solid var(--border)">';
      h+=bIconSm(cb.name)+'<span style="flex:1;font-weight:600;font-size:12px">'+cb.name+'</span>';
      h+='<span class="'+wrCol(cb.wr)+'" style="font-family:var(--mono);font-weight:700;font-size:12px">'+cb.wr+'%</span>';h+='<span style="font-size:10px;color:var(--t3);min-width:26px;text-align:right">'+cb.t+'g</span></div>';
    }}else{h+='<div style="color:var(--t3);font-size:12px;padding:8px 0">No data</div>';}
    h+='</div></div>';
  }

  // ‚ïê‚ïê‚ïê WR BY MODE ‚ïê‚ïê‚ïê
  h+='<div class="card-t">'+sIco("wrmode")+'WR by Mode</div><div style="margin-bottom:16px">';
  for(var mi=0;mi<modeE.length;mi++){var me=modeE[mi];
    var mBarW=Math.min(+me.wr,100);
    h+='<div style="display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid var(--border)">';
    h+=mIco(me.name);
    h+='<span style="flex:1;font-weight:600;font-size:13px">'+me.name+'</span>';
    h+='<div style="width:80px;height:6px;background:var(--bg4);border-radius:3px;overflow:hidden"><div style="height:100%;width:'+mBarW+'%;background:'+wrHex(me.wr)+';border-radius:3px"></div></div>';
    h+='<span class="'+wrCol(me.wr)+'" style="font-family:var(--mono);font-weight:700;font-size:13px;min-width:48px;text-align:right">'+me.wr+'%</span>';
    h+='<span style="font-size:10px;color:var(--t3);min-width:30px;text-align:right">'+me.n+'g</span></div>';
  }
  h+='</div>';

  // ‚ïê‚ïê‚ïê BEST & WORST MAPS ‚ïê‚ïê‚ïê
  if(mapE.length){
    // Best map highlight
    var bestMapB=mapE[0];
    var bmMode="";for(var bmi=0;bmi<matchData.length;bmi++){if(matchData[bmi].map===bestMapB.name){bmMode=matchData[bmi].mode;break;}}
    var _bmMapId=getMapId(bestMapB.name);
    h+='<div style="background:linear-gradient(135deg,rgba(46,204,113,.1),rgba(46,204,113,.02));border:1px solid rgba(46,204,113,.2);border-radius:12px;padding:14px;margin-bottom:14px;display:flex;align-items:center;gap:14px">';
    if(_bmMapId)h+='<img src="https://cdn.brawlify.com/maps/regular/'+_bmMapId+'.png" style="width:36px;height:48px;border-radius:6px;object-fit:cover;border:1px solid rgba(46,204,113,.3)" onerror="this.style.display=\'none\'">';
    h+='<div style="flex:1"><div style="font-size:10px;font-weight:800;color:var(--green);text-transform:uppercase">üèÜ BEST MAP</div>';
    h+='<div style="font-weight:800;font-size:14px">'+bestMapB.name+'</div>';
    h+='<div style="font-size:11px;color:'+(MC[bmMode]||"var(--t3)")+';display:flex;align-items:center;gap:3px">'+mIco(bmMode)+bmMode+'</div></div>';
    h+='<div style="text-align:right"><div style="font-family:var(--mono);font-weight:900;font-size:22px;color:var(--green)">'+bestMapB.wr+'%</div>';
    h+='<div style="font-size:10px;color:var(--t3)">'+bestMapB.n+' games</div></div></div>';
  }
  h+='<div class="card-t">'+sIco("map")+'Best Maps</div><div class="map-grid" style="margin-bottom:12px">';
  var topMaps=mapE.slice(0,Math.min(6,mapE.length));
  for(var j=0;j<topMaps.length;j++){
    var mp2=topMaps[j];var mode2="";
    for(var k=0;k<matchData.length;k++){if(matchData[k].map===mp2.name){mode2=matchData[k].mode;break;}}
    var _mId=getMapId(mp2.name);
    h+='<div class="map-card"><div class="map-card-top" style="background:'+(MC[mode2]||"#666")+';position:relative;height:'+ (_mId?'80px':'28px') +'">';
    if(_mId)h+='<img src="https://cdn.brawlify.com/maps/regular/'+_mId+'.png" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;opacity:.5" loading="lazy" onerror="this.style.display=\'none\'">';
    h+='<span style="position:relative;z-index:1">'+(mode2||"MAP")+'</span></div>';
    h+='<div class="map-card-body"><div class="map-card-name">'+mp2.name+'</div>';
    h+='<div class="map-card-wr" style="color:'+wrHex(mp2.wr)+'">'+mp2.wr+'%</div>';
    h+='<div class="map-card-sub">'+mp2.w+'W '+(mp2.n-mp2.w)+'L</div></div></div>';
  }
  h+='</div>';
  if(mapE.length>3){
    var worstMaps=mapE.slice(-Math.min(3,mapE.length-3)).reverse();
    h+='<div class="card-t" style="color:var(--red)">'+sIco("down")+'Worst Maps</div><div class="map-grid">';
    for(var wj=0;wj<worstMaps.length;wj++){
      var wmp=worstMaps[wj];var wmode="";
      for(var wk=0;wk<matchData.length;wk++){if(matchData[wk].map===wmp.name){wmode=matchData[wk].mode;break;}}
      var _wmId=getMapId(wmp.name);
      h+='<div class="map-card" style="border-color:rgba(231,76,60,.2)"><div class="map-card-top" style="background:'+(MC[wmode]||"#666")+';position:relative;height:'+(_wmId?'80px':'28px')+'">';
      if(_wmId)h+='<img src="https://cdn.brawlify.com/maps/regular/'+_wmId+'.png" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;opacity:.4" loading="lazy" onerror="this.style.display=\'none\'">';
      h+='<span style="position:relative;z-index:1">'+(wmode||"MAP")+'</span></div>';
      h+='<div class="map-card-body"><div class="map-card-name">'+wmp.name+'</div>';
      h+='<div class="map-card-wr" style="color:var(--red)">'+wmp.wr+'%</div>';
      h+='<div class="map-card-sub">'+wmp.w+'W '+(wmp.n-wmp.w)+'L</div></div></div>';
    }
    h+='</div>';
  }

  h+='</div>';
  document.getElementById("bP").innerHTML=h;
}

// ‚ïê‚ïê‚ïê TEAMS ‚ïê‚ïê‚ïê
function genTeamData(){
  var data=matchData;
  if(filters.days&&filters.days<9999){var mx=null;for(var _i=0;_i<matchData.length;_i++){if(!matchData[_i].date)continue;var rd=_pd(matchData[_i].date);if(!isNaN(rd)&&(!mx||rd>mx))mx=rd;}if(mx){var cut=new Date(mx.getTime()-filters.days*86400000);data=matchData.filter(function(r){if(!r.date)return false;var rd2=_pd(r.date);return !isNaN(rd2)&&rd2>=cut;});}}
  var tmap={};
  data.forEach(function(r){
    [r.team1_name,r.team2_name].forEach(function(tn){
      if(!tn||tn==="unknown")return;
      if(!tmap[tn])tmap[tn]={name:tn,games:[],setsW:0,setsL:0,region:"",tier:"",players:{},playerBrawlers:{},modeMap:{},mapMap:{},brawlerMap:{},h2hMap:{},dailyMap:{},scrims:[]};
    });
  });
  data.forEach(function(r){
    var t1=r.team1_name,t2=r.team2_name;
    var isWin1=r.result==="victory";
    if(tmap[t1]){
      var td=tmap[t1];
      td.games.push(r);
      if(r.region1&&r.region1!=="unknown")td.region=r.region1;
      if(r.tier1&&r.tier1!=="unknown")td.tier=td.tier||r.tier1;
      var pls=[r.player1,r.player2,r.player3],brs=[r.brawler1,r.brawler2,r.brawler3];
      for(var pi=0;pi<3;pi++){var p=pls[pi],b=brs[pi];if(p){td.players[p]=1;if(b){if(!td.playerBrawlers[p])td.playerBrawlers[p]={};if(!td.playerBrawlers[p][b])td.playerBrawlers[p][b]={w:0,p:0};td.playerBrawlers[p][b].p++;if(isWin1)td.playerBrawlers[p][b].w++;}}}
      [r.brawler1,r.brawler2,r.brawler3].forEach(function(b){if(b){if(!td.brawlerMap[b])td.brawlerMap[b]={w:0,p:0};td.brawlerMap[b].p++;if(isWin1)td.brawlerMap[b].w++;}});
      if(r.mode){if(!td.modeMap[r.mode])td.modeMap[r.mode]={w:0,l:0};if(isWin1)td.modeMap[r.mode].w++;else td.modeMap[r.mode].l++;}
      if(r.map){if(!td.mapMap[r.map])td.mapMap[r.map]={w:0,l:0};if(isWin1)td.mapMap[r.map].w++;else td.mapMap[r.map].l++;}
      if(t2&&tmap[t2]){if(!td.h2hMap[t2])td.h2hMap[t2]={w:0,l:0};if(isWin1)td.h2hMap[t2].w++;else td.h2hMap[t2].l++;}
      if(r.date){if(!td.dailyMap[r.date])td.dailyMap[r.date]={w:0,t:0};td.dailyMap[r.date].t++;if(isWin1)td.dailyMap[r.date].w++;}
    }
    if(tmap[t2]){
      var td2=tmap[t2];
      td2.games.push(r);
      if(r.region2&&r.region2!=="unknown")td2.region=r.region2;
      if(r.tier2&&r.tier2!=="unknown")td2.tier=td2.tier||r.tier2;
      var pls2=[r.eplayer1,r.eplayer2,r.eplayer3],brs2=[r.enemy1,r.enemy2,r.enemy3];
      for(var pi2=0;pi2<3;pi2++){var p2=pls2[pi2],b2=brs2[pi2];if(p2){td2.players[p2]=1;if(b2){if(!td2.playerBrawlers[p2])td2.playerBrawlers[p2]={};if(!td2.playerBrawlers[p2][b2])td2.playerBrawlers[p2][b2]={w:0,p:0};td2.playerBrawlers[p2][b2].p++;if(!isWin1)td2.playerBrawlers[p2][b2].w++;}}}
      [r.enemy1,r.enemy2,r.enemy3].forEach(function(b){if(b){if(!td2.brawlerMap[b])td2.brawlerMap[b]={w:0,p:0};td2.brawlerMap[b].p++;if(!isWin1)td2.brawlerMap[b].w++;}});
      if(r.mode){if(!td2.modeMap[r.mode])td2.modeMap[r.mode]={w:0,l:0};if(!isWin1)td2.modeMap[r.mode].w++;else td2.modeMap[r.mode].l++;}
      if(r.map){if(!td2.mapMap[r.map])td2.mapMap[r.map]={w:0,l:0};if(!isWin1)td2.mapMap[r.map].w++;else td2.mapMap[r.map].l++;}
      if(t1&&tmap[t1]){if(!td2.h2hMap[t1])td2.h2hMap[t1]={w:0,l:0};if(!isWin1)td2.h2hMap[t1].w++;else td2.h2hMap[t1].l++;}
      if(r.date){if(!td2.dailyMap[r.date])td2.dailyMap[r.date]={w:0,t:0};td2.dailyMap[r.date].t++;if(!isWin1)td2.dailyMap[r.date].w++;}
    }
  });
  var setResults={};
  data.forEach(function(r){
    if(!r.set_id||!r.set_score)return;
    if(setResults[r.set_id])return;
    setResults[r.set_id]=r;
  });
  Object.keys(tmap).forEach(function(tn){
    var td=tmap[tn];td.setsW=0;td.setsL=0;
    var counted={};
    td.games.forEach(function(g){
      if(!g.set_id||!g.set_score||counted[g.set_id])return;
      counted[g.set_id]=1;
      var parts=g.set_score.split("-").map(Number);
      var isT1=g.team1_name===tn;
      var sw=isT1?parts[0]:parts[1],sl=isT1?parts[1]:parts[0];
      if(sw>sl)td.setsW++;else if(sl>sw)td.setsL++;
    });
  });
  var teams=[];
  var regionMap={NORTHAMERICA:"NA",EMEA:"EMEA",SOUTHAMERICA:"SA",EASTASIA:"APAC",SOUTHEASTASIA:"APAC",unknown:""};
  Object.keys(tmap).forEach(function(tn){
    var td=tmap[tn];
    var totalG=td.games.length;
    if(totalG<2)return;
    var wG=td.games.filter(function(g){return(g.team1_name===tn&&g.result==="victory")||(g.team2_name===tn&&g.result!=="victory");}).length;
    var totalS=td.setsW+td.setsL;
    var wr=totalS?((td.setsW/totalS)*100).toFixed(1):"0";
    var dbInfo=TEAMS_DB[tn]||null;
    var region=dbInfo?dbInfo.region:(regionMap[td.region]||td.region||"");
    var tag=dbInfo?dbInfo.tag:tn.replace(/[^A-Z0-9]/gi,"").slice(0,3).toUpperCase();
    var color=dbInfo?dbInfo.color:bc(tn);
    var players=Object.keys(td.players);
    var form=[];var counted2={};
    var sortedG=td.games.slice().sort(function(a,b){return a.date>b.date?1:-1;});
    for(var i=sortedG.length-1;i>=0&&form.length<5;i--){
      var g=sortedG[i];if(!g.set_id||!g.set_score||counted2[g.set_id])continue;
      counted2[g.set_id]=1;
      var pp=g.set_score.split("-").map(Number);
      var isT=g.team1_name===tn;
      form.push((isT?pp[0]:pp[1])>(isT?pp[1]:pp[0])?"W":"L");
    }
    var modeStats=[];Object.keys(td.modeMap).forEach(function(m){var ms=td.modeMap[m];modeStats.push({mode:m,w:ms.w,l:ms.l,wr:((ms.w/(ms.w+ms.l))*100).toFixed(1)});});
    modeStats.sort(function(a,b){return(b.w+b.l)-(a.w+a.l);});
    var mapStats=[];Object.keys(td.mapMap).forEach(function(m){var ms=td.mapMap[m];mapStats.push({map:m,w:ms.w,l:ms.l,wr:((ms.w/(ms.w+ms.l))*100).toFixed(1)});});
    mapStats.sort(function(a,b){return(+b.wr)-(+a.wr);});
    var topB=[];Object.keys(td.brawlerMap).forEach(function(b){var bs=td.brawlerMap[b];topB.push({name:b,w:bs.w,p:bs.p,wr:((bs.w/bs.p)*100).toFixed(1)});});
    topB.sort(function(a,b){return b.p-a.p;});
    var h2h=[];Object.keys(td.h2hMap).forEach(function(vs){var hs=td.h2hMap[vs];h2h.push({vs:vs,w:hs.w,l:hs.l,wr:((hs.w/(hs.w+hs.l))*100).toFixed(1)});});
    h2h.sort(function(a,b){return(b.w+b.l)-(a.w+a.l);});
    var days=[];Object.keys(td.dailyMap).sort().forEach(function(d){days.push({d:d,w:td.dailyMap[d].w,t:td.dailyMap[d].t});});
    var scrimMap={};var counted3={};
    sortedG.forEach(function(g){
      if(!g.set_id||counted3[g.set_id])return;counted3[g.set_id]=1;
      var vs=g.team1_name===tn?g.team2_name:g.team1_name;
      var key=g.date+"_"+vs;
      if(!scrimMap[key])scrimMap[key]={date:g.date,vs:vs,w:0,l:0};
      var pp2=g.set_score.split("-").map(Number);
      var isT2=g.team1_name===tn;
      if((isT2?pp2[0]:pp2[1])>(isT2?pp2[1]:pp2[0]))scrimMap[key].w++;else scrimMap[key].l++;
    });
    var scrims=[];Object.keys(scrimMap).forEach(function(k){scrims.push(scrimMap[k]);});
    scrims.sort(function(a,b){return a.date>b.date?-1:1;});
    var lastDate=scrims.length?scrims[0].date:"-";
    // Build player brawler data for roster
    var playerData=[];
    players.forEach(function(pn){
      var pbMap=td.playerBrawlers[pn]||{};
      var pbList=[];Object.keys(pbMap).forEach(function(b){pbList.push({name:b,w:pbMap[b].w,p:pbMap[b].p,wr:pbMap[b].p?((pbMap[b].w/pbMap[b].p)*100).toFixed(0):"0"});});
      pbList.sort(function(a,b){return(+b.wr)-(+a.wr)||(b.p-a.p);});
      var totalP=0;pbList.forEach(function(x){totalP+=x.p;});
      playerData.push({name:pn,brawlers:pbList.slice(0,5),games:totalP});
    });
    playerData.sort(function(a,b){return b.games-a.games;});
    var displayName=dbInfo?dbInfo.org:tn;
    var isUnknown=tn.indexOf("Unknown")===0;
    teams.push({name:tn,displayName:displayName,tag:tag,region:region,color:color,players:players,playerData:playerData,wr:wr,w:td.setsW,l:td.setsL,t:totalS,tier:getTier(Math.round(+wr)),form:form,days:days,modeStats:modeStats,mapStats:mapStats,topB:topB,h2h:h2h,scrims:scrims.slice(0,10),lastDate:lastDate,dbInfo:dbInfo,isUnknown:isUnknown});
  });
  teams.sort(function(a,b){return a.lastDate>b.lastDate?-1:a.lastDate<b.lastDate?1:(+b.wr)-(+a.wr);});
  return teams;
}

function pgTeams(el,s){
  var teams=genTeamData();
  // Known teams (in TEAMS_DB) show with 2+ sets, unknown teams need 20+
  teams=teams.filter(function(t){return t.dbInfo?t.t>=2:t.t>=20;});
  var knownTeams=teams.filter(function(t){return !t.isUnknown;});
  var unknownTeams=teams.filter(function(t){return t.isUnknown;});
  var h='<div class="fade">';
  h+='<div style="display:flex;align-items:center;gap:10px;margin-bottom:16px"><span style="font-size:24px;font-weight:900">TEAM STATS (SET)</span><span style="font-size:13px;color:var(--t3)">'+teams.length+' teams</span></div>';
  var rSet={};teams.forEach(function(t){if(t.region)rSet[t.region]=1;});
  var regions=Object.keys(rSet).sort();
  h+='<div class="pills" id="regionPills"><div class="pill white" onclick="filterTeams(\'ALL\')">ALL REGIONS</div>';
  for(var r=0;r<regions.length;r++){h+='<div class="pill" onclick="filterTeams(\''+regions[r]+'\')">'+regions[r]+'</div>';}
  h+='</div>';
  h+='<input class="search-box" id="teamSearch" placeholder="‚åï Search team..." oninput="filterTeamSearch()">';
  // Known teams section
  if(knownTeams.length){
    h+='<div style="margin-bottom:8px;margin-top:16px"><span style="font-weight:800;font-size:16px;color:var(--t1)">KNOWN TEAMS</span><span style="font-size:12px;color:var(--t3);margin-left:8px">('+knownTeams.length+')</span></div>';
    var tiers=["S","A","B","C","D","F"];
    for(var ti=0;ti<tiers.length;ti++){
      var tier=tiers[ti];
      var tierTeams=knownTeams.filter(function(t){return t.tier===tier;});
      if(!tierTeams.length)continue;
      h+='<div class="tier-section" style="margin-bottom:24px">';
      h+='<div style="display:flex;align-items:center;gap:8px;margin-bottom:12px"><div style="width:32px;height:32px;border-radius:6px;background:'+TC[tier]+'20;color:'+TC[tier]+';display:flex;align-items:center;justify-content:center;font-weight:900;font-size:16px;font-family:var(--mono)">'+tier+'</div><span style="font-weight:800;font-size:16px;color:'+TC[tier]+'">TIER '+tier+'</span><span style="font-size:12px;color:var(--t3)">('+tierTeams.length+' teams)</span></div>';
      h+='<div class="team-grid">';
      for(var j=0;j<tierTeams.length;j++){
        var tm=tierTeams[j];
        h+=renderTeamCard(tm);
      }
      h+='</div></div>';
    }
  }
  // Unknown teams section
  if(unknownTeams.length){
    h+='<div style="margin-bottom:8px;margin-top:24px"><span style="font-weight:800;font-size:16px;color:var(--t2)">OTHER TEAMS</span><span style="font-size:12px;color:var(--t3);margin-left:8px">('+unknownTeams.length+')</span></div>';
    h+='<div class="team-grid">';
    for(var u=0;u<unknownTeams.length;u++){
      h+=renderTeamCard(unknownTeams[u]);
    }
    h+='</div>';
  }
  h+='</div>';
  el.innerHTML=h;
}
function renderTeamCard(tm){
  var wrC=(+tm.wr)>=50?"var(--green)":"var(--red)";
  var safeN=tm.name.replace(/'/g,"\\'").replace(/"/g,"&quot;");
  var logoHtml=teamLogo(tm.name,36);
  var h='<div class="tc" data-team="'+safeN+'" data-region="'+tm.region+'" onclick="showTeam(\''+safeN+'\')" style="cursor:pointer">';
  h+='<div class="tc-head">';
  if(logoHtml){h+=logoHtml;}
  else{h+='<div class="tc-logo" style="background:'+tm.color+'">'+tm.tag+'</div>';}
  h+='<div><div class="tc-name">'+tm.displayName+'</div><div class="tc-sub">'+(tm.region?tm.region+' ¬∑ ':'')+tm.players.length+' players ¬∑ '+tm.t+' sets</div></div></div>';
  // Player brawler icons row
  if(tm.playerData&&tm.playerData.length){
    h+='<div style="padding:6px 0;border-bottom:1px solid var(--border)">';
    for(var pi=0;pi<Math.min(3,tm.playerData.length);pi++){
      var pd=tm.playerData[pi];
      h+='<div style="display:flex;align-items:center;gap:4px;padding:2px 0">';
      h+='<span style="font-size:11px;font-weight:600;color:var(--t2);min-width:80px;max-width:100px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" title="'+pd.name.replace(/"/g,"&quot;")+'">'+pd.name+'</span>';
      for(var bi=0;bi<Math.min(3,pd.brawlers.length);bi++){
        h+=bIconSm(pd.brawlers[bi].name);
      }
      h+='<span style="font-size:10px;color:var(--t3);margin-left:auto">'+pd.games+'g</span>';
      h+='</div>';
    }
    h+='</div>';
  }
  h+='<div class="tc-row">';
  h+='<div class="tc-cell"><div class="tc-cell-val" style="color:'+wrC+'">'+tm.wr+'%</div><div class="tc-cell-lbl">Win Rate</div></div>';
  h+='<div class="tc-cell"><div class="tc-cell-val">'+tm.w+'</div><div class="tc-cell-lbl">Wins</div></div>';
  h+='<div class="tc-cell"><div class="tc-cell-val">'+tm.l+'</div><div class="tc-cell-lbl">Losses</div></div>';
  h+='<div class="tc-cell"><div class="tc-cell-val">'+tm.t+'</div><div class="tc-cell-lbl">Total</div></div>';
  h+='</div></div>';
  return h;
}

function showTeam(name){
  var teams=genTeamData();var tm=null;
  for(var i=0;i<teams.length;i++){if(teams[i].name===name){tm=teams[i];break;}}
  if(!tm)return;
  var el=document.getElementById("pg-teams");
  var wrC=(+tm.wr)>=50?"var(--green)":"var(--red)";
  var h='<div class="fade">';
  h+='<div style="margin-bottom:16px"><button class="btn" onclick="go(\'teams\')" style="font-size:12px">‚Üê Back to Teams</button></div>';
  // Header with logo
  h+='<div class="card" style="display:flex;align-items:center;gap:20px;margin-bottom:16px">';
  var logoH=teamLogo(tm.name,64);
  if(logoH){h+=logoH;}
  else{h+='<div style="width:72px;height:72px;border-radius:14px;background:'+tm.color+';display:flex;align-items:center;justify-content:center;font-weight:900;font-size:24px;color:#fff;letter-spacing:1px;flex-shrink:0">'+tm.tag+'</div>';}
  h+='<div style="flex:1"><div style="font-size:28px;font-weight:900;text-transform:uppercase;letter-spacing:1px">'+tm.displayName+'</div>';
  h+='<div style="font-size:13px;color:var(--t2);margin-top:2px">'+tm.tag+(tm.region?' ¬∑ '+tm.region:'')+(tm.tier?' ¬∑ Tier '+tm.tier:'')+'</div>';
  if(tm.dbInfo&&tm.dbInfo.liquipedia){h+='<a href="'+tm.dbInfo.liquipedia+'" target="_blank" rel="noopener" style="font-size:11px;color:#3498db;text-decoration:none;margin-top:4px;display:inline-block">‚Üó Liquipedia</a>';}
  h+='</div></div>';

  // KPI cards
  h+='<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:16px">';
  h+='<div class="card" style="text-align:center"><div style="font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase;margin-bottom:4px">WIN RATE</div><div style="font-size:28px;font-weight:900;font-family:var(--mono);color:'+wrC+'">'+tm.wr+'%</div></div>';
  h+='<div class="card" style="text-align:center"><div style="font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase;margin-bottom:4px">TOTAL GAMES</div><div style="font-size:28px;font-weight:900;font-family:var(--mono)">'+tm.t+'</div></div>';
  h+='<div class="card" style="text-align:center"><div style="font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase;margin-bottom:4px">WINS</div><div style="font-size:28px;font-weight:900;font-family:var(--mono);color:var(--green)">'+tm.w+'</div></div>';
  h+='<div class="card" style="text-align:center"><div style="font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase;margin-bottom:4px">LOSSES</div><div style="font-size:28px;font-weight:900;font-family:var(--mono);color:var(--red)">'+tm.l+'</div></div>';
  h+='</div>';

  // Recent form
  h+='<div class="card" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">';
  h+='<div><span style="font-weight:700;font-size:12px;color:var(--t3);text-transform:uppercase;margin-right:12px">RECENT FORM</span>';
  for(var fi=0;fi<tm.form.length;fi++){var fc=tm.form[fi]==="W"?"var(--green)":"var(--red)";h+='<span style="display:inline-flex;width:28px;height:28px;border-radius:50%;background:'+fc+';color:#fff;font-weight:800;font-size:11px;align-items:center;justify-content:center;margin-right:4px">'+tm.form[fi]+'</span>';}
  h+='</div><div style="padding:6px 14px;border-radius:8px;border:1px solid var(--border);font-size:12px;color:var(--t2)">‚ñ∏ Last SET: '+tm.lastDate+'</div></div>';

  // ROSTER with brawler icons per player
  h+='<div class="card" style="margin-bottom:16px"><div class="card-t">‚ä° ROSTER ('+tm.playerData.length+' players)</div>';
  h+='<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px">';
  for(var pi=0;pi<tm.playerData.length;pi++){
    var pd=tm.playerData[pi];
    h+='<div style="padding:14px;border-radius:10px;background:var(--bg3);border:1px solid var(--border)">';
    h+='<div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">';
    h+='<div style="width:36px;height:36px;border-radius:50%;background:'+tm.color+'40;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:900;color:'+tm.color+'">'+pd.name.charAt(0).toUpperCase()+'</div>';
    h+='<div><div style="font-weight:800;font-size:14px">'+pd.name+'</div>';
    h+='<div style="font-size:11px;color:var(--t3)">'+pd.games+' games played</div></div></div>';
    // Brawler picks with icons
    if(pd.brawlers.length){
      h+='<div style="display:flex;flex-wrap:wrap;gap:4px">';
      for(var bi=0;bi<pd.brawlers.length;bi++){
        var br=pd.brawlers[bi];
        var bwrC=(+br.wr)>=50?"var(--green)":"var(--red)";
        h+='<div style="display:flex;align-items:center;gap:3px;padding:3px 6px;border-radius:6px;background:var(--bg2);border:1px solid var(--border);font-size:10px">';
        h+=bIconSm(br.name);
        h+='<span style="font-weight:700">'+br.p+'</span>';
        h+='<span style="color:'+bwrC+';font-weight:600">'+br.wr+'%</span>';
        h+='</div>';
      }
      h+='</div>';
    }
    h+='</div>';
  }
  h+='</div></div>';

  // Daily Activity Chart
  h+='<div class="card" style="margin-bottom:16px"><div class="card-t">‚Üó Daily Activity</div><div class="chart-box"><canvas id="chTeamAct"></canvas></div></div>';

  // Mode Stats + H2H side by side
  h+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px">';
  h+='<div class="card"><div class="card-t">'+sIco("wrmode")+'BY GAME MODE</div>';
  for(var mi=0;mi<tm.modeStats.length;mi++){var ms=tm.modeStats[mi];
    h+='<div style="display:flex;align-items:center;gap:8px;padding:7px 0;border-bottom:1px solid var(--border)">';
    h+=mIco(ms.mode);
    h+='<span style="flex:1;font-weight:700;font-size:13px">'+ms.mode+'</span>';
    h+='<span class="'+wrCol(ms.wr)+'" style="font-family:var(--mono);font-weight:700;font-size:14px">'+ms.wr+'%</span>';
    h+='<span style="font-size:10px;color:var(--t3);min-width:60px;text-align:right">'+ms.w+'W - '+ms.l+'L</span></div>';
  }
  h+='</div>';
  h+='<div class="card"><div class="card-t">'+sIco("swords")+'HEAD TO HEAD</div>';
  for(var hi=0;hi<Math.min(6,tm.h2h.length);hi++){var hh=tm.h2h[hi];
    var hLogo=teamLogo(hh.vs,24);var hdb={tag:hh.vs.replace(/[^A-Z0-9]/gi,"").slice(0,3).toUpperCase(),color:bc(hh.vs)};
    var vsInfo=TEAMS_DB[hh.vs];var vsName=vsInfo?vsInfo.org:hh.vs;
    h+='<div style="display:flex;align-items:center;gap:8px;padding:7px 0;border-bottom:1px solid var(--border)">';
    if(hLogo){h+=hLogo;}
    else{h+='<div style="width:24px;height:24px;border-radius:5px;background:'+hdb.color+';display:flex;align-items:center;justify-content:center;font-size:8px;font-weight:800;color:#fff">'+hdb.tag+'</div>';}
    h+='<span style="flex:1;font-weight:700;font-size:13px">'+vsName+'</span>';
    h+='<span class="'+wrCol(hh.wr)+'" style="font-family:var(--mono);font-weight:700;font-size:14px">'+hh.wr+'%</span>';
    h+='<span style="font-size:10px;color:var(--t3);min-width:60px;text-align:right">'+hh.w+'W - '+hh.l+'L</span></div>';
  }
  h+='</div></div>';

  // Map Performance + Top Brawlers
  h+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px">';
  h+='<div class="card"><div class="card-t">'+sIco("map")+'MAP PERFORMANCE</div>';
  for(var mpi=0;mpi<Math.min(6,tm.mapStats.length);mpi++){var mp=tm.mapStats[mpi];
    h+='<div style="display:flex;align-items:center;gap:8px;padding:7px 0;border-bottom:1px solid var(--border)">';
    h+=mIco(findMapMode(mp.map));
    h+='<span style="flex:1;font-weight:700;font-size:13px">'+mp.map+'</span>';
    h+='<span class="'+wrCol(mp.wr)+'" style="font-family:var(--mono);font-weight:700;font-size:14px">'+mp.wr+'%</span>';
    h+='<span style="font-size:10px;color:var(--t3);min-width:60px;text-align:right">'+mp.w+'W - '+mp.l+'L</span></div>';
  }
  h+='</div>';
  h+='<div class="card"><div class="card-t">'+sIco("crown")+'TOP BRAWLERS</div>';
  for(var tbi=0;tbi<Math.min(7,tm.topB.length);tbi++){var tb=tm.topB[tbi];
    h+='<div style="display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid var(--border)">';
    h+=bIconSm(tb.name);
    h+='<span style="flex:1;font-weight:700;font-size:13px">'+tb.name+'</span>';
    h+='<span class="'+wrCol(tb.wr)+'" style="font-family:var(--mono);font-weight:700;font-size:14px">'+tb.wr+'%</span>';
    h+='<span style="font-size:10px;color:var(--t3)">'+tb.p+' games</span></div>';
  }
  h+='</div></div>';

  // Scrim Sessions
  h+='<div class="card"><div class="card-t">‚è± SCRIM SESSIONS</div>';
  for(var si=0;si<tm.scrims.length;si++){var sc=tm.scrims[si];
    var scLogo=teamLogo(sc.vs,28);var sdb={tag:sc.vs.replace(/[^A-Z0-9]/gi,"").slice(0,3).toUpperCase(),color:bc(sc.vs)};
    var scInfo=TEAMS_DB[sc.vs];var scName=scInfo?scInfo.org:sc.vs;
    var sWin=sc.w>sc.l;var sTie=sc.w===sc.l;
    h+='<div style="display:flex;align-items:center;padding:12px;margin-bottom:6px;border-radius:8px;background:var(--bg3);border:1px solid var(--border)">';
    h+='<span style="flex:0 0 120px;font-size:12px;color:var(--t2)">'+sc.date+'</span>';
    h+='<div style="flex:1;display:flex;align-items:center;justify-content:center;gap:10px">';
    var tmLogo=teamLogo(tm.name,28);
    if(tmLogo){h+=tmLogo;}else{h+='<div style="width:28px;height:28px;border-radius:6px;background:'+tm.color+';display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:800;color:#fff">'+tm.tag+'</div>';}
    h+='<span style="font-weight:900;font-family:var(--mono);font-size:18px;color:'+(sWin?"var(--green)":sTie?"var(--yellow)":"var(--red)")+'">'+sc.w+' - '+sc.l+'</span>';
    if(scLogo){h+=scLogo;}else{h+='<div style="width:28px;height:28px;border-radius:6px;background:'+sdb.color+';display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:800;color:#fff">'+sdb.tag+'</div>';}
    h+='<span style="font-size:12px;color:var(--t2);min-width:100px">'+scName+'</span>';
    h+='</div></div>';
  }
  h+='</div>';

  h+='</div>';
  el.innerHTML=h;

  setTimeout(function(){
    var labels=[];var data=[];
    for(var d=0;d<tm.days.length;d++){labels.push(tm.days[d].d);data.push(tm.days[d].t);}
    mChart("chTeamAct","line",{labels:labels,datasets:[{data:data,borderColor:"#f1c40f",backgroundColor:"rgba(241,196,15,.08)",fill:true,tension:.3,pointRadius:3,pointBackgroundColor:"#f1c40f",borderWidth:2}]},{scales:{x:{ticks:{color:"#666",maxRotation:45},grid:{display:false}},y:{ticks:{color:"#666"},grid:{color:"rgba(42,42,42,.25)"}}}});
  },50);
}

function findMapMode(mapName){for(var i=0;i<matchData.length;i++){if(matchData[i].map===mapName)return matchData[i].mode;}return"";}

function filterTeams(region){
  document.querySelectorAll("#regionPills .pill").forEach(function(p){
    p.classList.remove("white");
    if((region==="ALL"&&p.textContent.indexOf("ALL")>=0)||p.textContent===region)p.classList.add("white");
  });
  document.querySelectorAll(".tc[data-team]").forEach(function(c){c.style.display=(region==="ALL"||c.dataset.region===region)?"":"none";});
}
function filterTeamSearch(){var v=document.getElementById("teamSearch").value.toLowerCase();document.querySelectorAll(".tc[data-team]").forEach(function(e){e.style.display=e.dataset.team.toLowerCase().indexOf(v)>=0?"":"none";});}

// ‚ïê‚ïê‚ïê H2H TEAMS ‚ïê‚ïê‚ïê
function pgH2H(el,s){
  var data=getFD()||[];
  var h2hMap={};
  data.forEach(function(r){
    var t1=r.team1_name,t2=r.team2_name;
    if(!t1||!t2||t1.indexOf("Unknown")===0||t2.indexOf("Unknown")===0)return;
    if(!r.set_id)return;
    var key=t1<t2?t1+"|||"+t2:t2+"|||"+t1;
    if(!h2hMap[key])h2hMap[key]={t1:t1<t2?t1:t2,t2:t1<t2?t2:t1,sets:{}};
    var h2=h2hMap[key];
    if(!h2.sets[r.set_id])h2.sets[r.set_id]={w:0,l:0};
    var sd=h2.sets[r.set_id];
    var isT1=(r.team1_name===h2.t1);
    if((isT1&&r.result==="victory")||(!isT1&&r.result!=="victory"))sd.w++;else sd.l++;
  });
  var h2hList=[];
  for(var k in h2hMap){var v=h2hMap[k];var sW=0,sL=0;
    for(var sid in v.sets){var sd2=v.sets[sid];if(sd2.w>sd2.l)sW++;else if(sd2.l>sd2.w)sL++;}
    if(sW+sL>=1)h2hList.push({t1:v.t1,t2:v.t2,sW:sW,sL:sL,total:sW+sL});
  }
  h2hList.sort(function(a,b){return b.total-a.total;});
  var h='<div class="fade">';
  h+='<div style="display:flex;align-items:center;gap:10px;margin-bottom:20px"><span style="font-size:24px;font-weight:900">HEAD-TO-HEAD (TEAMS)</span></div>';
  h+=buildModePills();
  if(!h2hList.length){h+='<div style="color:var(--t3);text-align:center;padding:40px">No team H2H data</div></div>';el.innerHTML=h;return;}
  h+='<div style="display:flex;flex-direction:column;gap:8px">';
  for(var i=0;i<h2hList.length;i++){
    var m=h2hList[i];
    var db1=TEAMS_DB[m.t1];var db2=TEAMS_DB[m.t2];
    var n1=db1?db1.org:m.t1;var n2=db2?db2.org:m.t2;
    var c1=db1?db1.color:bc(m.t1);var c2=db2?db2.color:bc(m.t2);
    var logo1=teamLogo(m.t1,32)||"";var logo2=teamLogo(m.t2,32)||"";
    var barW=Math.max(8,Math.min(92,m.total?(m.sW/m.total)*100:50));
    h+='<div style="background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:14px 18px">';
    h+='<div style="display:flex;align-items:center;justify-content:space-between">';
    h+='<div style="display:flex;align-items:center;gap:10px;flex:1">';
    if(logo1)h+=logo1;else h+='<div style="width:32px;height:32px;border-radius:8px;background:'+c1+';display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:900;color:#fff">'+m.t1.replace(/[^A-Z0-9]/gi,"").slice(0,3).toUpperCase()+'</div>';
    h+='<div><div style="font-weight:800;font-size:14px">'+n1+'</div>';
    h+='<div style="font-size:11px;font-weight:700;color:'+(m.sW>=m.sL?"var(--green)":"var(--red)")+'">'+m.sW+' sets won</div></div></div>';
    h+='<div style="text-align:center;padding:0 16px"><div style="font-family:var(--mono);font-weight:900;font-size:24px">'+m.sW+' - '+m.sL+'</div>';
    h+='<div style="font-size:10px;color:var(--t3)">'+m.total+' sets</div></div>';
    h+='<div style="display:flex;align-items:center;gap:10px;flex:1;justify-content:flex-end">';
    h+='<div style="text-align:right"><div style="font-weight:800;font-size:14px">'+n2+'</div>';
    h+='<div style="font-size:11px;font-weight:700;color:'+(m.sL>=m.sW?"var(--green)":"var(--red)")+'">'+m.sL+' sets won</div></div>';
    if(logo2)h+=logo2;else h+='<div style="width:32px;height:32px;border-radius:8px;background:'+c2+';display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:900;color:#fff">'+m.t2.replace(/[^A-Z0-9]/gi,"").slice(0,3).toUpperCase()+'</div>';
    h+='</div></div>';
    h+='<div style="display:flex;height:6px;border-radius:3px;overflow:hidden;margin-top:8px"><div style="width:'+barW+'%;background:var(--green)"></div><div style="width:'+(100-barW)+'%;background:var(--red)"></div></div>';
    h+='</div>';
  }
  h+='</div></div>';
  el.innerHTML=h;
}

// ‚ïê‚ïê‚ïê MATCH LOG ‚ïê‚ïê‚ïê
function pgTracker(el,s,data){
  var wr=s.total?((s.wins/s.total)*100).toFixed(1):"0";
  var bMode=(s.modes||[]).slice().sort(function(a,b){return(+b.wr)-(+a.wr);})[0];
  var mPick=s.brawlers.slice().sort(function(a,b){return b.p-a.p;})[0];
  var cur=0,best=0;
  var rev=data.slice().sort(function(a,b){var ka=(a.date||"")+"T"+(a.time||"99:99"),kb=(b.date||"")+"T"+(b.time||"99:99");return kb>ka?1:kb<ka?-1:0;});
  for(var i=0;i<rev.length;i++){if(rev[i].result==="victory"){cur++;if(cur>best)best=cur;}else cur=0;}
  var recent=rev.slice(0,100);
  var h='<div class="fade">'+buildModePills();
  h+='<div class="kpi-row">';
  h+='<div class="kpi"><div class="kpi-label">Overall WR</div><div class="kpi-val" style="color:var(--green)">'+wr+'%</div></div>';
  h+='<div class="kpi"><div class="kpi-label">Best Mode</div><div style="font-size:18px;font-weight:800;color:var(--green)">'+(bMode?bMode.name:"-")+'</div><div class="kpi-sub">'+(bMode?bMode.wr:"0")+'%</div></div>';
  h+='<div class="kpi"><div class="kpi-label">Most Picked</div>'+(mPick?bIcon(mPick.name,28):'')+'<div style="font-size:18px;font-weight:800;color:var(--yellow)">'+(mPick?mPick.name:"-")+'</div><div class="kpi-sub">'+(mPick?mPick.p:"0")+'g</div></div>';
  h+='<div class="kpi"><div class="kpi-label">Best Streak</div><div class="kpi-val" style="color:var(--green)">'+best+'</div><div class="kpi-sub">Current: '+cur+'</div></div>';
  h+='</div>';
  h+='<div class="card"><div class="card-t">Match Log ('+recent.length+')</div><div style="max-height:550px;overflow-y:auto"><table><thead><tr><th>Date</th><th>Mode</th><th>Map</th><th>Team</th><th>Comp</th><th></th><th>Enemy</th><th>Comp</th><th>Score</th><th>Result</th></tr></thead><tbody>';
  for(var j=0;j<recent.length;j++){var r=recent[j];
    var _dd=r.date.split("-");var _dispDate=_dd.length===3?(_dd[2]+"/"+_dd[1]+"/"+_dd[0]):r.date;
    var _rowBorder=r.result==="victory"?"border-left:3px solid var(--green)":"border-left:3px solid var(--red)";
    var _rowBg=r.result==="victory"?"rgba(46,204,113,.04)":"rgba(231,76,60,.04)";
    h+='<tr onclick="document.getElementById(\'mld'+j+'\').style.display=document.getElementById(\'mld'+j+'\').style.display===\'none\'?\'table-row\':\'none\'" style="cursor:pointer;'+_rowBorder+';background:'+_rowBg+';transition:all .15s" onmouseover="this.style.background=\''+( r.result==="victory"?"rgba(46,204,113,.1)":"rgba(231,76,60,.1)")+'\'" onmouseout="this.style.background=\''+_rowBg+'\'">';
    h+='<td style="font-family:var(--mono);font-size:11px">'+_dispDate+'</td>';
    h+='<td>'+mIco(r.mode)+'</td>';
    h+='<td style="font-size:11px">'+r.map+'</td>';
    h+='<td style="font-size:10px;font-weight:600;color:var(--green)">'+(r.team1_name&&r.team1_name.indexOf("Unknown")!==0?r.team1_name:"")+'</td>';
    h+='<td>'+bIconSm(r.brawler1)+bIconSm(r.brawler2)+bIconSm(r.brawler3)+'</td>';
    h+='<td style="font-size:10px;color:var(--t3)">vs</td>';
    h+='<td style="font-size:10px;font-weight:600;color:var(--red)">'+(r.team2_name&&r.team2_name.indexOf("Unknown")!==0?r.team2_name:"")+'</td>';
    h+='<td>'+bIconSm(r.enemy1)+bIconSm(r.enemy2)+bIconSm(r.enemy3)+'</td>';
    h+='<td style="font-family:var(--mono);font-size:11px;font-weight:700">'+(r.set_score||"")+'</td>';
    h+='<td>'+resultBadge(r.result)+'</td></tr>';
    // Expandable detail row
    h+='<tr id="mld'+j+'" style="display:none;background:var(--bg3)"><td colspan="10" style="padding:12px 16px">';
    h+='<div style="display:flex;gap:24px;flex-wrap:wrap;align-items:flex-start">';
    // Team 1 players
    h+='<div style="flex:1;min-width:180px"><div style="font-size:10px;font-weight:800;color:var(--green);text-transform:uppercase;margin-bottom:6px;letter-spacing:.5px">'+(r.team1_name||"Team 1")+'</div>';
    var t1p=[[r.player1,r.brawler1],[r.player2,r.brawler2],[r.player3,r.brawler3]];
    for(var tp=0;tp<t1p.length;tp++){if(t1p[tp][0]||t1p[tp][1])h+='<div style="display:flex;align-items:center;gap:6px;margin-bottom:4px">'+bIconSm(t1p[tp][1])+'<span style="font-size:11px;font-weight:600;color:var(--t1)">'+((t1p[tp][0])||"-")+'</span><span style="font-size:10px;color:var(--t3)">'+((t1p[tp][1])||"")+'</span></div>';}
    h+='</div>';
    // Team 2 players
    h+='<div style="flex:1;min-width:180px"><div style="font-size:10px;font-weight:800;color:var(--red);text-transform:uppercase;margin-bottom:6px;letter-spacing:.5px">'+(r.team2_name||"Team 2")+'</div>';
    var t2p=[[r.eplayer1,r.enemy1],[r.eplayer2,r.enemy2],[r.eplayer3,r.enemy3]];
    for(var tp2=0;tp2<t2p.length;tp2++){if(t2p[tp2][0]||t2p[tp2][1])h+='<div style="display:flex;align-items:center;gap:6px;margin-bottom:4px">'+bIconSm(t2p[tp2][1])+'<span style="font-size:11px;font-weight:600;color:var(--t1)">'+((t2p[tp2][0])||"-")+'</span><span style="font-size:10px;color:var(--t3)">'+((t2p[tp2][1])||"")+'</span></div>';}
    h+='</div>';
    // Match info
    h+='<div style="min-width:120px">';
    if(r.duration)h+='<div style="margin-bottom:4px"><span style="font-size:10px;color:var(--t3)">Dur√©e</span><div style="font-family:var(--mono);font-size:14px;font-weight:700;color:var(--yellow)">'+r.duration+'</div></div>';
    if(r.time)h+='<div style="margin-bottom:4px"><span style="font-size:10px;color:var(--t3)">Heure</span><div style="font-family:var(--mono);font-size:12px;color:var(--t2)">'+r.time+'</div></div>';
    h+='<div><span style="font-size:10px;color:var(--t3)">Mode</span><div style="font-size:12px;font-weight:600;color:var(--t1)">'+mIco(r.mode)+' '+r.mode+'</div></div>';
    h+='</div></div></td></tr>';}
  h+='</tbody></table></div></div></div>';
  el.innerHTML=h;
}

// ‚ïê‚ïê‚ïê DRAFT HELP (COMBINED: COUNTER PICK + DRAFT SIM) ‚ïê‚ïê‚ïê
var _draftTab="counter"; // "counter" or "sim"
function pgDraft(el,s){
  var allB=s.brawlers.map(function(b){return b.name;}).sort(bSort);
  if(!draftEnemy)draftEnemy=allB[~~(Math.random()*allB.length)];
  draft.allBrawlers=allB;
  var h='<div class="fade">';

  // Tab bar
  h+='<div style="display:flex;gap:0;margin-bottom:20px;border-radius:12px;overflow:hidden;border:1px solid var(--border);background:var(--bg2)">';
  h+='<div onclick="_draftTab=\'counter\';go(\'draft\')" style="flex:1;padding:14px;text-align:center;cursor:pointer;font-weight:800;font-size:13px;letter-spacing:.5px;transition:all .2s;'+(_draftTab==="counter"?"background:var(--green);color:#000":"color:var(--t2)")+'">';
  h+=''+sIco("scope")+'COUNTER PICK</div>';
  h+='<div onclick="_draftTab=\'sim\';go(\'draft\')" style="flex:1;padding:14px;text-align:center;cursor:pointer;font-weight:800;font-size:13px;letter-spacing:.5px;transition:all .2s;'+(_draftTab==="sim"?"background:var(--green);color:#000":"color:var(--t2)")+'">';
  h+=''+sIco("swords")+'DRAFT SIMULATOR</div>';
  h+='</div>';

  if(_draftTab==="counter") h+=renderCounterPick(s,allB);
  else h+=renderDraftSim(s);
  h+='</div>';
  el.innerHTML=h;
  // If sim tab and draft started, re-render
  if(_draftTab==="sim"&&draft.started){renderDraft(el,s);}
}

// ‚îÄ‚îÄ COUNTER PICK TAB ‚îÄ‚îÄ
function renderCounterPick(s,allB){
  var avg=draftHistory.length?Math.round(draftHistory.reduce(function(a,h2){return a+h2.score;},0)/draftHistory.length):0;
  var avgCol=avg>=70?"var(--green)":avg>=50?"var(--yellow)":"var(--red)";
  var h='';

  // Top: enemy card + score card
  h+='<div style="display:grid;grid-template-columns:1fr 200px;gap:16px;margin-bottom:16px">';

  // Left: Enemy display
  h+='<div class="card" style="padding:20px">';
  h+='<div style="display:flex;align-items:center;gap:16px;margin-bottom:16px">';
  h+='<div style="position:relative">'+bIcon(draftEnemy,64);
  h+='</div>';
  h+='<div><div style="font-size:10px;color:var(--red);font-weight:700;text-transform:uppercase;letter-spacing:1px;margin-bottom:2px">ENEMY PICK</div>';
  h+='<div style="font-size:24px;font-weight:900;line-height:1.1">'+draftEnemy+'</div>';
  if(BCLS[draftEnemy])h+='<div style="font-size:11px;color:var(--t3);margin-top:4px">'+clsIco(BCLS[draftEnemy],14)+' '+BCLS[draftEnemy]+'</div>';
  h+='</div></div>';

  // Suggested counters
  h+='<div style="font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px">TOP COUNTERS</div>';
  h+='<div style="display:flex;gap:8px;flex-wrap:wrap">';
  var counters=[];
  for(var ci=0;ci<allB.length;ci++){
    var cb=allB[ci];if(cb===draftEnemy)continue;
    var ck=cb+"_vs_"+draftEnemy,cm=s.counters[ck];
    if(cm&&cm.t>=3){counters.push({name:cb,wr:((cm.w/cm.t)*100),t:cm.t});}
  }
  counters.sort(function(a,b){return b.wr-a.wr;});
  for(var ci2=0;ci2<Math.min(5,counters.length);ci2++){
    var ct=counters[ci2];
    h+='<div onclick="selD(\''+ct.name.replace(/'/g,"\\'")+'\');subD()" style="cursor:pointer;display:flex;align-items:center;gap:6px;padding:6px 10px;border-radius:8px;background:var(--bg3);border:1px solid var(--border);transition:all .15s" onmouseover="this.style.borderColor=\'var(--green)\'" onmouseout="this.style.borderColor=\'var(--border)\'">';
    h+=bIconSm(ct.name);
    h+='<div><div style="font-size:12px;font-weight:700">'+ct.name+'</div><div style="font-size:10px;font-family:var(--mono);color:var(--green);font-weight:700">'+ct.wr.toFixed(0)+'%</div></div></div>';
  }
  if(!counters.length)h+='<div style="font-size:12px;color:var(--t3)">No data</div>';
  h+='</div></div>';

  // Right: Score card
  h+='<div class="card" style="text-align:center;padding:20px;display:flex;flex-direction:column;align-items:center;justify-content:center">';
  h+='<div style="font-size:10px;color:var(--t3);text-transform:uppercase;letter-spacing:1px;font-weight:700;margin-bottom:6px">AVG SCORE</div>';
  h+='<div style="font-size:48px;font-weight:900;font-family:var(--mono);color:'+avgCol+';line-height:1">'+avg+'</div>';
  h+='<div style="font-size:11px;color:var(--t3);margin-top:4px">'+draftHistory.length+' rounds</div>';
  h+='<div style="display:flex;gap:8px;margin-top:16px">';
  h+='<button class="btn btn-g" onclick="nxtD()" style="font-size:12px;padding:8px 16px">Next Round</button>';
  if(draftHistory.length)h+='<button class="btn" onclick="draftHistory=[];go(\'draft\')" style="font-size:12px;padding:8px 16px">‚Ü∫ Reset</button>';
  h+='</div></div></div>';

  // Your pick grid
  h+='<div class="card" style="padding:20px">';
  h+='<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">';
  h+='<div style="font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase;letter-spacing:1px">YOUR PICK</div>';
  h+='<input class="search-box" placeholder="‚åï Search..." oninput="filterCPGrid(this.value)" style="max-width:200px;padding:6px 12px;font-size:12px;margin:0">';
  h+='</div>';

  // Class filter pills
  h+='<div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px" id="cpClassPills">';
  h+='<div class="pill white" onclick="setCPCF(\'\')">ALL</div>';
  for(var ki=0;ki<CLASSES.length;ki++){var kc=CLASSES[ki];h+='<div class="pill" onclick="setCPCF(\''+kc+'\')">'+clsIco(kc,14)+' '+kc.toUpperCase()+'</div>';}
  h+='</div>';

  h+='<div class="b-grid" id="cpGrid" style="grid-template-columns:repeat(auto-fill,minmax(56px,1fr))">';
  for(var i=0;i<allB.length;i++){
    var b=allB[i];if(b===draftEnemy)continue;
    h+='<div class="b-icon" style="background:'+bc(b)+'" onclick="selD(\''+b.replace(/'/g,"\\'")+'\');subD()" data-b="'+b+'" data-cls="'+(BCLS[b]||"")+'">';
    if(bImgSrc(b))h+='<img src="'+bImgSrc(b)+'" loading="lazy" style="width:100%;height:100%;object-fit:cover;border-radius:8px;position:absolute;top:0;left:0" onerror="this.onerror=null;this.src=\''+bImgSrc2(b)+'\'">';
    h+='<div class="b-icon-name">'+b+'</div></div>';
  }
  h+='</div></div>';

  // History
  if(draftHistory.length){
    h+='<div class="card" style="padding:20px"><div style="font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase;letter-spacing:1px;margin-bottom:10px">HISTORY</div>';
    h+='<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:8px">';
    for(var j=draftHistory.length-1;j>=Math.max(0,draftHistory.length-12);j--){
      var dh=draftHistory[j];
      var sc=dh.score>=70?"var(--green)":dh.score>=50?"var(--yellow)":"var(--red)";
      h+='<div style="display:flex;align-items:center;justify-content:space-between;padding:8px 12px;border-radius:8px;background:var(--bg3);border:1px solid var(--border)">';
      h+='<div style="display:flex;align-items:center;gap:6px">'+bIconSm(dh.pick)+'<span style="font-size:12px;font-weight:600">'+dh.pick+'</span><span style="font-size:10px;color:var(--t3)">vs</span>'+bIconSm(dh.enemy)+'</div>';
      h+='<span style="font-family:var(--mono);font-weight:800;font-size:13px;color:'+sc+'">'+dh.score+'</span></div>';
    }
    h+='</div></div>';
  }
  return h;
}

var _cpCF="";
function selD(n){draftPick=n;}
function subD(){
  if(!draftPick)return;
  var s=compute(getFD()),k=draftPick+"_vs_"+draftEnemy,m=s.counters[k];
  var sc=40;if(m&&m.t>=2)sc=Math.min(100,Math.round((m.w/m.t)*120));
  draftHistory.push({enemy:draftEnemy,pick:draftPick,score:sc});
  nxtD();
}
function nxtD(){var s=compute(getFD());var names=s.brawlers.map(function(b){return b.name;});draftEnemy=names[~~(Math.random()*names.length)];draftPick="";go("draft");}
function setCPCF(c){_cpCF=c;var pills=document.querySelectorAll("#cpClassPills .pill");pills.forEach(function(p){p.classList.remove("white","green");});if(!c)pills[0].classList.add("white");else pills.forEach(function(p){if(p.textContent.toUpperCase().indexOf(c.toUpperCase())>=0)p.classList.add("green");});filterCPGrid("");}
function filterCPGrid(v){v=(v||"").toLowerCase();document.querySelectorAll("#cpGrid .b-icon").forEach(function(e){var nm=e.dataset.b.toLowerCase().indexOf(v)>=0;var cm=!_cpCF||e.dataset.cls===_cpCF;e.style.display=(nm&&cm)?"":"none";});}

// ‚îÄ‚îÄ DRAFT SIM TAB ‚îÄ‚îÄ
function renderDraftSim(s){
  if(!draft.started){
    // Step 1: choose first pick, OR step 1b: choose map
    if(!draft.fp){
      var h='<div style="max-width:560px;margin:0 auto">';
      // Difficulty selector
      h+='<div class="card" style="padding:24px;margin-bottom:16px;text-align:center">';
      h+='<div style="font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase;letter-spacing:2px;margin-bottom:14px">DIFFICULTY</div>';
      h+='<div style="display:flex;gap:10px;justify-content:center">';
      var _diffs=[{v:1,label:"EASY",emoji:"üòä",color:"#2ecc71",desc:"Random picks"},{v:2,label:"MEDIUM",emoji:"üòà",color:"#f39c12",desc:"Smart picks"},{v:3,label:"HARD",emoji:"üíÄ",color:"#e74c3c",desc:"Optimal counter"}];
      for(var _di=0;_di<_diffs.length;_di++){var _dd=_diffs[_di];var _dSel=draft.difficulty===_dd.v;
        h+='<div onclick="draft.difficulty='+_dd.v+';go(\'draft\')" style="cursor:pointer;flex:1;max-width:160px;padding:16px 12px;border-radius:12px;border:2px solid '+(_dSel?_dd.color:"var(--border)")+';background:'+(_dSel?_dd.color+"18":"var(--bg3)")+';transition:all .2s" onmouseover="this.style.borderColor=\''+_dd.color+'\'" onmouseout="this.style.borderColor=\''+(_dSel?_dd.color:"var(--border)")+'\'">';
        h+='<div style="font-size:28px;margin-bottom:6px">'+_dd.emoji+'</div>';
        h+='<div style="font-weight:800;font-size:13px;color:'+_dd.color+'">'+_dd.label+'</div>';
        h+='<div style="font-size:10px;color:var(--t3);margin-top:2px">'+_dd.desc+'</div></div>';
      }
      h+='</div></div>';
      // First pick selector
      h+='<div class="card" style="padding:32px;text-align:center">';
      h+='<div style="font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase;letter-spacing:2px;margin-bottom:16px">WHO HAS FIRST PICK?</div>';
      h+='<div style="display:flex;gap:16px;justify-content:center">';
      h+='<div onclick="draft.fp=1;go(\'draft\')" style="cursor:pointer;flex:1;max-width:220px;padding:28px 24px;border-radius:14px;border:2px solid rgba(46,204,113,.3);background:var(--bg3);transition:all .2s" onmouseover="this.style.borderColor=\'var(--green)\';this.style.transform=\'translateY(-3px)\'" onmouseout="this.style.borderColor=\'rgba(46,204,113,.3)\';this.style.transform=\'\'">';
      h+='<div style="width:48px;height:48px;border-radius:50%;background:rgba(46,204,113,.15);display:flex;align-items:center;justify-content:center;margin:0 auto 12px;border:2px solid var(--green)"><span style="font-size:20px;color:var(--green);font-weight:900">1</span></div>';
      h+='<div style="font-weight:800;font-size:15px;color:var(--green)">YOUR TEAM</div>';
      h+='<div style="font-size:11px;color:var(--t3);margin-top:4px">First pick</div></div>';
      h+='<div onclick="draft.fp=2;go(\'draft\')" style="cursor:pointer;flex:1;max-width:220px;padding:28px 24px;border-radius:14px;border:2px solid rgba(231,76,60,.3);background:var(--bg3);transition:all .2s" onmouseover="this.style.borderColor=\'var(--red)\';this.style.transform=\'translateY(-3px)\'" onmouseout="this.style.borderColor=\'rgba(231,76,60,.3)\';this.style.transform=\'\'">';
      h+='<div style="width:48px;height:48px;border-radius:50%;background:rgba(231,76,60,.15);display:flex;align-items:center;justify-content:center;margin:0 auto 12px;border:2px solid var(--red)"><span style="font-size:20px;color:var(--red);font-weight:900">1</span></div>';
      h+='<div style="font-weight:800;font-size:15px;color:var(--red)">ENEMY TEAM</div>';
      h+='<div style="font-size:11px;color:var(--t3);margin-top:4px">First pick</div></div>';
      h+='</div></div></div>';
      return h;
    }
    // Step 2: choose mode + map
    var h='<div style="max-width:640px;margin:0 auto">';
    h+='<div class="card" style="padding:24px">';
    h+='<div style="font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase;letter-spacing:2px;margin-bottom:4px;text-align:center">STEP 2 ‚Äî SELECT MAP</div>';
    h+='<div style="font-size:11px;color:var(--t3);text-align:center;margin-bottom:16px">First pick: <span style="color:'+(draft.fp===1?"var(--green)":"var(--red)")+';font-weight:700">'+(draft.fp===1?"YOUR TEAM":"ENEMY")+'</span></div>';
    // Mode pills from RANKED_MAPS
    var modes=Object.keys(RANKED_MAPS);
    h+='<div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-bottom:16px">';
    for(var mi=0;mi<modes.length;mi++){
      var md=modes[mi];
      var isSel=draft.selMode===md;
      h+='<div onclick="draft.selMode=\''+md+'\';draft.selMap=\'\';go(\'draft\')" style="cursor:pointer;padding:8px 14px;border-radius:8px;border:2px solid '+(isSel?MC[md]:"var(--border)")+';background:'+(isSel?MC[md]+"22":"var(--bg3)")+';display:flex;align-items:center;gap:6px;transition:all .15s">';
      h+=mIco(md)+'<span style="font-size:12px;font-weight:700;color:'+(isSel?MC[md]:"var(--t2)")+'">'+md.toUpperCase()+'</span></div>';
    }
    h+='</div>';
    // Map grid for selected mode from RANKED_MAPS
    if(draft.selMode&&RANKED_MAPS[draft.selMode]){
      var rmaps=RANKED_MAPS[draft.selMode];
      h+='<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px">';
      for(var mpi=0;mpi<rmaps.length;mpi++){
        var rm=rmaps[mpi];
        var isMSel=draft.selMap===rm.name;
        var selBd=isMSel?"var(--green)":"var(--border)";
        var selBg=isMSel?"rgba(46,204,113,.1)":"var(--bg3)";
        h+='<div onclick="draft.selMap=\''+rm.name.replace(/'/g,"\\'")+'\';go(\'draft\')" style="cursor:pointer;border-radius:10px;border:2px solid '+selBd+';background:'+selBg+';transition:all .15s;overflow:hidden" onmouseover="this.style.borderColor=\'var(--green)\';this.style.transform=\'translateY(-2px)\'" onmouseout="this.style.borderColor=\''+selBd+'\';this.style.transform=\'\'">';
        h+='<div style="position:relative;width:100%;padding-top:130%;background:var(--bg2);overflow:hidden">';
        h+='<img src="https://cdn.brawlify.com/maps/regular/'+rm.id+'.png" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover" loading="lazy" onerror="this.style.display=\'none\'">';
        if(isMSel)h+='<div style="position:absolute;top:6px;right:6px;width:22px;height:22px;border-radius:50%;background:var(--green);display:flex;align-items:center;justify-content:center"><span style="color:#000;font-size:14px;font-weight:900">‚úì</span></div>';
        h+='</div>';
        h+='<div style="padding:8px 10px">';
        h+='<div style="font-size:12px;font-weight:700;color:var(--t1);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+rm.name+'</div>';
        h+='<div style="font-size:10px;color:'+(MC[draft.selMode]||"var(--t3)")+';font-weight:600;margin-top:2px">'+draft.selMode+'</div>';
        h+='</div></div>';
      }
      h+='</div>';
    }else{
      h+='<div style="text-align:center;color:var(--t3);font-size:12px;padding:16px">Select a game mode above</div>';
    }
    // Start button
    if(draft.selMode&&draft.selMap){
      h+='<div style="text-align:center;margin-top:20px"><button class="btn btn-g" style="padding:12px 32px;font-size:14px;font-weight:800" onclick="startDraft(draft.fp)">'+sIco("swords")+' START DRAFT</button></div>';
    }
    h+='<div style="text-align:center;margin-top:8px"><button class="btn" style="font-size:11px;padding:6px 16px" onclick="draft.fp=0;draft.selMode=\'\';draft.selMap=\'\';go(\'draft\')">‚Üê Back</button></div>';
    h+='</div></div>';
    return h;
  }
  return '';
}

// ‚ïê‚ïê‚ïê DRAFT SIMULATOR (sub-tab of Draft Help) ‚ïê‚ïê‚ïê
var draft={fp:0,step:0,bans1:[],bans2:[],picks1:[],picks2:[],allBrawlers:[],started:false,selMode:"",selMap:"",botTeam:0,difficulty:2};
// BS Ranked: BAN1, BAN2, PICK(fp 1), PICK(sp 2), PICK(sp 2), PICK(fp 1), PICK(fp 1), PICK(sp 2)
var DRAFT_SEQ=[
  {type:"ban",team:1,label:"BAN"},
  {type:"ban",team:2,label:"BAN"},
  {type:"pick",team:1,label:"PICK 1"},
  {type:"pick",team:2,label:"PICK 1"},
  {type:"pick",team:2,label:"PICK 2"},
  {type:"pick",team:1,label:"PICK 2"},
  {type:"pick",team:1,label:"PICK 3"},
  {type:"pick",team:2,label:"PICK 3"}
];

function draftTeam(stepIdx){
  if(!draft.fp)return 1;
  var raw=DRAFT_SEQ[stepIdx].team;
  return draft.fp===1?raw:(raw===1?2:1);
}

function pgPlayers(el,s,data){
  // Gather all player stats from data
  var pm={};
  for(var i=0;i<data.length;i++){var r=data[i];
    var t1Players=[{n:r.player1,b:r.brawler1},{n:r.player2,b:r.brawler2},{n:r.player3,b:r.brawler3}];
    var t2Players=[{n:r.eplayer1,b:r.enemy1},{n:r.eplayer2,b:r.enemy2},{n:r.eplayer3,b:r.enemy3}];
    t1Players.forEach(function(p){
      if(!p.n)return;
      if(!pm[p.n])pm[p.n]={w:0,l:0,p:0,team:"",brawlers:{},modes:{}};
      pm[p.n].p++;
      if(r.result==="victory")pm[p.n].w++;else pm[p.n].l++;
      if(r.team1_name&&r.team1_name.indexOf("Unknown")!==0)pm[p.n].team=r.team1_name;
      if(p.b){
        if(!pm[p.n].brawlers[p.b])pm[p.n].brawlers[p.b]={w:0,p:0};
        pm[p.n].brawlers[p.b].p++;
        if(r.result==="victory")pm[p.n].brawlers[p.b].w++;
      }
      if(r.mode){
        if(!pm[p.n].modes[r.mode])pm[p.n].modes[r.mode]={w:0,p:0};
        pm[p.n].modes[r.mode].p++;
        if(r.result==="victory")pm[p.n].modes[r.mode].w++;
      }
    });
    t2Players.forEach(function(p){
      if(!p.n)return;
      if(!pm[p.n])pm[p.n]={w:0,l:0,p:0,team:"",brawlers:{},modes:{}};
      pm[p.n].p++;
      var eWin=r.result!=="victory";
      if(eWin)pm[p.n].w++;else pm[p.n].l++;
      if(r.team2_name&&r.team2_name.indexOf("Unknown")!==0)pm[p.n].team=r.team2_name;
      if(p.b){
        if(!pm[p.n].brawlers[p.b])pm[p.n].brawlers[p.b]={w:0,p:0};
        pm[p.n].brawlers[p.b].p++;
        if(eWin)pm[p.n].brawlers[p.b].w++;
      }
      if(r.mode){
        if(!pm[p.n].modes[r.mode])pm[p.n].modes[r.mode]={w:0,p:0};
        pm[p.n].modes[r.mode].p++;
        if(eWin)pm[p.n].modes[r.mode].w++;
      }
    });
  }
  // Build sorted list
  var pList=[];
  for(var k in pm){
    var pp=pm[k];
    var wr=pp.p?((pp.w/pp.p)*100).toFixed(1):"0";
    // Best brawler
    var bArr=[];for(var bk in pp.brawlers){var bb=pp.brawlers[bk];bArr.push({name:bk,w:bb.w,p:bb.p,wr:bb.p?((bb.w/bb.p)*100).toFixed(1):"0"});}
    bArr.sort(function(a,b){return b.p-a.p;});
    // Best mode
    var mArr=[];for(var mk in pp.modes){var mm=pp.modes[mk];mArr.push({name:mk,w:mm.w,p:mm.p,wr:mm.p?((mm.w/mm.p)*100).toFixed(1):"0"});}
    mArr.sort(function(a,b){return b.p-a.p;});
    pList.push({name:k,w:pp.w,l:pp.l,p:pp.p,wr:wr,team:pp.team,brawlers:bArr,modes:mArr,best:bArr[0]||null,bestMode:mArr[0]||null});
  }
  pList.sort(function(a,b){return b.p-a.p;});

  var h='<div class="fade">';
  h+='<div style="display:flex;align-items:center;gap:10px;margin-bottom:20px"><span style="font-size:22px">üë§</span><span style="font-size:24px;font-weight:900">PLAYERS</span><span style="font-size:13px;color:var(--t3);margin-left:8px">'+pList.length+' joueurs</span></div>';
  h+=buildModePills();
  h+='<input class="search-box" id="playerSearch" placeholder="‚åï Search player..." oninput="filterPlayers()">';

  // Player cards grid
  h+='<div id="playerList">';
  h+=renderPlayerList(pList);
  h+='</div>';

  // Detail panel
  h+='<div id="playerDetail" style="display:none"></div>';
  h+='</div>';
  el.innerHTML=h;

  // Store for search
  window._playerData=pList;
}

function renderPlayerList(pList){
  var h='<div class="team-grid">';
  for(var i=0;i<pList.length;i++){
    var p=pList[i];
    var tI=teamInfo(p.team);
    var wrClass=wrCol(p.wr);
    h+='<div class="tc" style="cursor:pointer" onclick="showPlayerDetail(\''+p.name.replace(/'/g,"\\'")+'\')">';
    h+='<div class="tc-head">';
    h+='<div style="width:42px;height:42px;border-radius:50%;background:linear-gradient(135deg,#9b59b6,#8e44ad);display:flex;align-items:center;justify-content:center;font-weight:900;font-size:17px;color:#fff;flex-shrink:0">'+p.name.charAt(0).toUpperCase()+'</div>';
    h+='<div style="flex:1;min-width:0"><div class="tc-name" style="font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+p.name+'</div>';
    if(tI){h+='<div class="tc-sub" style="display:flex;align-items:center;gap:4px">'+teamLogo(p.team,16)+' '+(tI.tag||p.team)+'</div>';}
    else if(p.team){h+='<div class="tc-sub">'+p.team+'</div>';}
    h+='</div></div>';
    h+='<div class="tc-row">';
    h+='<div class="tc-cell"><div class="tc-cell-val '+wrClass+'">'+p.wr+'%</div><div class="tc-cell-lbl">Win Rate</div></div>';
    h+='<div class="tc-cell"><div class="tc-cell-val" style="color:var(--t1)">'+p.p+'</div><div class="tc-cell-lbl">Games</div></div>';
    h+='<div class="tc-cell"><div class="tc-cell-val" style="color:var(--green)">'+p.w+'</div><div class="tc-cell-lbl">Wins</div></div>';
    h+='<div class="tc-cell"><div class="tc-cell-val" style="color:var(--red)">'+p.l+'</div><div class="tc-cell-lbl">Losses</div></div>';
    h+='</div>';
    // Top 3 brawlers
    if(p.brawlers.length){
      h+='<div style="margin-top:10px;display:flex;gap:6px;align-items:center">';
      h+='<span style="font-size:9px;color:var(--t3);font-weight:700;text-transform:uppercase;white-space:nowrap">TOP ‚Üí</span>';
      var top=p.brawlers.slice(0,3);
      for(var j=0;j<top.length;j++){var tb=top[j];
        h+='<div style="display:flex;align-items:center;gap:3px;background:var(--bg3);border-radius:6px;padding:3px 6px">';
        h+=bIconSm(tb.name);
        h+='<span style="font-size:10px;font-family:var(--mono);font-weight:700;color:'+wrHex(tb.wr)+'">'+tb.wr+'%</span>';
        h+='</div>';
      }
      h+='</div>';
    }
    h+='</div>';
  }
  h+='</div>';
  return h;
}

function filterPlayers(){
  var q=(document.getElementById("playerSearch").value||"").toLowerCase();
  var filtered=(window._playerData||[]).filter(function(p){
    return !q||p.name.toLowerCase().indexOf(q)>=0||p.team.toLowerCase().indexOf(q)>=0;
  });
  document.getElementById("playerList").innerHTML=renderPlayerList(filtered);
}

function showPlayerDetail(name){
  var pList=window._playerData||[];
  var p=null;for(var i=0;i<pList.length;i++){if(pList[i].name===name){p=pList[i];break;}}
  if(!p)return;
  var tI=teamInfo(p.team);
  document.getElementById("playerList").style.display="none";
  var d=document.getElementById("playerDetail");
  d.style.display="block";

  var h='<div class="fade">';
  h+='<button class="btn" onclick="document.getElementById(\'playerList\').style.display=\'\';document.getElementById(\'playerDetail\').style.display=\'none\'" style="margin-bottom:16px">‚Üê Back to players</button>';

  // Header
  h+='<div style="display:flex;align-items:center;gap:16px;margin-bottom:20px">';
  h+='<div style="width:64px;height:64px;border-radius:50%;background:linear-gradient(135deg,#9b59b6,#6c3483);display:flex;align-items:center;justify-content:center;font-weight:900;font-size:28px;color:#fff;flex-shrink:0;box-shadow:0 4px 16px rgba(155,89,182,.3)">'+p.name.charAt(0).toUpperCase()+'</div>';
  h+='<div><div style="font-weight:900;font-size:24px;text-transform:uppercase">'+p.name+'</div>';
  if(tI){h+='<div style="display:flex;align-items:center;gap:6px;margin-top:2px">'+teamLogo(p.team,20)+'<span style="font-size:13px;color:var(--t2)">'+(tI.org||p.team)+'</span></div>';}
  else if(p.team){h+='<div style="font-size:13px;color:var(--t2)">'+p.team+'</div>';}
  h+='</div></div>';

  // KPI row
  h+='<div class="kpi-row">';
  h+='<div class="kpi"><div class="kpi-label">Win Rate</div><div class="kpi-val" style="color:var(--green)">'+p.wr+'%</div></div>';
  h+='<div class="kpi"><div class="kpi-label">Games</div><div class="kpi-val" style="color:var(--t1)">'+p.p+'</div></div>';
  h+='<div class="kpi"><div class="kpi-label">Victories</div><div class="kpi-val" style="color:var(--green)">'+p.w+'</div></div>';
  h+='<div class="kpi"><div class="kpi-label">Losses</div><div class="kpi-val" style="color:var(--red)">'+p.l+'</div></div>';
  h+='</div>';

  // Brawler pool
  h+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">';
  h+='<div class="card"><div class="card-t">üéÆ Brawler Pool</div>';
  if(p.brawlers.length){
    // Top brawler highlight
    var best=p.brawlers[0];
    h+='<div style="background:linear-gradient(135deg,rgba(46,204,113,.1),rgba(46,204,113,.02));border:1px solid rgba(46,204,113,.2);border-radius:10px;padding:12px;text-align:center;margin-bottom:12px">';
    h+='<div style="font-size:9px;font-weight:800;color:var(--green);text-transform:uppercase;margin-bottom:6px">‚≠ê SIGNATURE BRAWLER</div>';
    h+=bIcon(best.name,44);
    h+='<div style="font-weight:800;font-size:14px;margin-top:4px">'+best.name+'</div>';
    h+='<div style="font-family:var(--mono);font-weight:700;color:var(--green);font-size:18px">'+best.wr+'%</div>';
    h+='<div style="font-size:10px;color:var(--t3)">'+best.p+' games ¬∑ '+best.w+' wins</div></div>';

    // All brawlers table
    h+='<div style="max-height:300px;overflow-y:auto">';
    for(var bi=0;bi<p.brawlers.length;bi++){var bb=p.brawlers[bi];
      var barW=Math.min(+bb.wr,100);
      h+='<div style="display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid var(--border)">';
      h+='<span style="font-size:10px;color:var(--t3);min-width:18px;text-align:right">#'+(bi+1)+'</span>';
      h+=bIconSm(bb.name);
      h+='<span style="flex:1;font-weight:600;font-size:12px">'+bb.name+'</span>';
      h+='<div style="width:60px;height:5px;background:var(--bg4);border-radius:3px;overflow:hidden"><div style="height:100%;width:'+barW+'%;background:'+wrHex(bb.wr)+';border-radius:3px"></div></div>';
      h+='<span class="'+wrCol(bb.wr)+'" style="font-family:var(--mono);font-weight:700;font-size:12px;min-width:42px;text-align:right">'+bb.wr+'%</span>';
      h+='<span style="font-size:10px;color:var(--t3);min-width:24px;text-align:right">'+bb.p+'g</span>';
      h+='</div>';
    }
    h+='</div>';
  }else{h+='<div style="color:var(--t3);font-size:12px">No brawler data</div>';}
  h+='</div>';

  // WR by Mode
  h+='<div class="card"><div class="card-t">'+sIco("wrmode")+' WR by Mode</div>';
  if(p.modes.length){
    for(var mi=0;mi<p.modes.length;mi++){var mm=p.modes[mi];
      var mBarW=Math.min(+mm.wr,100);
      h+='<div style="display:flex;align-items:center;gap:8px;padding:8px 0;border-bottom:1px solid var(--border)">';
      h+=mIco(mm.name);
      h+='<span style="flex:1;font-weight:600;font-size:13px">'+mm.name+'</span>';
      h+='<div style="width:80px;height:6px;background:var(--bg4);border-radius:3px;overflow:hidden"><div style="height:100%;width:'+mBarW+'%;background:'+wrHex(mm.wr)+';border-radius:3px"></div></div>';
      h+='<span class="'+wrCol(mm.wr)+'" style="font-family:var(--mono);font-weight:700;font-size:13px;min-width:48px;text-align:right">'+mm.wr+'%</span>';
      h+='<span style="font-size:10px;color:var(--t3);min-width:30px;text-align:right">'+mm.p+'g</span>';
      h+='</div>';
    }

    // Best mode highlight
    var bestM=p.modes.slice().sort(function(a,b){return(+b.wr)-(+a.wr);})[0];
    if(bestM&&bestM.p>=2){
      h+='<div style="background:linear-gradient(135deg,rgba(52,152,219,.1),rgba(52,152,219,.02));border:1px solid rgba(52,152,219,.2);border-radius:10px;padding:12px;text-align:center;margin-top:12px">';
      h+='<div style="font-size:9px;font-weight:800;color:#3498db;text-transform:uppercase;margin-bottom:4px">üèÜ BEST MODE</div>';
      h+='<div style="display:flex;align-items:center;justify-content:center;gap:4px">'+mIco(bestM.name)+'<span style="font-weight:800;font-size:14px">'+bestM.name+'</span></div>';
      h+='<div style="font-family:var(--mono);font-weight:700;color:#3498db;font-size:18px">'+bestM.wr+'%</div>';
      h+='<div style="font-size:10px;color:var(--t3)">'+bestM.p+' games</div></div>';
    }
  }else{h+='<div style="color:var(--t3);font-size:12px">No mode data</div>';}
  h+='</div></div>';

  // Top 3 brawlers visual
  if(p.brawlers.length>=3){
    var top3=p.brawlers.slice(0,3);
    h+='<div style="margin-top:16px"><div style="font-weight:900;font-size:13px;text-transform:uppercase;color:var(--green);margin-bottom:10px">'+sIco("up")+'TOP 3 PICKS</div>';
    h+='<div style="display:flex;gap:12px">';
    for(var ti=0;ti<top3.length;ti++){var tb2=top3[ti];
      h+='<div style="flex:1;background:var(--green-bg);border:1px solid rgba(46,204,113,.2);border-radius:10px;padding:14px;text-align:center">';
      h+='<div style="font-size:10px;font-weight:800;color:var(--t3);margin-bottom:4px">#'+(ti+1)+'</div>';
      h+='<div style="margin-bottom:6px">'+bIcon(tb2.name,44)+'</div>';
      h+='<div style="font-weight:800;font-size:14px">'+tb2.name+'</div>';
      h+='<div style="font-family:var(--mono);font-weight:700;color:var(--green);font-size:18px;margin-top:2px">'+tb2.wr+'%</div>';
      h+='<div style="font-size:10px;color:var(--t3)">'+tb2.p+' games ¬∑ '+tb2.w+'W '+(tb2.p-tb2.w)+'L</div></div>';
    }
    h+='</div></div>';
  }

  h+='</div>';
  d.innerHTML=h;
}

function startDraft(fp){
  draft.fp=fp;draft.step=0;draft.bans1=[];draft.bans2=[];draft.picks1=[];draft.picks2=[];draft.started=true;
  draft.botTeam=2;
  go("draft");
  // If bot goes first, trigger auto-pick
  setTimeout(function(){triggerBotIfNeeded();},300);
}

// ‚îÄ‚îÄ BOT AI ‚îÄ‚îÄ
function botScore(bName,s){
  var score=50; // base
  // 1. Map performance (most important)
  var bd=null;
  for(var i=0;i<s.brawlers.length;i++){if(s.brawlers[i].name===bName){bd=s.brawlers[i];break;}}
  if(bd){
    // Map-specific WR
    if(draft.selMap&&bd.maps&&bd.maps[draft.selMap]&&bd.maps[draft.selMap].n>=2){
      score=(bd.maps[draft.selMap].w/bd.maps[draft.selMap].n)*100;
    }
    // Mode WR fallback
    else if(draft.selMode&&bd.modes&&bd.modes[draft.selMode]&&bd.modes[draft.selMode].n>=2){
      score=(bd.modes[draft.selMode].w/bd.modes[draft.selMode].n)*100;
    }
    // General WR
    else{score=+bd.wr||50;}
  }
  // 2. Counter bonus: score vs user's already-picked brawlers
  var _cMul=draft.difficulty===1?0.1:draft.difficulty===3?0.5:0.3;
  var userPicks=draft.picks1;
  for(var j=0;j<userPicks.length;j++){
    var ck=bName+"_vs_"+userPicks[j];
    var cm=s.counters[ck];
    if(cm&&cm.t>=2){
      var cwr=(cm.w/cm.t)*100;
      score+=(cwr-50)*_cMul;
    }
  }
  // 3. Synergy with bot's own picks
  var _sMul=draft.difficulty===1?0.05:draft.difficulty===3?0.4:0.2;
  var botPicks=draft.picks2;
  for(var k=0;k<botPicks.length;k++){
    var sk1=bName+"_with_"+botPicks[k];
    var sk2=botPicks[k]+"_with_"+bName;
    var sm=s.synergies[sk1]||s.synergies[sk2];
    if(sm&&sm.t>=2){
      var swr=(sm.w/sm.t)*100;
      score+=(swr-50)*_sMul;
    }
  }
  // 4. Random factor based on difficulty
  var _rng=draft.difficulty===1?30:draft.difficulty===3?3:6;
  score+=Math.random()*_rng-_rng/2;
  // Easy mode: occasionally pick randomly (20% chance)
  if(draft.difficulty===1&&Math.random()<0.2)score=Math.random()*100;
  return score;
}

function botBanScore(bName,s){
  // For banning: score how dangerous this brawler is for the USER
  var score=0;
  var bd=null;
  for(var i=0;i<s.brawlers.length;i++){if(s.brawlers[i].name===bName){bd=s.brawlers[i];break;}}
  if(bd){
    if(draft.selMap&&bd.maps&&bd.maps[draft.selMap]&&bd.maps[draft.selMap].n>=2){
      score=(bd.maps[draft.selMap].w/bd.maps[draft.selMap].n)*100;
    }else if(draft.selMode&&bd.modes&&bd.modes[draft.selMode]&&bd.modes[draft.selMode].n>=2){
      score=(bd.modes[draft.selMode].w/bd.modes[draft.selMode].n)*100;
    }else{score=+bd.wr||50;}
  }
  // Higher pick rate = more ban-worthy
  if(bd)score+=Math.min(10,(+bd.pr||0)*2);
  var _bRng=draft.difficulty===1?20:draft.difficulty===3?2:4;
  score+=Math.random()*_bRng-_bRng/2;
  if(draft.difficulty===1&&Math.random()<0.25)score=Math.random()*80;
  return score;
}

function botAutoPick(s){
  if(draft.step>=8)return;
  var seq=DRAFT_SEQ[draft.step];
  var team=draftTeam(draft.step);
  if(team===1)return; // not bot's turn
  var used=draft.bans1.concat(draft.bans2,draft.picks1,draft.picks2);
  var available=draft.allBrawlers.filter(function(b){return used.indexOf(b)<0;});
  if(!available.length)return;

  var best=null,bestScore=-999;
  for(var i=0;i<available.length;i++){
    var sc=seq.type==="ban"?botBanScore(available[i],s):botScore(available[i],s);
    if(sc>bestScore){bestScore=sc;best=available[i];}
  }
  if(!best)best=available[0];

  // Apply pick
  if(seq.type==="ban"){draft.bans2.push(best);}
  else{draft.picks2.push(best);}
  draft.step++;

  // Chain: if next step is also bot's turn, auto-pick again
  if(draft.step<8){
    var nextTeam=draftTeam(draft.step);
    if(nextTeam===2){
      setTimeout(function(){
        var s2=compute(getFD());
        botAutoPick(s2);
        renderDraft(document.getElementById("pg-draft"),s2);
      },600);
    }
  }
}

function afterUserPick(){
  // After user picks, check if bot needs to go
  if(draft.step<8){
    var nextTeam=draftTeam(draft.step);
    if(nextTeam===2){
      setTimeout(function(){
        var s2=compute(getFD());
        botAutoPick(s2);
        renderDraft(document.getElementById("pg-draft"),s2);
      },500);
    }
  }
}

function renderDraft(el,s){
  var step=draft.step;var done=step>=8;
  var curSeq=step<8?DRAFT_SEQ[step]:null;
  var curTeam=step<8?draftTeam(step):0;
  var curType=curSeq?curSeq.type:"";
  var fpLabel=draft.fp===1?"YOU":"ENEMY";

  var advPct=calcDraftAdv(s);

  var h='<div class="fade">';

  // Tab bar (same as parent)
  h+='<div style="display:flex;gap:0;margin-bottom:20px;border-radius:12px;overflow:hidden;border:1px solid var(--border);background:var(--bg2)">';
  h+='<div onclick="_draftTab=\'counter\';draft.started=false;go(\'draft\')" style="flex:1;padding:14px;text-align:center;cursor:pointer;font-weight:800;font-size:13px;letter-spacing:.5px;color:var(--t2)">';
  h+=''+sIco("scope")+'COUNTER PICK</div>';
  h+='<div style="flex:1;padding:14px;text-align:center;font-weight:800;font-size:13px;letter-spacing:.5px;background:var(--green);color:#000">';
  h+=''+sIco("swords")+'DRAFT SIMULATOR</div>';
  h+='</div>';

  // Map/mode header
  if(draft.selMode||draft.selMap){
    var _mid=draft.selMap?getMapId(draft.selMap):0;
    h+='<div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;padding:8px 14px;border-radius:10px;background:var(--bg2);border:1px solid '+(MC[draft.selMode]||"var(--border)")+'40">';
    if(_mid){h+='<img src="https://cdn.brawlify.com/maps/regular/'+_mid+'.png" style="width:36px;height:48px;border-radius:5px;object-fit:cover;border:1px solid var(--border)" loading="lazy" onerror="this.style.display=\'none\'">';}
    h+='<div>';
    if(draft.selMode){h+='<div style="display:flex;align-items:center;gap:5px">'+mIco(draft.selMode)+'<span style="font-size:12px;font-weight:700;color:'+(MC[draft.selMode]||"var(--t1)")+'">'+draft.selMode.toUpperCase()+'</span></div>';}
    if(draft.selMap){h+='<div style="font-size:13px;font-weight:600;color:var(--t1);margin-top:1px">'+draft.selMap+'</div>';}
    h+='</div>';
    h+='<span style="flex:1"></span><span style="font-size:10px;color:var(--t3);padding:4px 10px;border-radius:6px;background:var(--bg3)">1st: <b style="color:'+(draft.fp===1?"var(--green)":"var(--red)")+'">'+(draft.fp===1?"YOU":"ENEMY")+'</b></span>';
    h+='</div>';
  }

  // Step progress
  h+='<div style="display:flex;gap:4px;margin-bottom:16px">';
  for(var si=0;si<8;si++){
    var sSeq=DRAFT_SEQ[si];var sTeam=draftTeam(si);
    var sColor=si<step?(sTeam===1?"var(--green)":"var(--red)"):(si===step?"var(--t1)":"var(--bg4)");
    var sBg=si<step?(sTeam===1?"rgba(46,204,113,.2)":"rgba(231,76,60,.2)"):(si===step?"var(--bg3)":"var(--bg2)");
    h+='<div style="flex:1;height:6px;border-radius:3px;background:'+sBg+';position:relative">';
    if(si<=step)h+='<div style="width:100%;height:100%;border-radius:3px;background:'+sColor+'"></div>';
    h+='</div>';
  }
  h+='</div>';

  // Draft board - 3 columns
  h+='<div style="display:grid;grid-template-columns:1fr 50px 1fr;gap:12px;margin-bottom:16px">';

  // ‚îÄ‚îÄ YOUR TEAM ‚îÄ‚îÄ
  h+='<div class="card" style="padding:16px;border-color:rgba(46,204,113,.15)">';
  h+='<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px"><span style="font-weight:800;color:var(--green);font-size:12px;letter-spacing:.5px">YOUR TEAM</span>';
  if(draft.fp===1)h+='<span style="font-size:9px;padding:2px 6px;border-radius:4px;background:rgba(46,204,113,.15);color:var(--green);font-weight:700">1ST PICK</span>';
  h+='</div>';
  // Ban slot
  h+='<div style="margin-bottom:12px">';
  if(draft.bans1[0]){
    h+='<div style="display:flex;align-items:center;gap:6px;padding:6px 10px;border-radius:8px;background:rgba(231,76,60,.08);border:1px solid rgba(231,76,60,.2)">';
    h+=bIconSm(draft.bans1[0])+'<span style="font-size:12px;font-weight:600;text-decoration:line-through;color:var(--red)">'+draft.bans1[0]+'</span></div>';
  }else{
    h+='<div style="padding:8px;border:1px dashed var(--border);border-radius:8px;text-align:center;font-size:10px;color:var(--t4)">BAN</div>';
  }
  h+='</div>';
  // Pick slots
  h+='<div style="display:flex;gap:8px">';
  for(var pi=0;pi<3;pi++){
    if(draft.picks1[pi]){
      h+='<div style="text-align:center;flex:1">'+bIcon(draft.picks1[pi],52);
      h+='<div style="font-size:9px;font-weight:700;margin-top:4px;color:var(--t1);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+draft.picks1[pi]+'</div></div>';
    }else{
      h+='<div style="flex:1;aspect-ratio:1;border:2px dashed var(--border);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--t4);font-weight:700">'+(pi+1)+'</div>';
    }
  }
  h+='</div></div>';

  // ‚îÄ‚îÄ VS ‚îÄ‚îÄ
  h+='<div style="display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:900;color:var(--t4)">VS</div>';

  // ‚îÄ‚îÄ ENEMY TEAM ‚îÄ‚îÄ
  h+='<div class="card" style="padding:16px;border-color:rgba(231,76,60,.15)">';
  h+='<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px"><span style="font-weight:800;color:var(--red);font-size:12px;letter-spacing:.5px">ENEMY TEAM</span>';
  if(draft.fp===2)h+='<span style="font-size:9px;padding:2px 6px;border-radius:4px;background:rgba(231,76,60,.15);color:var(--red);font-weight:700">1ST PICK</span>';
  h+='</div>';
  // Ban slot
  h+='<div style="margin-bottom:12px">';
  if(draft.bans2[0]){
    h+='<div style="display:flex;align-items:center;gap:6px;padding:6px 10px;border-radius:8px;background:rgba(231,76,60,.08);border:1px solid rgba(231,76,60,.2)">';
    h+=bIconSm(draft.bans2[0])+'<span style="font-size:12px;font-weight:600;text-decoration:line-through;color:var(--red)">'+draft.bans2[0]+'</span></div>';
  }else{
    h+='<div style="padding:8px;border:1px dashed var(--border);border-radius:8px;text-align:center;font-size:10px;color:var(--t4)">BAN</div>';
  }
  h+='</div>';
  // Pick slots
  h+='<div style="display:flex;gap:8px">';
  for(var pi2=0;pi2<3;pi2++){
    if(draft.picks2[pi2]){
      h+='<div style="text-align:center;flex:1">'+bIcon(draft.picks2[pi2],52);
      h+='<div style="font-size:9px;font-weight:700;margin-top:4px;color:var(--t1);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+draft.picks2[pi2]+'</div></div>';
    }else{
      h+='<div style="flex:1;aspect-ratio:1;border:2px dashed var(--border);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--t4);font-weight:700">'+(pi2+1)+'</div>';
    }
  }
  h+='</div></div></div>';

  // Advantage bar
  if(draft.picks1.length>0||draft.picks2.length>0){
    var t2Pct=(100-advPct).toFixed(1);
    h+='<div class="card" style="padding:12px 20px"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">';
    h+='<span style="font-weight:700;font-size:12px;color:var(--green)">YOU '+advPct.toFixed(1)+'%</span>';
    h+='<span style="font-size:10px;color:var(--t3);font-weight:700;letter-spacing:1px">ADVANTAGE</span>';
    h+='<span style="font-weight:700;font-size:12px;color:var(--red)">'+t2Pct+'% ENEMY</span></div>';
    h+='<div class="adv-bar"><div class="adv-bar-l" style="width:'+advPct.toFixed(1)+'%"></div><div class="adv-bar-r" style="width:'+t2Pct+'%"></div></div></div>';
  }

  // Current step or result
  var isBotTurn=!done&&curTeam===2;
  if(!done){
    var teamLabel=curTeam===1?"YOUR TEAM":"ENEMY";
    var stepColor=curTeam===1?"var(--green)":"var(--red)";
    var typeIcon=curType==="ban"?sIco("down"):sIco("up");
    var typeLabel=curType==="ban"?"BAN":"PICK";
    var typeBg=curTeam===1?(curType==="ban"?"rgba(231,76,60,.08)":"rgba(46,204,113,.08)"):"rgba(231,76,60,.08)";
    var typeBorder=curTeam===1?(curType==="ban"?"rgba(231,76,60,.2)":"rgba(46,204,113,.2)"):"rgba(231,76,60,.2)";
    h+='<div style="display:flex;align-items:center;justify-content:space-between;padding:14px 20px;background:'+typeBg+';border-radius:10px;border:1px solid '+typeBorder+';margin-bottom:12px">';
    h+='<div><div style="font-size:10px;color:var(--t3);font-weight:700;letter-spacing:1px">STEP '+(step+1)+'/8</div>';
    if(isBotTurn){
      h+='<div style="font-size:16px;font-weight:900;color:var(--red)">'+sIco("target")+' BOT '+typeLabel+'ING...</div>';
    }else{
      h+='<div style="font-size:16px;font-weight:900;color:'+stepColor+'">'+teamLabel+' ‚Äî '+typeIcon+' '+typeLabel+'</div>';
    }
    h+='</div>';
    h+='<button class="btn" onclick="draft.started=false;draft.fp=0;draft.selMode=\'\';draft.selMap=\'\';go(\'draft\')" style="font-size:11px;padding:6px 12px">‚Ü∫ Reset</button></div>';
  }else{
    var t2F=(100-advPct).toFixed(1);
    var winLabel=advPct>=50?"YOUR TEAM WINS THE DRAFT":"ENEMY WINS THE DRAFT";
    var winC=advPct>=50?"var(--green)":"var(--red)";
    h+='<div class="card" style="text-align:center;border-color:'+winC+';padding:24px">';
    h+='<div style="font-size:10px;color:var(--t3);font-weight:700;text-transform:uppercase;letter-spacing:2px;margin-bottom:8px">RESULT</div>';
    h+='<div style="font-size:20px;font-weight:900;color:'+winC+'">'+winLabel+'</div>';
    h+='<div style="font-size:48px;font-weight:900;font-family:var(--mono);color:'+winC+';margin:8px 0">'+advPct.toFixed(1)+'%<span style="font-size:20px;color:var(--t3)"> ‚Äî </span>'+t2F+'%</div>';
    h+='<div class="adv-bar" style="max-width:400px;margin:12px auto"><div class="adv-bar-l" style="width:'+advPct.toFixed(1)+'%"></div><div class="adv-bar-r" style="width:'+t2F+'%"></div></div>';
    h+=renderH2HDetails(s);
    h+='<button class="btn btn-g" style="margin-top:16px;padding:10px 24px" onclick="draft.started=false;draft.fp=0;draft.selMode=\'\';draft.selMap=\'\';go(\'draft\')">‚Ü∫ New Draft</button></div>';
  }

  // Brawler selection grid (only show when it's user's turn)
  if(!done&&!isBotTurn){
    h+='<input class="search-box" id="draftSearch" placeholder="‚åï Search brawler..." oninput="filterDraftGrid()" style="max-width:100%">';
    h+='<div class="pills" id="draftCPills"><div class="pill white" onclick="setDraftCF(\'\')">ALL</div>';
    for(var ci=0;ci<CLASSES.length;ci++){var c=CLASSES[ci];h+='<div class="pill" onclick="setDraftCF(\''+c+'\')">'+clsIco(c,14)+' '+c.toUpperCase()+'</div>';}
    h+='</div>';
    var used=draft.bans1.concat(draft.bans2,draft.picks1,draft.picks2);
    h+='<div class="b-grid" id="draftGrid" style="grid-template-columns:repeat(auto-fill,minmax(56px,1fr))">';
    for(var gi=0;gi<draft.allBrawlers.length;gi++){
      var bn=draft.allBrawlers[gi];var isUsed=used.indexOf(bn)>=0;
      h+='<div class="b-icon'+(isUsed?" used":"")+'" style="background:'+bc(bn)+';'+(isUsed?"opacity:.15;pointer-events:none":"")+'" data-b="'+bn+'" data-cls="'+(BCLS[bn]||"")+'" onclick="draftSelect(\''+bn.replace(/'/g,"\\'")+'\')">';
      if(bImgSrc(bn))h+='<img src="'+bImgSrc(bn)+'" loading="lazy" style="width:100%;height:100%;object-fit:cover;border-radius:8px;position:absolute;top:0;left:0" onerror="this.onerror=null;this.src=\''+bImgSrc2(bn)+'\'">';
      h+='<div class="b-icon-name">'+bn+'</div></div>';
    }
    h+='</div>';
  }
  h+='</div>';
  el.innerHTML=h;
}

var _draftCF="";
function setDraftCF(c){_draftCF=c;var pills=document.querySelectorAll("#draftCPills .pill");pills.forEach(function(p){p.classList.remove("white","green");});if(!c)pills[0].classList.add("white");else pills.forEach(function(p){if(p.textContent.toUpperCase().indexOf(c.toUpperCase())>=0)p.classList.add("green");});filterDraftGrid();}
function filterDraftGrid(){var v=(document.getElementById("draftSearch")?document.getElementById("draftSearch").value:"").toLowerCase();document.querySelectorAll("#draftGrid .b-icon").forEach(function(e){if(e.classList.contains("used")){e.style.display="none";return;}var nm=e.dataset.b.toLowerCase().indexOf(v)>=0;var cm=!_draftCF||e.dataset.cls===_draftCF;e.style.display=(nm&&cm)?"":"none";});}

function draftSelect(name){
  if(draft.step>=8)return;
  var seq=DRAFT_SEQ[draft.step];
  var team=draftTeam(draft.step);
  // Only allow user to pick for team 1
  if(team!==1)return;
  if(seq.type==="ban"){
    draft.bans1.push(name);
  }else{
    draft.picks1.push(name);
  }
  draft.step++;
  var s=compute(getFD());
  renderDraft(document.getElementById("pg-draft"),s);
  // Trigger bot if next step is bot's turn
  afterUserPick();
}

// Trigger bot at draft start if bot goes first
function triggerBotIfNeeded(){
  if(draft.step<8){
    var nextTeam=draftTeam(draft.step);
    if(nextTeam===2){
      setTimeout(function(){
        var s2=compute(getFD());
        botAutoPick(s2);
        renderDraft(document.getElementById("pg-draft"),s2);
      },500);
    }
  }
}

function calcDraftAdv(s){
  var t1=0,t2=0,n1=draft.picks1.length,n2=draft.picks2.length;
  var i,j,bd,k,m;
  // Individual WR scores
  for(i=0;i<n1;i++){bd=null;for(j=0;j<s.brawlers.length;j++){if(s.brawlers[j].name===draft.picks1[i]){bd=s.brawlers[j];break;}}t1+=bd?(+bd.wr):50;}
  for(i=0;i<n2;i++){bd=null;for(j=0;j<s.brawlers.length;j++){if(s.brawlers[j].name===draft.picks2[i]){bd=s.brawlers[j];break;}}t2+=bd?(+bd.wr):50;}
  // H2H matchup bonuses
  for(i=0;i<n1;i++){for(j=0;j<n2;j++){
    k=draft.picks1[i]+"_vs_"+draft.picks2[j];m=s.counters[k];
    if(m&&m.t>=2){var wr=(m.w/m.t)*100;if(wr>50)t1+=(wr-50)*0.4;else t2+=(50-wr)*0.4;}
  }}
  if(t1===0&&t2===0)return 50;
  return(t1/(t1+t2))*100;
}

function renderH2HDetails(s){
  var h='<div style="margin-top:16px;text-align:left">';
  var details=[];
  for(var i=0;i<draft.picks1.length;i++){for(var j=0;j<draft.picks2.length;j++){
    var k=draft.picks1[i]+"_vs_"+draft.picks2[j];var m=s.counters[k];
    if(m&&m.t>=2){details.push({a:draft.picks1[i],e:draft.picks2[j],wr:((m.w/m.t)*100).toFixed(1),w:m.w,t:m.t});}
  }}
  if(details.length){
    h+='<div style="font-weight:700;font-size:12px;color:var(--t3);text-transform:uppercase;margin-bottom:8px">Head-to-Head</div><table><thead><tr><th>You</th><th>vs</th><th>WR</th><th>Record</th></tr></thead><tbody>';
    for(var d=0;d<details.length;d++){var dd=details[d];h+='<tr><td><div style="display:flex;align-items:center;gap:4px">'+bIconSm(dd.a)+' '+dd.a+'</div></td><td><div style="display:flex;align-items:center;gap:4px">'+bIconSm(dd.e)+' '+dd.e+'</div></td><td class="'+wrCol(dd.wr)+'" style="font-family:var(--mono)">'+dd.wr+'%</td><td style="font-size:12px;color:var(--t3)">'+dd.w+'W-'+(dd.t-dd.w)+'L</td></tr>';}
    h+='</tbody></table>';
  }
  h+='</div>';return h;
}

// ‚ïê‚ïê‚ïê MAP STATS ‚ïê‚ïê‚ïê
var _mapFilter="";
function pgMaps(el,s,data){
  // Use ALL data for maps page (ignore global mode filter)
  var allData=matchData;
  if(filters.days&&filters.days<9999){var mx=null;for(var _i=0;_i<matchData.length;_i++){if(!matchData[_i].date)continue;var rd=_pd(matchData[_i].date);if(!isNaN(rd)&&(!mx||rd>mx))mx=rd;}if(mx){var cut=new Date(mx.getTime()-filters.days*86400000);allData=matchData.filter(function(r){if(!r.date)return false;var rd2=_pd(r.date);return !isNaN(rd2)&&rd2>=cut;});}}
  var h='<div class="fade">';
  h+='<div style="display:flex;align-items:center;gap:10px;margin-bottom:16px"><span style="font-size:24px;font-weight:900">MAP STATS</span></div>';
  // Build mode pills from ALL data
  var _mpm={};for(var _x=0;_x<allData.length;_x++){if(allData[_x].mode)_mpm[allData[_x].mode]=1;}
  var _mpl=[];var _validModes={};for(var _xi=0;_xi<MODES.length;_xi++)_validModes[MODES[_xi]]=_xi;
  for(var _xk in _mpm){if(_validModes[_xk]!=null)_mpl.push(_xk);}
  _mpl.sort(function(a,b){return _validModes[a]-_validModes[b];});
  h+='<div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:12px">';
  h+='<div class="pills" style="margin-bottom:0">';
  h+='<div class="pill '+(!_mapFilter?"white":"")+'" onclick="setMapMF(\'\')">ALL</div>';
  for(var mi=0;mi<_mpl.length;mi++){var mo=_mpl[mi];h+='<div class="pill '+(_mapFilter===mo?"green":"")+'" onclick="setMapMF(\''+mo+'\')">'+mIco(mo)+mo.toUpperCase()+'</div>';}
  h+='</div>';
  h+='<div style="margin-left:auto;display:flex;gap:4px">';
  var _mdays=[{v:5,l:"5J"},{v:15,l:"15J"},{v:30,l:"30J"},{v:9999,l:"ALL"}];
  for(var _md=0;_md<_mdays.length;_md++){var _dv=_mdays[_md],_ac=filters.days===_dv.v;
    h+='<div onclick="setDays('+_dv.v+')" style="cursor:pointer;padding:5px 10px;border-radius:8px;font-size:11px;font-weight:800;letter-spacing:.5px;transition:all .15s;'+(_ac?'background:var(--green);color:#000':'background:var(--bg3);color:var(--t3);border:1px solid var(--border)')+'">'+_dv.l+'</div>';}
  h+='</div></div>';
  h+='<div style="display:grid;grid-template-columns:300px 1fr;gap:20px">';
  h+='<div><input class="search-box" id="mapSearch" placeholder="Search map..." oninput="filterMapList()" style="max-width:100%">';
  h+='<div id="mapList" style="display:flex;flex-direction:column;gap:6px;margin-top:8px;max-height:calc(100vh - 260px);overflow-y:auto">';
  // Build map data from allData (respects days filter but not mode filter)
  var mapData={};
  for(var di=0;di<allData.length;di++){var r=allData[di];if(!r.map)continue;
    if(!mapData[r.map])mapData[r.map]={name:r.map,mode:r.mode||"",w:0,t:0,brawlers:{},teams:{}};
    var md=mapData[r.map];md.t++;if(r.result==="victory")md.w++;
    var myB=[r.brawler1,r.brawler2,r.brawler3].filter(Boolean);
    myB.forEach(function(b){if(!md.brawlers[b])md.brawlers[b]={w:0,p:0};md.brawlers[b].p++;if(r.result==="victory")md.brawlers[b].w++;});
    if(r.team1_name){if(!md.teams[r.team1_name])md.teams[r.team1_name]={w:0,p:0};md.teams[r.team1_name].p++;if(r.result==="victory")md.teams[r.team1_name].w++;}
  }
  var mapList=[];for(var mk in mapData){mapList.push(mapData[mk]);}
  mapList.sort(function(a,b){return b.t-a.t;});
  for(var li=0;li<mapList.length;li++){
    var ml=mapList[li];var mwr=ml.t?((ml.w/ml.t)*100).toFixed(1):"0";
    if(_mapFilter&&ml.mode!==_mapFilter)continue;
    // Find best brawler on this map (most picked, min 2)
    var bestB=null,bestBP=0;
    for(var bk in ml.brawlers){var bs=ml.brawlers[bk];if(bs.p>=2&&bs.p>bestBP){bestBP=bs.p;bestB={name:bk,wr:((bs.w/bs.p)*100).toFixed(0),p:bs.p,pr:(ml.t?((bs.p/ml.t)*100).toFixed(0):"0")};}}
    // Find best team on this map
    var bestT=null,bestTWr=0;
    for(var tk in ml.teams){var ts=ml.teams[tk];if(ts.p>=2&&tk.indexOf("Unknown")!==0){var twr=(ts.w/ts.p)*100;if(twr>bestTWr){bestTWr=twr;bestT={name:tk,wr:twr.toFixed(0),p:ts.p};}}}
    h+='<div class="map-list-item" data-map="'+ml.name+'" data-mode="'+ml.mode+'" onclick="showMapDetail(\''+ml.name.replace(/'/g,"\\'")+'\')" style="padding:10px 12px;border-radius:8px;background:var(--bg3);border:1px solid var(--border);cursor:pointer;transition:all .15s" onmouseover="this.style.borderColor=\'var(--green)\'" onmouseout="this.style.borderColor=\'var(--border)\'">';
    var _mlId=getMapId(ml.name);
    h+='<div style="display:flex;justify-content:space-between;align-items:center">';
    h+='<div style="display:flex;align-items:center;gap:10px">';
    if(_mlId)h+='<img src="https://cdn.brawlify.com/maps/regular/'+_mlId+'.png" style="width:32px;height:42px;border-radius:4px;object-fit:cover;border:1px solid var(--border);flex-shrink:0" loading="lazy" onerror="this.style.display=\'none\'">';
    h+='<div><div style="font-weight:700;font-size:13px">'+ml.name+'</div>';
    h+='<div style="font-size:10px;color:'+(MC[ml.mode]||"var(--t3)")+';font-weight:600;margin-top:2px;display:flex;align-items:center;gap:4px">'+mIco(ml.mode)+'<span>'+ml.mode+' ¬∑ '+ml.t+' games</span></div>';
    // Best brawler row
    if(bestB){
      h+='<div style="display:flex;align-items:center;gap:3px;margin-top:3px">';
      h+='<span style="font-size:9px;color:var(--t3)">TOP:</span>';
      h+=bIconSm(bestB.name);
      h+='<span style="font-size:10px;font-weight:700;color:var(--t2)">'+bestB.pr+'%</span>';
      h+='<span style="font-size:9px;color:var(--t3)">use</span>';
      h+='<span style="font-size:10px;font-weight:700;color:var(--green)">'+bestB.wr+'%</span>';
      h+='<span style="font-size:9px;color:var(--t3)">wr</span>';
      if(bestT){
        h+='<span style="font-size:9px;color:var(--t3);margin-left:4px">Best:</span>';
        var tLogo=teamLogo(bestT.name,14);
        if(tLogo){h+=tLogo;}else{h+='<span style="font-size:9px;font-weight:700;color:var(--t2)">'+bestT.name.replace(/[^A-Z0-9]/gi,"").slice(0,3).toUpperCase()+'</span>';}
        h+='<span style="font-size:10px;font-weight:600;color:#3498db">'+bestT.wr+'%</span>';
      }
      h+='</div>';
    }
    h+='</div></div>';
    h+='<span class="'+wrCol(mwr)+'" style="font-family:var(--mono);font-weight:700;font-size:14px">'+mwr+'%</span>';
    h+='</div></div>';
  }
  h+='</div></div>';
  h+='<div id="mapDetail"><div style="color:var(--t3);text-align:center;padding:60px">‚Üê Select a map</div></div>';
  h+='</div></div>';
  el.innerHTML=h;
  // Auto-select first map
  var _firstMap=document.querySelector(".map-list-item");
  if(_firstMap)showMapDetail(_firstMap.dataset.map);
}
function setMapMF(m){_mapFilter=m;go("maps");}
function filterMapList(){var v=document.getElementById("mapSearch").value.toLowerCase();document.querySelectorAll(".map-list-item").forEach(function(e){e.style.display=e.dataset.map.toLowerCase().indexOf(v)>=0?"":"none";});}

function showMapDetail(mapName){
  var data=matchData;
  if(filters.days&&filters.days<9999){var mx=null;for(var _i=0;_i<matchData.length;_i++){if(!matchData[_i].date)continue;var rd=_pd(matchData[_i].date);if(!isNaN(rd)&&(!mx||rd>mx))mx=rd;}if(mx){var cut=new Date(mx.getTime()-filters.days*86400000);data=matchData.filter(function(r){if(!r.date)return false;var rd2=_pd(r.date);return !isNaN(rd2)&&rd2>=cut;});}}
  var s=compute(data);
  document.querySelectorAll(".map-list-item").forEach(function(e){e.style.borderColor=e.dataset.map===mapName?"var(--green)":"var(--border)";e.style.background=e.dataset.map===mapName?"var(--bg4)":"var(--bg3)";});
  var bMap={},totalOnMap=0,winsOnMap=0,mapMode="";
  for(var i=0;i<data.length;i++){var r=data[i];if(r.map!==mapName)continue;
    totalOnMap++;if(r.result==="victory")winsOnMap++;
    if(r.mode)mapMode=r.mode;
    [r.brawler1,r.brawler2,r.brawler3].filter(Boolean).forEach(function(b){if(!bMap[b])bMap[b]={name:b,w:0,p:0};bMap[b].p++;if(r.result==="victory")bMap[b].w++;});
  }
  var bList=[];for(var bk in bMap){var bb=bMap[bk];bList.push({name:bb.name,w:bb.w,p:bb.p,wr:bb.p?((bb.w/bb.p)*100).toFixed(1):"0",pr:totalOnMap?((bb.p/totalOnMap)*100).toFixed(1):"0"});}
  bList.sort(function(a,b){return b.p-a.p;});
  var mapWr=totalOnMap?((winsOnMap/totalOnMap)*100).toFixed(1):"0";
  var h='<div class="card fade">';
  var _detMapId=getMapId(mapName);
  h+='<div style="display:flex;align-items:center;gap:16px;margin-bottom:16px">';
  if(_detMapId){
    h+='<div style="width:64px;height:84px;border-radius:10px;overflow:hidden;border:2px solid '+(MC[mapMode]||"var(--border)")+';flex-shrink:0">';
    h+='<img src="https://cdn.brawlify.com/maps/regular/'+_detMapId+'.png" style="width:100%;height:100%;object-fit:cover" loading="lazy" onerror="this.parentElement.style.display=\'none\'">';
    h+='</div>';
  }
  h+='<div><div style="font-size:22px;font-weight:900;text-transform:uppercase">'+mapName+'</div>';
  h+='<div style="font-size:12px;color:'+(MC[mapMode]||"var(--t3)")+';font-weight:600;margin-top:2px;display:flex;align-items:center;gap:5px">'+mIco(mapMode)+'<span>'+mapMode+' ¬∑ '+totalOnMap+' games ¬∑ '+mapWr+'% wr</span></div></div></div>';
  // Top 25 brawlers - 2 columns
  var _bTop=bList.slice(0,25);
  var _half=Math.ceil(_bTop.length/2);
  function _mapBRow(bb2,idx){
    var rh='<div style="display:flex;align-items:center;gap:6px;padding:6px 8px;border-bottom:1px solid var(--border);cursor:pointer" onclick="showB(\''+bb2.name.replace(/'/g,"\\\'")+'\');" onmouseover="this.style.background=\'var(--bg4)\'" onmouseout="this.style.background=\'\'"><span style="font-weight:800;color:var(--t3);font-family:var(--mono);min-width:22px;font-size:11px">'+(idx+1)+'</span>';
    rh+=bIcon(bb2.name,28);
    rh+='<span style="font-weight:700;font-size:12px;min-width:70px;max-width:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">'+bb2.name+'</span>';
    rh+='<span style="font-family:var(--mono);font-weight:700;font-size:12px;min-width:30px;text-align:right">'+bb2.w+'</span>';
    rh+='<span class="'+wrCol(bb2.wr)+'" style="font-family:var(--mono);font-weight:700;font-size:12px;min-width:38px;text-align:right">'+bb2.wr+'%</span>';
    rh+='<span style="font-family:var(--mono);font-weight:600;font-size:11px;color:var(--t2);min-width:32px;text-align:right">'+bb2.pr+'%</span></div>';return rh;
  }
  h+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">';
  h+='<div style="background:var(--bg3);border:1px solid var(--border);border-radius:10px;overflow:hidden">';
  h+='<div style="display:flex;gap:6px;padding:8px 8px 4px;font-size:9px;font-weight:800;color:var(--t3);text-transform:uppercase;border-bottom:1px solid var(--border)"><span style="min-width:22px">#</span><span style="min-width:28px"></span><span style="min-width:70px">BRAWLER</span><span style="min-width:30px;text-align:right">WINS</span><span style="min-width:38px;text-align:right">WR</span><span style="min-width:32px;text-align:right">PR</span></div>';
  for(var bi=0;bi<_half;bi++){h+=_mapBRow(_bTop[bi],bi);}
  h+='</div>';
  h+='<div style="background:var(--bg3);border:1px solid var(--border);border-radius:10px;overflow:hidden">';
  h+='<div style="display:flex;gap:6px;padding:8px 8px 4px;font-size:9px;font-weight:800;color:var(--t3);text-transform:uppercase;border-bottom:1px solid var(--border)"><span style="min-width:22px">#</span><span style="min-width:28px"></span><span style="min-width:70px">BRAWLER</span><span style="min-width:30px;text-align:right">WINS</span><span style="min-width:38px;text-align:right">WR</span><span style="min-width:32px;text-align:right">PR</span></div>';
  for(var bi2=_half;bi2<_bTop.length;bi2++){h+=_mapBRow(_bTop[bi2],bi2);}
  h+='</div></div>';

  // ‚ïê‚ïê‚ïê BEST DUOS ON THIS MAP ‚ïê‚ïê‚ïê
  var _mapDuos={};
  for(var di2=0;di2<data.length;di2++){var dr=data[di2];if(dr.map!==mapName)continue;
    var _md=[dr.brawler1,dr.brawler2,dr.brawler3].filter(Boolean).sort();
    for(var da=0;da<_md.length;da++){for(var db=da+1;db<_md.length;db++){
      var _dk=_md[da]+"_"+_md[db];if(!_mapDuos[_dk])_mapDuos[_dk]={a:_md[da],b:_md[db],w:0,p:0};
      _mapDuos[_dk].p++;if(dr.result==="victory")_mapDuos[_dk].w++;
    }}
  }
  var _mdList=[];for(var ddk in _mapDuos){var dd=_mapDuos[ddk];if(dd.p>=3)_mdList.push({a:dd.a,b:dd.b,w:dd.w,p:dd.p,wr:((dd.w/dd.p)*100).toFixed(1)});}
  _mdList.sort(function(a,b){return (+b.wr)-(+a.wr)||b.p-a.p;});
  if(_mdList.length){
    h+='<div style="margin-top:16px"><div style="font-size:11px;font-weight:800;color:var(--t3);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px">ü§ù Best Duos</div>';
    h+='<div style="display:flex;flex-wrap:wrap;gap:6px">';
    for(var dui=0;dui<Math.min(6,_mdList.length);dui++){var duo=_mdList[dui];
      h+='<div style="display:flex;align-items:center;gap:6px;padding:6px 10px;background:var(--bg3);border:1px solid var(--border);border-radius:8px">';
      h+=bIconSm(duo.a)+bIconSm(duo.b);
      h+='<span class="'+wrCol(duo.wr)+'" style="font-family:var(--mono);font-weight:700;font-size:12px">'+duo.wr+'%</span>';
      h+='<span style="font-size:9px;color:var(--t3)">'+duo.p+'g</span></div>';
    }
    h+='</div></div>';
  }

  h+='</div>';
  document.getElementById("mapDetail").innerHTML=h;
}

// ‚ïê‚ïê‚ïê IMPORT ‚ïê‚ïê‚ïê
function pgImport(el){
  var h='<div class="fade">';
  h+='</div>';
  el.innerHTML=h;
}


document.addEventListener("DOMContentLoaded",init);
</script>
</body>
</html>
